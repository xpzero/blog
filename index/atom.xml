<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xpzero.github.io/blog/index</id>
    <title>What are you thinking about? Blog</title>
    <updated>2023-11-08T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://xpzero.github.io/blog/index"/>
    <subtitle>What are you thinking about? Blog</subtitle>
    <icon>https://xpzero.github.io/blog/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[whistle代理移动端h5页面]]></title>
        <id>https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile</id>
        <link href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile"/>
        <updated>2023-11-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天要排查一个问题，但是bug现场是在移动端的h5页面上才有，只能使用代理以在pc端可以看到移动端h5页面上的请求。但是代理过程并不熟悉，这里记录下。]]></summary>
        <content type="html"><![CDATA[<p>今天要排查一个问题，但是bug现场是在移动端的h5页面上才有，只能使用代理以在pc端可以看到移动端h5页面上的请求。但是代理过程并不熟悉，这里记录下。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="前置准备">前置准备<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87" class="hash-link" aria-label="前置准备的直接链接" title="前置准备的直接链接">​</a></h2>
<ul>
<li>手机: 小米11 MIUI 14.0.10</li>
<li>pc端chrome: chrome 119.0.6045.105</li>
<li>whistle: 2.9.57</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="打开手机开发者模式">打开手机开发者模式<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E6%89%93%E5%BC%80%E6%89%8B%E6%9C%BA%E5%BC%80%E5%8F%91%E8%80%85%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="打开手机开发者模式的直接链接" title="打开手机开发者模式的直接链接">​</a></h2>
<p>可参考<a href="https://blog.csdn.net/shujuwa_data/article/details/124978906" target="_blank" rel="noopener noreferrer">小米手机开发者选项在哪？小米手机怎么打开开发者选项</a></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="打开-pc端whislte代理">打开 pc端whislte代理<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E6%89%93%E5%BC%80-pc%E7%AB%AFwhislte%E4%BB%A3%E7%90%86" class="hash-link" aria-label="打开 pc端whislte代理的直接链接" title="打开 pc端whislte代理的直接链接">​</a></h2>
<div class="language-shell codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-shell codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">w2 start </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> w2 proxy</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="start whistle" src="https://xpzero.github.io/blog/assets/images/start-whistle-5374f1f3fe652e53127b29eb7d4ec353.png" width="1816" height="720" class="img_rmWR"></p>
<p>记住上面框选的ip地址及端口号，手机网络代理需要</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="手机网络代理">手机网络代理<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E6%89%8B%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86" class="hash-link" aria-label="手机网络代理的直接链接" title="手机网络代理的直接链接">​</a></h2>
<p>点进当前连接的网络</p>
<div style="width:200px"><p><img loading="lazy" alt="wifi1" src="https://xpzero.github.io/blog/assets/images/wifi1-87d8a80a29c75fa1c5016b75b83b1176.png" width="642" height="998" class="img_rmWR"></p></div>
<p>选择手动代理网络</p>
<div style="width:200px"><p><img loading="lazy" alt="wifi2" src="https://xpzero.github.io/blog/assets/images/wifi2-5fd65765fdd97768ad9e7d66bf720636.png" width="516" height="984" class="img_rmWR"></p></div>
<p>填入pc端whistle的ip及端口。<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">记得点保存</span></p>
<div style="width:200px"><p><img loading="lazy" alt="wifi3" src="https://xpzero.github.io/blog/assets/images/wifi3-d0bc5771506d9a3ba42d0bdf54fd0a2c.png" width="524" height="876" class="img_rmWR"></p></div>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>我这里是用数据线连接了手机和电脑。理论上，只要在同一个局域网内，应该也是可以代理上的。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="pc端查看移动端页面请求">pc端查看移动端页面请求<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#pc%E7%AB%AF%E6%9F%A5%E7%9C%8B%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82" class="hash-link" aria-label="pc端查看移动端页面请求的直接链接" title="pc端查看移动端页面请求的直接链接">​</a></h2>
<p>上面的步骤准备完成，在移动端重新访问要查看的页面，即可在whistle的配置页面的<code>Network</code>中查看请求</p>
<p><img loading="lazy" alt="whistle-config" src="https://xpzero.github.io/blog/assets/images/whistle-config-63f8f7ff862516a744e36c48a4cb63d7.png" width="2814" height="1052" class="img_rmWR"></p>
<p>这里就不方便贴实操图片啦，拿了whistle官网的图片示意</p>
<p>这里就已经可以看到访问对应页面的时候，会发出哪些请求及请求从发起到结束的全部内容，根据这些内容就可以开始找移动端页面的问题了。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="学到了摘录">学到了（摘录）<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E5%AD%A6%E5%88%B0%E4%BA%86%E6%91%98%E5%BD%95" class="hash-link" aria-label="学到了（摘录）的直接链接" title="学到了（摘录）的直接链接">​</a></h2>
<p>whistle中的功能很多，但是没必要每一个都了解，毕竟不是专门搞这个的。记录下这次了解到的一些whistle代理配置</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="打印日志">打印日志<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97" class="hash-link" aria-label="打印日志的直接链接" title="打印日志的直接链接">​</a></h3>
<p>配置规则：<code>https://www.baidu.com/  log://</code></p>
<p><img loading="lazy" alt="log" src="https://xpzero.github.io/blog/assets/images/whistle-log-57b3e712852d499cbcabba399a911921.awebp" width="1512" height="555" class="img_rmWR"></p>
<p>如图，可以在右侧看到请求<code>https://www.baidu.com/</code>后，可以在右侧看到其页面中的<code>console.log</code>信息</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="修改ua">修改ua<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E4%BF%AE%E6%94%B9ua" class="hash-link" aria-label="修改ua的直接链接" title="修改ua的直接链接">​</a></h3>
<p>配置规则：<code>https://www.baidu.com/ ua://{ua}</code></p>
<p><code>{ua}</code>中的ua为<code>Values</code>面板中的ua文件名，其内容为</p>
<div class="language-text codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">Mozilla/5.0&nbsp;(Windows&nbsp;Phone&nbsp;10.0;&nbsp;Android&nbsp;4.2.1;&nbsp;Microsoft;&nbsp;RM-1113)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/46.0.2486.0&nbsp;Mobile&nbsp;Safari/537.36&nbsp;Edge/13.10586</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再次请求<code>https://www.baidu.com/</code>后，可以看到页面渲染为了h5模式</p>
<p><img loading="lazy" alt="baidu" src="https://xpzero.github.io/blog/assets/images/whistle-baidu-920b07bff134cdf6b26b4f574b144bc8.awebp" width="1512" height="818" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/11/08/usage-of-whistle-in-mobile#%E5%8F%82%E8%80%83" class="hash-link" aria-label="�参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/7077385311642189832" target="_blank" rel="noopener noreferrer">Whistle 开发调试最佳实践</a></p>
<p><a href="https://juejin.cn/post/7003630513755799589" target="_blank" rel="noopener noreferrer">whistle超好用的手机调试代理工具</a></p>
<p><a href="https://wproxy.org/whistle/quickstart.html" target="_blank" rel="noopener noreferrer">whistle快速上手</a></p>]]></content>
        <category label="whistle" term="whistle"/>
        <category label="mobile" term="mobile"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[BFC是什么]]></title>
        <id>https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC</id>
        <link href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC"/>
        <updated>2023-11-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[常听说BFC这，BFC那的，也好几次的看过相关的文章，但碍不住总忘，这次就搞搞清楚，记录下来]]></summary>
        <content type="html"><![CDATA[<p>常听说BFC这，BFC那的，也好几次的看过相关的文章，但碍不住总忘，这次就搞搞清楚，记录下来</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="bfc是什么">BFC是什么<a href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC#bfc%E6%98%AF%E4%BB%80%E4%B9%88" class="hash-link" aria-label="BFC是什么的直接链接" title="BFC是什么的直接链接">​</a></h2>
<p>全称Blocking Formatting Context,简称BFC,是一个独立于文档流的布局上下文，是一种使其内部的文本和元素不会影响到外部其他元素的排列方式。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="bfc的特点">BFC的特点<a href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC#bfc%E7%9A%84%E7%89%B9%E7%82%B9" class="hash-link" aria-label="BFC的特点的直接链接" title="BFC的特点的直接链接">​</a></h2>
<ol>
<li>BFC内的浮动元素可以撑开父元素 =&gt; 包含内部浮动</li>
<li>BFC的区域不会与相邻浮动元素重叠 =&gt; 清除外部浮动的影响</li>
<li>BFC的区域可以避免与外部元素发生外边距折叠 =&gt; 阻止外边距折叠</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="bfc出现的条件">BFC出现的条件<a href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC#bfc%E5%87%BA%E7%8E%B0%E7%9A%84%E6%9D%A1%E4%BB%B6" class="hash-link" aria-label="BFC出现的条件的直接链接" title="BFC出现的条件的直接链接">​</a></h2>
<ol>
<li>根元素(html)</li>
<li>float的值不为<code>none</code></li>
<li>position的值为<code>absolute</code>或<code>fixed</code></li>
<li>display为<code>inline-block</code>、<code>inline-table</code>、<code>inline-flex</code>、<code>inline-grid</code>、<code>table</code>、<code>flex</code>、<code>grid</code>、<code>flow-root</code></li>
<li>contain为<code>layout</code>、<code>content</code>、<code>paint</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="样例效果">样例效果<a href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC#%E6%A0%B7%E4%BE%8B%E6%95%88%E6%9E%9C" class="hash-link" aria-label="样例效果的直接链接" title="样例效果的直接链接">​</a></h2>
<div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">撑开父元素的高度</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">不与相邻浮动元素重叠(清除浮动)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">阻止外边距折叠</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="playgroundContainer_CsNx"><div class="playgroundHeader_MTMT">实时编辑器</div><div class="playgroundEditor_RzvE"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BFC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">height</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setHeight</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> boxStyle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    width</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    backgroundColor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"green"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onClick</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"target"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">overflow</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hidden"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setHeight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetHeight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"skyblue"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">target</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript spread operator" style="color:#393A34">...</span><span class="token tag script language-javascript" style="color:#00009f">boxStyle</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> float</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"left"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">          父元素现在的高度是</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">height</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">br</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">点我撑开</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_MTMT">结果</div><div class="playgroundPreview_I3pO"><div>Loading...</div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>给元素加<code>border</code>也可以清除浮动</p></div></div><div class="playgroundContainer_CsNx"><div class="playgroundHeader_MTMT">实时编辑器</div><div class="playgroundEditor_RzvE"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BFC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> boxStyle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    width</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    backgroundColor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"green"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onClick</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"clear-float"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">overflow</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hidden"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript spread operator" style="color:#393A34">...</span><span class="token tag script language-javascript" style="color:#00009f">boxStyle</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> float</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"left"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"pink"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        我是float元素</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">clear-float</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"skyblue"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript spread operator" style="color:#393A34">...</span><span class="token tag script language-javascript" style="color:#00009f">boxStyle </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript spread operator" style="color:#393A34">...</span><span class="token tag script language-javascript" style="color:#00009f">boxStyle</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> margin</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">20</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">button</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        BFC区域不会与外部的float元素重叠</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_MTMT">结果</div><div class="playgroundPreview_I3pO"><div>Loading...</div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="playgroundContainer_CsNx"><div class="playgroundHeader_MTMT">实时编辑器</div><div class="playgroundEditor_RzvE"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BFC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bfcFlag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setBFCFlag</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">marginTop</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setMarginTop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">margin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setMargin</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> boxStyle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    width</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    backgroundColor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"green"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onClick</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setMargin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: number"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setMarginTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bfcFlag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bfcFlag</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createBFC</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> origin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"origin"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    origin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">overflow</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hidden"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setBFCFlag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript spread operator" style="color:#393A34">...</span><span class="token tag script language-javascript" style="color:#00009f">boxStyle </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">我的margin值是10px</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">origin</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript spread operator" style="color:#393A34">...</span><span class="token tag script language-javascript" style="color:#00009f">boxStyle</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"skyblue"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> margin </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">          我的margin值是</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">margin</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text">px，我与上面元素的距离是</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">          </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">span</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> color</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"red"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">marginTop</span><span class="token punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">span</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">px</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">button</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        第二个box的margin+5</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">createBFC</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">为第二个box创建BFC</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_MTMT">结果</div><div class="playgroundPreview_I3pO"><div>Loading...</div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="补充">补充<a href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC#%E8%A1%A5%E5%85%85" class="hash-link" aria-label="补充的直接链接" title="补充的直接链接">​</a></h2>
<p>当<code>div</code>元素嵌套时，如果父元素<code>padding</code>值为0，那么子元素的<code>margin-top</code>、<code>margin-bottom</code>就会「转移」为父元素的<code>margin-top</code>、<code>margin-bottom</code></p>
<details class="details_uSq5 alert alert--info details_gtVw" data-collapsed="true"><summary>点击查看代码</summary><div><div class="collapsibleContent_ief9"><div class="playgroundContainer_CsNx"><div class="playgroundHeader_MTMT">实时编辑器</div><div class="playgroundEditor_RzvE"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Demo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> width</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">100</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> height</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">100</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"pink"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> width</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">100</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> height</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">100</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"> backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"skyblue"</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">          </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">            width</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">50</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">            height</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">50</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">            backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"green"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">            margin</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">20</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">          </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span>
</span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_MTMT">结果</div><div class="playgroundPreview_I3pO"><div>Loading...</div></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/11/05/what-is-BFC#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/6844904006863552520" target="_blank" rel="noopener noreferrer">css面试点-BFC（块级格式化上下文）与常见布局方案</a></p>
<p><a href="https://www.cnblogs.com/skura23/articles/5813922.html" target="_blank" rel="noopener noreferrer">子元素margin-top失效不起作用的解决方法</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Block_formatting_context" target="_blank" rel="noopener noreferrer">Block Formatting Context</a></p>]]></content>
        <category label="css" term="css"/>
        <category label="html" term="html"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Webpack推荐阅读]]></title>
        <id>https://xpzero.github.io/blog/index/2023/10/31/recommend-read-webpack</id>
        <link href="https://xpzero.github.io/blog/index/2023/10/31/recommend-read-webpack"/>
        <updated>2023-10-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[从构建产物洞悉模块化原理]]></summary>
        <content type="html"><![CDATA[<p><a href="https://juejin.cn/post/7147365025047379981/" target="_blank" rel="noopener noreferrer">从构建产物洞悉模块化原理</a></p>
<p><a href="https://juejin.cn/post/7152516872330543141/" target="_blank" rel="noopener noreferrer">【Webpack】异步加载(懒加载)原理</a></p>
<p><a href="https://juejin.cn/post/7155151377013047304/" target="_blank" rel="noopener noreferrer">前端工程化基石——AST以及AST的广泛应用</a></p>
<p><a href="https://juejin.cn/post/7157739406835580965" target="_blank" rel="noopener noreferrer">【万字长文｜趣味图解】彻底弄懂Webpack中的Loader机制</a></p>
<p><a href="https://juejin.cn/post/7160467329334607908" target="_blank" rel="noopener noreferrer">【Webpack Plugin】写了个插件跟喜欢的女生表白，结果...</a></p>
<p><a href="https://juejin.cn/post/7164175171358556173" target="_blank" rel="noopener noreferrer">【中级/高级前端】为什么我建议你一定要读一读 Tapable 源码？</a></p>
<p><a href="https://juejin.cn/post/7166031357418668040" target="_blank" rel="noopener noreferrer">线上崩了？一招教你快速定位问题！</a></p>
<p><a href="https://juejin.cn/post/7170852747749621791" target="_blank" rel="noopener noreferrer">二十张图片彻底讲明白Webpack设计理念，以看懂为目的</a></p>
<p><a href="https://juejin.cn/post/7176963906844246074#comment" target="_blank" rel="noopener noreferrer">Webpack深度进阶：两张图彻底讲明白热更新原理！</a></p>]]></content>
        <category label="webpack" term="webpack"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[js中的事件循环机制]]></title>
        <id>https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js</id>
        <link href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js"/>
        <updated>2023-10-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[摘录事件循环机制知识点，备忘]]></summary>
        <content type="html"><![CDATA[<p>摘录事件循环机制知识点，备忘</p>
<blockquote>
<p>简单的说，事件循环（eventLoop）是单线程的JavaScript在处理异步事件时进行的一种循环过程。具体来讲，对于异步事件它会先加入到事件队列中挂起，等主线程空闲时会去执行事件队列中的事件。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="概念">概念<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E6%A6%82%E5%BF%B5" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="同步任务">同步任务<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1" class="hash-link" aria-label="同步任务的直接链接" title="同步任务的直接链接">​</a></h3>
<p>即主线程中正在排队执行的任务，一个任务执行完毕才能执行下一个任务。理解为是js执行调用栈中一个执行上下文为一个同步任务</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="异步任务">异步任务<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1" class="hash-link" aria-label="异步任务的直接链接" title="异步任务的直接链接">​</a></h3>
<p>指任务不立即进入主线程，只有当任务可以执行的时候才会进入主线程的任务。理解为js线程维护的消息队列中的任务</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="宏任务">宏任务<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E5%AE%8F%E4%BB%BB%E5%8A%A1" class="hash-link" aria-label="宏任务的直接链接" title="宏任务的直接链接">​</a></h3>
<ul>
<li>script脚本</li>
<li>定时器(setTimeout、setInterval、setImmediate)</li>
<li>用户交互事件</li>
<li>UI渲染</li>
<li>网络请求完成、文件读写完成事件等</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="微任务">微任务<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E5%BE%AE%E4%BB%BB%E5%8A%A1" class="hash-link" aria-label="微任务的直接链接" title="微任务的直接链接">​</a></h3>
<ul>
<li>Promise</li>
<li>async/await</li>
<li>MutationObserver</li>
<li>process.nextTick(node)等</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="宏任务与微任务">宏任务与微任务<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E5%AE%8F%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1" class="hash-link" aria-label="宏任务与微任务的直接链接" title="宏任务与微任务的直接链接">​</a></h2>
<p><img loading="lazy" alt="宏-微" src="https://xpzero.github.io/blog/assets/images/%E5%AE%8F-%E5%BE%AE-4963b4bbb4c61a39fcf0d58fe364ff96.png" width="1578" height="616" class="img_rmWR"></p>
<blockquote>
<p>通常把消息队列中的任务称为宏任务。每个宏任务中都包含了一个微任务队列，在执行宏任务的过程中产生了微任务(如，DOM变化触发的MutationObserver等)，js线程会将该变化添加到微任务队列中。
等宏任务中的主要功能都执行完成，即将要结束时，执行当前宏任务中的微任务队列中的所有微任务。待所有微任务执行完成，该宏任务也执行完成</p>
</blockquote>
<ul>
<li>微任务中产生的微任务会被放到当前宏任务的微任务队列尾部，也在本次宏任务中执行</li>
<li>一个宏任务中产生了新的宏任务和微任务，在这些新的任务中，微任务都早于宏任务的执行</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>执行调用栈中的任务可粗略理解为都是达到执行条件的js脚本，即宏任务或其中的微任务</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="任务执行流程">任务执行流程<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B" class="hash-link" aria-label="任务执行流程的直接链接" title="任务执行流程的直接链接">​</a></h2>
<p><img loading="lazy" alt="process" src="https://xpzero.github.io/blog/assets/images/process-c7268b32b4f2ea925c678c2eba90d98b.png" width="1332" height="960" class="img_rmWR"></p>
<ol>
<li>调用栈中所有内容即将执行完毕时，检查微任务队列</li>
<li>如有微任务，执行所有微任务，包括微任务产生的微任务。</li>
<li>所有微任务执行完毕，等待消息队列中的宏任务达到执行时机</li>
<li>消息队列中的某个宏任务达到执行时机</li>
<li>主线程将其放到调用栈中当作同步任务执行</li>
<li>期间产生的宏任务放到消息队列中，微任务放到当前调用栈中的微任务队列中</li>
<li>重复1-6</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/10/30/eventloop-of-js#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/7002037475874963493" target="_blank" rel="noopener noreferrer">一看就懂的事件循环机制(event loop)</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Event_loop" target="_blank" rel="noopener noreferrer">Event Loop</a></p>]]></content>
        <category label="js" term="js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[垃圾回收机制]]></title>
        <id>https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism</id>
        <link href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism"/>
        <updated>2023-10-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[摘录V8中的垃圾回收机制知识点,备忘]]></summary>
        <content type="html"><![CDATA[<p>摘录V8中的垃圾回收机制知识点,备忘</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="前置知识">前置知识<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86" class="hash-link" aria-label="前置知识的直接链接" title="前置知识的直接链接">​</a></h2>
<p>js中的数据类型有7个原始类型，一个引用类型</p>
<ul>
<li>原始类型<!-- -->
<ol>
<li>number</li>
<li>boolean</li>
<li>string</li>
<li>null</li>
<li>undefined</li>
<li>BigInt</li>
<li>Symbol</li>
</ol>
</li>
<li>引用类型<!-- -->
<ul>
<li>object</li>
</ul>
</li>
</ul>
<p>其中，原始类型的数据存储在js执行栈对应的执行上下文所占用的内存中，对象类型存储在浏览器内存的堆中，其地址被栈中的变量引用</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="栈中的数据">栈中的数据<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E6%A0%88%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE" class="hash-link" aria-label="栈中的数据的直接链接" title="栈中的数据的直接链接">​</a></h2>
<p>当js的执行栈中的执行上下文执行结束后，其所占用的内存会变为无效内存，之后会被其他进入栈中的执行上下文覆盖，另一种意义上就是销毁了其所占用的内存</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="堆中的数据">堆中的数据<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%A0%86%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE" class="hash-link" aria-label="堆中的数据的直接链接" title="堆中的数据的直接链接">​</a></h2>
<p>虽然在堆的数据引用地址在执行上下文被销毁的时候会被同步销毁，但是堆中实际存储的对象数据仍在内存中。V8使用垃圾回收机制来回收堆中的垃圾数据</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="v8中的垃圾回收">V8中的垃圾回收<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#v8%E4%B8%AD%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6" class="hash-link" aria-label="V8中的垃圾回收的直接链接" title="V8中的垃圾回收的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="代际假说">代际假说<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E4%BB%A3%E9%99%85%E5%81%87%E8%AF%B4" class="hash-link" aria-label="代际假说的直接链接" title="代际假说的直接链接">​</a></h4>
<p>后续的垃圾回收策略都建立在代际假说的基础上</p>
<ul>
<li>大部分对象都在内存中存在的时间很短。简而言之，很多对象一经分配内存，很快就变得不可访问了</li>
<li>不死的对象，会活的很久</li>
</ul>
<p>大多数动态语言都适用代际假说，比如Java、Python等</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="分类回收">分类回收<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%88%86%E7%B1%BB%E5%9B%9E%E6%94%B6" class="hash-link" aria-label="分类回收的直接链接" title="分类回收的直接链接">​</a></h4>
<p><img loading="lazy" alt="v8" src="https://xpzero.github.io/blog/assets/images/v8-61974c0f02a6e5571ca19cd4d78cd87f.bin" width="802" height="360" class="img_rmWR"></p>
<p>垃圾回收时，V8根据对象的大小和生存时间将堆分为：新生代、老生代。并将垃圾回收器根据新、老生代的不同分为副垃圾回收器、主垃圾回收器</p>
<ul>
<li>新生代</li>
</ul>
<p>存放生存时间短、相对小的对象</p>
<p>使用副垃圾回收器</p>
<p>容量一般为1～8M</p>
<ul>
<li>老生代</li>
</ul>
<p>存放生存时间长、相对大的对象</p>
<p>使用主垃圾回收器</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="垃圾回收器工作流程">垃圾回收器工作流程<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B" class="hash-link" aria-label="垃圾回收器工作流程的直接链接" title="垃圾回收器工作流程的直接链接">​</a></h4>
<p>活动对象：仍在使用的对象</p>
<p>非活动对象：可以进行垃圾回收的对象</p>
<ol>
<li>标记空间中的活动对象和非活动对象</li>
<li>回收非活动对象所占用的内存。即统一清理内存中所有被标记为可回收的对象</li>
<li>内存整理。频繁回收对象后，内存中出现的不连续的空间。内存整理即整理这些不连续的空间</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="副垃圾回收器">副垃圾回收器<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%89%AF%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8" class="hash-link" aria-label="副垃圾回收器的直接链接" title="副垃圾回收器的直接链接">​</a></h4>
<p>不进行内存整理，因为其不会产生内存碎片。</p>
<p>采用<code>Scavenage</code> 算法。将新生代区域分为对象区域、空闲区域。</p>
<ul>
<li>新加入的对象放在对象区域</li>
<li>当对象区域写满后，执行一次清理操作<!-- -->
<ul>
<li>标记对象区域中的垃圾</li>
<li>副垃圾回收器将活动对象有序复制到空闲区域，不会产生内存碎片</li>
<li>置换对象区域和空闲区域的角色。即原先的对象区域变成空闲区域，原先的空闲区域变成对象区域</li>
</ul>
</li>
</ul>
<p>对象复制需要时间成本，如果新生代的空间设置的太大，每次清理的时间就会很久，所以新生代空间一般设置的很小。</p>
<p><img loading="lazy" alt="second" src="https://xpzero.github.io/blog/assets/images/second-0fe3fafff7aca94b66ce1263cb597b2e.png" width="1112" height="358" class="img_rmWR">
为了不让内存清理过于频繁，V8引擎采用了对象晋升策略，即经过两次垃圾回收之后仍存活的对象会被移到老生代空间中</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="主垃圾回收器">主垃圾回收器<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E4%B8%BB%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8" class="hash-link" aria-label="主垃圾回收器的直接链接" title="主垃圾回收器的直接链接">​</a></h4>
<p>除了新生代晋升的对象，一些大的对象会被直接分配到老生代空间中</p>
<h5 class="anchor anchorWithStickyNavbar_IQQo" id="标记-清除">标记-清除<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4" class="hash-link" aria-label="标记-清除的直接链接" title="标记-清除的直接链接">​</a></h5>
<p>若仍使用<code>Scavenge</code> 算法，会导致执行效率不高，还会浪费一半空间。所以主垃圾回收器使用<code>标记-清除</code> 算法。</p>
<p>即，标记阶段从一组根元素开始，遍历这组根元素。遍历过程中，能到达的元素称为<strong>活动对象</strong>，没有到达的元素判断为<strong>垃圾数据</strong></p>
<blockquote>
<ul>
<li>
<p>垃圾回收器会在内部构建一个<code>根列表</code>，用于从根节点出发去寻找那些可以被访问到的变量。比如在JavaScript中，<code>window</code>全局对象可以看成一个根节点。</p>
</li>
<li>
<p>然后，垃圾回收器从所有根节点出发，遍历其可以访问到的子节点，并将其标记为活动的，根节点不能到达的地方即为非活动的，将会被视为垃圾。</p>
</li>
<li>
<p>最后，垃圾回收器将会释放所有非活动的内存块，并将其归还给操作系统。</p>
</li>
</ul>
<blockquote>
<p>以下几种情况都可以作为根节点：</p>
<ol>
<li>全局对象</li>
<li>本地函数的局部变量和参数</li>
<li>当前嵌套调用链上的其他函数的变量和参数</li>
</ol>
</blockquote>
</blockquote>
<p>经过<code>标记-清除</code> 算法处理后，可能会出现很多内存碎片，导致后面如果出现需要分配一个大对象而空闲内存不足以分配的情况，就会提前触发不必要的垃圾回收。</p>
<h5 class="anchor anchorWithStickyNavbar_IQQo" id="标记-整理">标记-整理<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86" class="hash-link" aria-label="标记-整理的直接链接" title="标记-整理的直接链接">​</a></h5>
<p><code>标记-整理</code> 算法的提出就是为了解决内存碎片化的问题。</p>
<p>在回收过程中将非活动对象清除后，进入整理过程，期间将活动对象往堆的一端进行移动，移动完成后再清理掉边界外的全部内存。</p>
<p>假设在老生代中有A、B、C、D四个对象</p>
<p><img loading="lazy" alt="clean1" src="data:image/png;base64,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" width="584" height="142" class="img_rmWR"></p>
<p>• 在垃圾回收的<code>标记</code>阶段，将对象A和对象C标记为活动的</p>
<p><img loading="lazy" alt="clean2" src="data:image/png;base64,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" width="584" height="142" class="img_rmWR"></p>
<p>• 在垃圾回收的<code>整理</code>阶段，将活动的对象往堆内存的一端移动</p>
<p><img loading="lazy" alt="clean3" src="data:image/png;base64,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" width="584" height="188" class="img_rmWR"></p>
<p>• 在垃圾回收的<code>清除</code>阶段，将活动对象左侧的内存全部回收</p>
<p><img loading="lazy" alt="clean4" src="data:image/png;base64,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" width="584" height="142" class="img_rmWR"></p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="全停顿">全停顿<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%85%A8%E5%81%9C%E9%A1%BF" class="hash-link" aria-label="全停顿的直接链接" title="全停顿的直接链接">​</a></h4>
<p>因为js的单线程机制，垃圾回收的过程会阻碍主线程同步任务的执行，待执行完垃圾回收后才会再次恢复执行主任务的逻辑，这种行为被称为<code>全停顿(stop-the-world)</code>。</p>
<p><img loading="lazy" alt="stop" src="https://xpzero.github.io/blog/assets/images/stop-ff83f993bee29fc8339ec172ebece81a.png" width="1142" height="332" class="img_rmWR"></p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="增量标记">增量标记<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%A2%9E%E9%87%8F%E6%A0%87%E8%AE%B0" class="hash-link" aria-label="增量标记的直接链接" title="增量标记的直接链接">​</a></h4>
<p>为了减少全停顿的时间，V8引擎引入了增量标记的概念。即将原本需要一次性遍历堆内存的操作改为增量标记的方式，先标记堆内存中的一部分对象，然后暂停，将执行权重新交给JS主线程，待主线程任务执行完毕后再从原来暂停标记的地方继续标记，直到标记完整个堆内存。</p>
<p><img loading="lazy" alt="add-stop" src="https://xpzero.github.io/blog/assets/images/add-stop-700ec0f667544709ad9121d399dbad1e.png" width="1142" height="366" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="引用计数过时">引用计数（过时）<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E8%BF%87%E6%97%B6" class="hash-link" aria-label="引用计数（过时）的直接链接" title="引用计数（过时）的直接链接">​</a></h3>
<p>是最早的一种垃圾回收算法。把对象是否不再需要定义为，对象有没有其他对象引用它。如果没有引用指向改对象(零引用)，对象会被垃圾回收机制回收。目前使用很少。</p>
<p>它的策略是跟踪记录每个变量被引用的次数。过程如下</p>
<ul>
<li>声明了一个变量(a)，将引用类型赋值给该变量(a)的时候，这个值(x)的引用次数为1</li>
<li>如果同一个值(x)又被赋值给另一个变量(b)，则其(x)引用次数加1</li>
<li>如果该变量(b)的值被其他的值覆盖，则其(x)引用次数减一</li>
<li>当这个值(x)的引用次数变为0时，说明没有变量使用该值，这个值已经是无效状态，其所占用的内存空间可以被回收。垃圾回收机制会在运行的时候清理掉引用次数为0的值所占用的内存。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="严重问题">严重问题<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E4%B8%A5%E9%87%8D%E9%97%AE%E9%A2%98" class="hash-link" aria-label="严重问题的直接链接" title="严重问题的直接链接">​</a></h4>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">A</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">B</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如上，A、B通过各自的属性相互引用着。按照上文的引用计数策略，它们的引用次数都是2。按理来说，test函数执行结束后A、B都是应该被清理掉的，但是因为引用计数的规则，它们不会被清理掉。若此函数在程序中被多次调用，就会造成大量的内存不会被释放。</p>
<p>换用<code>标记-清除</code> 的角度看一下。两个变量都是test函数的局部变量，当test函数执行完成后，其执行上下文会被清除，内部声明的局部变量也会随之清除。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="避免内存泄漏">避免内存泄漏<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E9%81%BF%E5%85%8D%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F" class="hash-link" aria-label="避免内存泄漏的直接链接" title="避免内存泄漏的直接链接">​</a></h2>
<ul>
<li>尽可能少地创建全局变量<!-- -->
<ul>
<li>当进行垃圾回收时，在标记阶段因为<code>window</code>对象可以作为根节点，在<code>window</code>上挂载的属性均可以被访问到，并将其标记为活动的从而常驻内存，因此也就不会被垃圾回收，只有在整个进程退出时全局作用域才会被销毁。</li>
</ul>
</li>
<li>手动清除定时器<!-- -->
<ul>
<li>如果定时器中引用了外部变量，因为定时器没有被清除，就会导致外部变量一直被引用，不会被清除</li>
</ul>
</li>
<li>少用闭包</li>
<li>清除DOM引用</li>
<li>使用弱引用</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/10/30/garbage-collection-mechanism#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://time.geekbang.org/column/article/131233?screen=full" target="_blank" rel="noopener noreferrer">13 | 垃圾回收：垃圾数据是如何自动回收的？</a></p>
<p><a href="https://juejin.cn/post/6844904016325902344" target="_blank" rel="noopener noreferrer">一文搞懂V8引擎的垃圾回收</a></p>
<p><a href="https://juejin.cn/post/6981588276356317214" target="_blank" rel="noopener noreferrer">「硬核JS」你真的了解垃圾回收机制吗</a></p>]]></content>
        <category label="js" term="js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[SSE的基本使用]]></title>
        <id>https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse</id>
        <link href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse"/>
        <updated>2023-10-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[工作中使用了SSE，对我来说是个新东西，这里记录下，备忘]]></summary>
        <content type="html"><![CDATA[<p>工作中使用了SSE，对我来说是个新东西，这里记录下，备忘</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="sse是什么">SSE是什么？<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#sse%E6%98%AF%E4%BB%80%E4%B9%88" class="hash-link" aria-label="SSE是什么？的直接链接" title="SSE是什么？的直接链接">​</a></h2>
<p>SSE全称Server-Sent Events,是一种在服务端主动推送数据给客户端的技术。</p>
<p>服务端与客户端建立连接后，只要服务端有数据更新就会将新数据以事件分发的形式通知给客户端，期间客户端只负责在对应的事件监听中接收数据即可。可实现类似ChatGPT吐字效果</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="如何使用sse">如何使用SSE？<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8sse" class="hash-link" aria-label="如何使用SSE？的直接链接" title="如何使用SSE？的直接链接">​</a></h2>
<p>SSE的使用需要服务端与客户端的配合，这里拆分来记录</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="代码">代码<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="代码的直接链接" title="代码的直接链接">​</a></h3>
<details class="details_uSq5 alert alert--info details_gtVw" data-collapsed="true"><summary>demo</summary><div><div class="collapsibleContent_ief9"><ol>
<li>使用<code>node server.js</code>启动服务端<br></li>
<li>注意观察log日志</li>
</ol><div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">index.html</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">server.js</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="language-html codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-html codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">doctype</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">content</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const content = document.getElementById("content");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const source = new EventSource("http://localhost:9000/sse");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source.onopen = (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.log("dev: source-open", e, source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source.onmessage = (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.log("dev: source-message", e, source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source.addEventListener("myEvent", (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.log("dev: source-myEvent", e, source, JSON.parse(e.data));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        content.innerHTML += `${e.data}</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">br</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source.onerror = (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.log("dev: source-error", e, source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        source.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">includes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/sse"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 如果请求 /events 路径，建立 SSE 连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeHead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Content-Type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"text/event-stream"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Cache-Control"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"no-cache"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">Connection</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"keep-alive"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"Access-Control-Allow-Origin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 允许跨域</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 每隔 1 秒发送一条消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> intervalId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">id: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">retry: 5000\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">: 我是注释\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">event: myEvent\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">test: asdf\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"?"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">time</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toISOString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">: 下面是最后一条\n数据\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">data: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation known-class-name class-name">JSON</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">stringify</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">\n\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        id</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">clearInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">intervalId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 当客户端关闭连接时停止发送消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"close"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">clearInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">intervalId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 如果请求的路径无效，返回 404 状态码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeHead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">9000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Server listening on port 9000"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="客户端">客户端<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E5%AE%A2%E6%88%B7%E7%AB%AF" class="hash-link" aria-label="客户端的直接链接" title="客户端的直接链接">​</a></h3>
<table><thead><tr><th>API</th><th>作用</th></tr></thead><tbody><tr><td>const source = new EventSource(接口地址)</td><td>创建SSE实例</td></tr><tr><td>source.onopen = (e: Event) =&gt; </td><td>建立连接</td></tr><tr><td>source.onerror = (e: Event) =&gt; </td><td>连接建立失败</td></tr><tr><td>source.addEventListener("服务端返回的事件名", (e: MessageEvent) =&gt; <!-- -->)</td><td>监听服务端数据推送。缺省为message</td></tr><tr><td>source.onmessage = (e: MessageEvent) =&gt; </td><td>同<code>addEventListener</code>。服务端推送自定义的事件名后，该事件失效</td></tr><tr><td>source.close()</td><td>断开连接（浏览器之后不会再尝试与服务端建立连接）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="服务端">服务端<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E6%9C%8D%E5%8A%A1%E7%AB%AF" class="hash-link" aria-label="服务端的直接链接" title="服务端的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="响应头">响应头<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E5%93%8D%E5%BA%94%E5%A4%B4" class="hash-link" aria-label="响应头的直接链接" title="响应头的直接链接">​</a></h4>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 指定服务端推送的数据类型为流数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/event-stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 客户端不缓存服务端推送的数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control: no-cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 保持TCP连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="数据格式">数据格式<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F" class="hash-link" aria-label="数据格式的直接链接" title="数据格式的直接链接">​</a></h4>
<p>服务端返回给<code>id</code>、<code>event</code>、<code>retry</code>、<code>data</code>四个字段即可，其余字段都会被忽略。</p>
<ul>
<li>id</li>
<li>
<blockquote>
<p>事件ID。事件的唯一标识符，浏览器会跟踪事件ID，如果发生断连，浏览器会把收到的最后一个事件ID放到 HTTP Header&nbsp;Last-Event-Id&nbsp;中进行重连，作为一种简单的同步机制。</p>
</blockquote>
</li>
<li>event<!-- -->
<ul>
<li>自定义事件名。客户端将该字段的值作为监听事件的名字。缺省为<code>message</code></li>
</ul>
</li>
<li>retry<!-- -->
<ul>
<li>事件的重试时间间隔</li>
</ul>
</li>
<li>data<!-- -->
<ul>
<li>事件的数据。文本数据的格式</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>注意</div><div class="admonitionContent_C26S"><p>字段以行为单位，<code>\n</code>结尾。最后一个字段以<code>\n\n</code>结尾</p><p>其中以冒号开头的行会被认为是注释，而被浏览器忽略</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="数据格式示例">数据格式示例<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="数据格式示例的直接链接" title="数据格式示例的直接链接">​</a></h4>
<div class="language-text codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">id: 1\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: 我是注释\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">event: myEvent\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retry: 5000\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: 最后一个字段以2个\n表示结束\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data: {"id":7,"time":"2023-10-27T09:34:55.773Z"}\n\n</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="与websocket的对比">与WebSocket的对比<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E4%B8%8Ewebsocket%E7%9A%84%E5%AF%B9%E6%AF%94" class="hash-link" aria-label="与WebSocket的对比的直接链接" title="与WebSocket的对比的直接链接">​</a></h2>
<table><thead><tr><th>Server-Sent Events</th><th>WebSocket</th></tr></thead><tbody><tr><td>基于HTTP协议</td><td>基于TCP协议</td></tr><tr><td>单工，只能服务端单向发送消息</td><td>全双工，服务端&amp;客户端可以同时发送和接收数据</td></tr><tr><td>轻量级，使用简单</td><td>相对复杂</td></tr><tr><td>内置断线重联和消息追踪功能</td><td>不在协议范围内，需手动实现</td></tr><tr><td>文本或base64和gzip压缩的二进制消息</td><td>类型广泛</td></tr><tr><td>支持自定义类型</td><td>不支持自定义事件类型</td></tr><tr><td>连接数HTTP/1.1是6个，HTTP/2可协商(默认100)</td><td>连接数无限制</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="与nginx配合注意">与Nginx配合注意<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E4%B8%8Enginx%E9%85%8D%E5%90%88%E6%B3%A8%E6%84%8F" class="hash-link" aria-label="与Nginx配合注意的直接链接" title="与Nginx配合注意的直接链接">​</a></h2>
<p>因为<code>Nginx</code>有缓存机制，当服务端推送数据经过<code>Nginx</code>时，会将数据缓存起来，达到指定缓存容量后才会推送给客户端。当客户端与服务端中间的<code>Nginx</code>过多时无法控制多层的<code>Nginx</code>都不缓存SSE数据，就会导致页面可能会出现数据突然一下全部出来的现象。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/10/28/how-to-use-sse#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/7221125237500330039" target="_blank" rel="noopener noreferrer">一文读懂即时更新方案：SSE</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events" target="_blank" rel="noopener noreferrer">Server-sent_events</a></p>
<p><a href="https://jermine.vdo.pub/web/sse%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3-%E4%BD%BF%E7%94%A8http%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%95%B0%E6%8D%AE%E6%8E%A8%E9%80%81%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF--%E5%8F%AF%E4%BD%9C%E4%B8%BAwebsocket%E7%9A%84%E8%BD%BB%E9%87%8F%E5%8C%96%E6%9B%BF%E6%8D%A2/" target="_blank" rel="noopener noreferrer">sse技术详解-使用http将服务端数据推送到客户端--可作为websocket的轻量化替换/</a></p>
<p><a href="https://zh.javascript.info/server-sent-events" target="_blank" rel="noopener noreferrer">Server Sent Events</a></p>]]></content>
        <category label="sse" term="sse"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[浏览器原理及安全]]></title>
        <id>https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security</id>
        <link href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security"/>
        <updated>2023-10-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[看到别人的总结一直「惊为天人」，就在这里以自己的视角记录一下]]></summary>
        <content type="html"><![CDATA[<p>看到别人的总结一直「惊为天人」，就在这里以自己的视角记录一下</p>
<!-- -->
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="前端缓存">前端缓存<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%89%8D%E7%AB%AF%E7%BC%93%E5%AD%98" class="hash-link" aria-label="前端缓存的直接链接" title="前端缓存的直接链接">​</a></h2>
<div class="myMarkmap_L_os"><svg width="auto" height="auto"></svg><div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="浏览器安全">浏览器安全<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8" class="hash-link" aria-label="浏览器安全的直接链接" title="浏览器安全的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="xss攻击">XSS攻击<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#xss%E6%94%BB%E5%87%BB" class="hash-link" aria-label="XSS攻击的直接链接" title="XSS攻击的直接链接">​</a></h3>
<p><code>Cross-Site Scripting</code>，跨站脚本攻击。攻击者在返回的<code>HTML</code>中嵌入脚本，从而拿到用户的信息并进行操作。</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="存储型">存储型<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%AD%98%E5%82%A8%E5%9E%8B" class="hash-link" aria-label="存储型的直接链接" title="存储型的直接链接">​</a></h4>
<p>将脚本存储到了数据库，客户端读取后直接执行脚本，达到攻击的效果</p>
<p>常见场景：评论区提交脚本内容，前后端没做好转义，直接存储到数据库。客户端每次读取都会执行脚本</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="反射型">反射型<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%8F%8D%E5%B0%84%E5%9E%8B" class="hash-link" aria-label="反射型的直接链接" title="反射型的直接链接">​</a></h4>
<p>恶意脚本作为请求URL的参数，浏览器解析后作为脚本执行</p>
<p>场景：服务端读取url的参数作为HTML的内容，将HTML返回给浏览器解析，浏览器解析过程中执行恶意脚本</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="文档型">文档型<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E6%96%87%E6%A1%A3%E5%9E%8B" class="hash-link" aria-label="文档型的直接链接" title="文档型的直接链接">​</a></h4>
<p>同<code>反射型</code>相似。区别在于：由前端JS脚本取出恶意代码并执行</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="防范措施">防范措施<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD" class="hash-link" aria-label="防范措施的直接链接" title="防范措施的直接链接">​</a></h4>
<ul>
<li>对用户提交的内容做转义</li>
<li>利用<code>HttpOnly</code>。在响应头中设置<code>Set-Cookie: HttpOnly</code>后，浏览器会禁止<code>JavaScript</code>脚本访问<code>Cookie</code>，使攻击无法使用<code>document.cookie</code>获取用户<code>Cookie</code></li>
<li>使用浏览器内容安全策略(CSP，Content Security Policy),只允许加载指定域的脚本及样式。<!-- -->
<ul>
<li>其有两种使用方式<!-- -->
<ul>
<li>服务端配置<code>Content-Security-Policy</code>的响应头</li>
</ul>
<div class="language-json codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-json codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">Content-Security-Policy</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> script-src 'self'; object-src 'none';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">style-src cdn.example.org third-party.org; child-src https</span><span class="token operator" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>使用<code>&lt;meta&gt;</code>标签：</li>
</ul>
<div class="language-html codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-html codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">Content-Security-Policy</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f"></span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到��剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>释义<!-- -->
<ul>
<li><code>script-src 'self'</code>：只信任当前域名的脚本</li>
<li><code>object-src 'none'</code>：不信任任何URL，即不加载任何资源</li>
<li><code>style-src cdn.example.org third-party.org</code>：只信任<code>cdn.example.org</code>和<code>third-party.org</code>下的样式表</li>
<li><code>child-src https</code>：必须使用<code>HTTPS</code>协议加载框架(frame)</li>
<li>其他来源：没有限制。更多可看参考连接</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="csrf">CSRF<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#csrf" class="hash-link" aria-label="CSRF的直接链接" title="CSRF的直接链接">​</a></h3>
<p><code>Cross-Site Request Forgery</code>，跨站请求伪造。诱导用户跳转恶意网站，利用用户的登录态向网站发起恶意请求</p>
<p>原理：<code>http</code>请求会自动携带<code>Cookie</code>，且是<code>Http</code>目标请求域名的<code>Cookie</code></p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="防范措施-1">防范措施<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD-1" class="hash-link" aria-label="防范措施的直接链接" title="防范措施的直接链接">​</a></h4>
<ul>
<li>SameSite: 在响应头中设置<code>Set-Cookie: SameSite=&lt;value&gt;</code>后，表示Cookie不随着跨域请求发送，可以很大程度减少CSRF的攻击；其有以下三个值<!-- -->
<ul>
<li>Strict（浏览器将只发送相同站点（完全一致）请求的 Cookie）</li>
<li>Lax（第三方get方法可以携带Cookie）</li>
<li>None （任何情况下都会发送 Cookie）。</li>
</ul>
</li>
<li>Origin 和 Referer：验证Referer是否是从第三方网站发出来的，阻止第三方网站请求接口，但是这两者可以通过ajax自定义请求头的方式被伪造；</li>
<li>CSRF Token：客户端向服务端请求token，然后在所有的请求中带上；</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>Chrome80 版本的 CSRF 例子</p><p>讲到 CSRF 的 cookie，不得不提一下 Chrome 80 版本的的一个默认设置；Chrome 80 版本将 SameSite 的值设置为了 Lax；这导致之前公司有一些业务产生了跨域；</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="点击劫持">点击劫持<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81" class="hash-link" aria-label="点击劫持的直接链接" title="点击劫持的直接链接">​</a></h3>
<p>通过<code>iframe</code>的方式，将网站嵌入自己的网站，诱导用户点击自己网站中的内容，以获取内嵌网站中的用户信息</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="防范措施-2">防范措施<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD-2" class="hash-link" aria-label="防范措施的直接链接" title="防范措施的直接链接">​</a></h4>
<ul>
<li>使用<code>X-Frame-Options</code>响应头。其有以下三个值<!-- -->
<ul>
<li>deny：表示页面不允许通过<code>iframe</code>的方式展示</li>
<li>sameorigin：表示页面可以在相同域名下通过<code>iframe</code>展示</li>
<li>allow-from：表示页面可以在指定来源的<code>iframe</code>中展示</li>
</ul>
</li>
<li>使用JS<!-- -->
<ul>
<li>判断网页的<code>self</code>和<code>top</code>是否相同</li>
<li>不同则将顶层(top)的location赋值为<code>self</code>的location</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="sql注入">SQL注入<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#sql%E6%B3%A8%E5%85%A5" class="hash-link" aria-label="SQL注入的直接链接" title="SQL注入的直接链接">​</a></h3>
<p>用户输入的内容被后端直接拼接到<code>SQL</code>语句上，导致一些恶意<code>SQL</code>的执行</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="防范措施-3">防范措施<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD-3" class="hash-link" aria-label="防范措施的直接链接" title="防范措施的直接链接">​</a></h4>
<ul>
<li>永远不要相信用户的输入，对用户输入进行校验</li>
<li>不进行<code>SQL</code>的动态拼接</li>
<li>不使用管理员权限连接数据库</li>
<li>加密机密信息</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="浏览器资源解析机制">浏览器资源解析机制<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B5%84%E6%BA%90%E8%A7%A3%E6%9E%90%E6%9C%BA%E5%88%B6" class="hash-link" aria-label="浏览器资源解析机制的直接链接" title="浏览器资源解析机制的直接链接">​</a></h2>
<p><img loading="lazy" alt="浏览器资源解析" src="https://xpzero.github.io/blog/assets/images/analysis-5b2d9e22d575e5e2c51525938dd70bd9.png" width="2406" height="956" class="img_rmWR"></p>
<p>如图。浏览器解析资源时遇到不同类型的资源有不同的处理</p>
<ul>
<li>css，不影响浏览器对HTML的解析</li>
<li>script脚本，浏览器会暂停对HTML的解析，转而下载和执行script脚本。脚本执行完成后再继续HTML的解析</li>
<li>带有async属性的script脚本，浏览器会继续解析HTML，直到async脚本下载完成后，暂停解析HTML，转而执行脚本。脚本执行完成后再继续HTML的解析</li>
<li>带有defer属性的script脚本，浏览器会在HTML解析完成后，按照含有defer属性的脚本顺序执行脚本内容</li>
<li>外联css会阻塞后面JS脚本的执行。<!-- -->
<blockquote>
<p>因为HTML5标准中有一项规定，浏览器在执行Script脚本前，必须保证当前的的外联CSS已经解析完成，因为JS可能会去获取或者变更DOM的CSS样式，如果此时外联CSS还没解析好，获取到的结果就是不准确的；</p>
</blockquote>
</li>
<li>解析遇到<code>img</code>图片，直接异步下载，不会阻塞解析。下载完毕后用图片替换原有src的地方</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="浏览器渲染机制">浏览器渲染机制<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6" class="hash-link" aria-label="浏览器渲染机制的直接链接" title="浏览器渲染机制的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="渲染流水线">渲染流水线<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E6%B8%B2%E6%9F%93%E6%B5%81%E6%B0%B4%E7%BA%BF" class="hash-link" aria-label="渲染流水线的直接链接" title="渲染流水线的直接链接">​</a></h3>
<p><img loading="lazy" alt="浏览器渲染机制" src="https://xpzero.github.io/blog/assets/images/chrome-render-3b7a9bb4c9abbed3a3b8cf208bf69f52.png" width="1896" height="786" class="img_rmWR"></p>
<ul>
<li>构建DOM树：浏览器<code>从上到下</code>解析HTML，生成树状DOM结构</li>
<li>构建styleSheets：浏览器解析HTML时遇到CSS内容时，会将CSS内容解析为styleSheets。<code>document.styleSheets</code>可查看其结构</li>
<li>构建布局树：遍历DOM树中的所有<code>可见元素</code>节点，并将这些节点添加到布局树中<!-- -->
<ul>
<li>仅包含<code>可见元素</code>。带有<code>display:none</code>的元素、<code>head</code>标签内的全部内容、script标签等都不在布局树中</li>
<li>各元素布局运算的结果会重新写回到布局树中</li>
</ul>
</li>
<li>构建图层树：渲染引擎会为特定的节点(3D变换、页面滚动、z-index等)生成专用的图层，并生成对应的一棵图层树<!-- -->
<ul>
<li>如果一个节点没有对应的层，该节点就从属于父节点的图层</li>
<li>独立层的条件(任一即可)<!-- -->
<ul>
<li>拥有层叠上下文属性。比如，定位(position)，透明(opacity)，css滤镜(filter)等</li>
<li>需要剪裁(clip)的地方。比如，元素内容过多，超过元素的宽高限制，仅显示部分内容的情况就产生了剪裁<!-- -->
<ul>
<li>文字部分会独立分层</li>
<li>如有滚动条，滚动条也是独立分层</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>图层绘制：渲染引擎对图层树中的每个图层进行绘制<!-- -->
<ul>
<li>图块，即将图层拆分成小块儿，就像吃东西要一口一口吃一样。</li>
<li>优先将视口附近的图块生成位图。实际生成位图的操作由栅格化执行<!-- -->
<ul>
<li>视口：屏幕上的可见区域。如页面有滚动条，直接看到的部分就是视口，需要滚动才能看到的地方就不属于视口。如没有滚动条，所有显示部分即为视口</li>
</ul>
</li>
<li>栅格化：将图块转为位图。<!-- -->
<ul>
<li>图块时栅格化执行的最小单位</li>
<li>渲染进程维护了一个栅格化线程池，所有图块的栅格化都在线程池内执行</li>
<li>栅格化会通过GPU加速生成，使用GPU生成位图的过程叫快速栅格化或GPU栅格化，生成的位图保存在GPU内存中</li>
</ul>
</li>
</ul>
</li>
<li>合成和显示：所有图块栅格化后，合成线程生成图块绘制命令，并提交给浏览器进程绘制页面</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="回流重排重绘合成">回流(重排)、重绘、合成<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%9B%9E%E6%B5%81%E9%87%8D%E6%8E%92%E9%87%8D%E7%BB%98%E5%90%88%E6%88%90" class="hash-link" aria-label="回流(重排)、重绘、合成的直接链接" title="回流(重排)、重绘、合成的直接链接">​</a></h3>
<p>常在性能优化中涉及。性能优化效果依次递减: <code>合成 =&gt; 重绘 =&gt; 重排</code></p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="回流重排">回流(重排)<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%9B%9E%E6%B5%81%E9%87%8D%E6%8E%92" class="hash-link" aria-label="回流(重排)的直接链接" title="回流(重排)的直接链接">​</a></h4>
<p>通过JS或CSS修改元素的几何位置属性，比如改变元素的宽高等，让元素的布局发生变化，回想渲染流水线，就需要重新构建布局树，即为重排</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="重绘">重绘<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E9%87%8D%E7%BB%98" class="hash-link" aria-label="重绘的直接链接" title="重绘的直接链接">​</a></h4>
<p>仅改变元素的背景色等不涉及元素位置的变化的属性，此时元素的位置没有发生变化就会直接进入<code>图层绘制</code>阶段，即为重绘。</p>
<p>因为省去了<code>构建布局树</code>、<code>构建图层树</code>的阶段，所有执行效率比重排要高</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="合成">合成<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%90%88%E6%88%90" class="hash-link" aria-label="合成的直接链接" title="合成的直接链接">​</a></h4>
<p>使用<code>transform</code>属性来实现动画效果，可以避开重排和重绘阶段，效率较其二者更高。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="js脚本如何阻塞dom的构建">JS脚本如何阻塞DOM的构建<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#js%E8%84%9A%E6%9C%AC%E5%A6%82%E4%BD%95%E9%98%BB%E5%A1%9Edom%E7%9A%84%E6%9E%84%E5%BB%BA" class="hash-link" aria-label="JS脚本如何阻塞DOM的构建的直接链接" title="JS脚本如何阻塞DOM的构建的直接链接">​</a></h3>
<p>HTML解析器发现JS脚本后会暂停DOM的解析，因为JS脚本可能影响已经生成的DOM的结构。如果是外链脚本，还要考虑网络环境，脚本的大小等情况</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>渲染引擎有预解析的文件的优化处理，当渲染引擎收到网络进程传递的字节流时，会开启一个预解析线程，用来分析HTML文件中包含的JS、CSS等文件。解析到后，预解析线程会提前下载这些文件</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="css如何阻塞dom的构建">CSS如何阻塞DOM的构建<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#css%E5%A6%82%E4%BD%95%E9%98%BB%E5%A1%9Edom%E7%9A%84%E6%9E%84%E5%BB%BA" class="hash-link" aria-label="CSS如何阻塞DOM的构建的直接链接" title="CSS如何阻塞DOM的构建的直接链接">​</a></h3>
<p>因为JS脚本中可能会对DOM的样式属性进行修改，所以在JS脚本执行之前，需要等待CSS的解析，继而间接影响DOM的构建</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="跨域">跨域<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E8%B7%A8%E5%9F%9F" class="hash-link" aria-label="跨域的直接链接" title="跨域的直接链接">​</a></h2>
<p>同源策略：<code>协议</code>、<code>域名</code>、<code>端口号</code>，三者都一致即为同源；否则为跨源，即跨域</p>
<p>跨域对脚本的限制</p>
<ul>
<li>无法获取<code>Cookie</code>、<code>LocalStorage</code>、<code>IndexedDB</code>中的数据</li>
<li>无法读取<code>DOM</code></li>
<li>不能发送<code>AJAX</code>请求</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="jsonpget">JSONP(get)<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#jsonpget" class="hash-link" aria-label="JSONP(get)的直接链接" title="JSONP(get)的直接链接">​</a></h3>
<p>原理：利用<code>&lt;script&gt;</code>标签没有跨域限制</p>
<ul>
<li>前端添加<code>&lt;script&gt;</code>标签，<code>src</code>中是对服务端的请求，需要携带一个参数，让服务端识别</li>
<li>前端定义一个全局函数，函数名为之前携带参数中的值的名字</li>
<li>服务端拼接回调函数和参数，以<code>JS</code>类型返回</li>
</ul>
<details class="details_uSq5 alert alert--info details_gtVw" data-collapsed="true"><summary>代码示例</summary><div><div class="collapsibleContent_ief9"><blockquote>
<p>当浏览器接受到服务器端返回的回调函数时会在浏览器环境寻找callbackFun函数，并执行</p>
</blockquote><div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">html</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">js</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="language-html codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-html codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">doctype</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 定义全局变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      var cbData = {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 定义全局函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      var callbackFun = (res) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cbData = res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert(cbData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">http://127.0.0.1:1337/cb?callback=callbackFun</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"url"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 将请求req中的url进行解析</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> urlObj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeHead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"Content-Type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"text/plain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 返回callback对应的方法名和通过JSON.stringify处理过的数据拼接而成的字符串</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">urlObj</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">query</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">callback</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation known-class-name class-name">JSON</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">stringify</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">{</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation literal-property property" style="color:#36acaa">name</span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">"qb"</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation literal-property property" style="color:#36acaa">age</span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa">30</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">)</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1337</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"127.0.0.1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="cors">CORS<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#cors" class="hash-link" aria-label="CORS的直接链接" title="CORS的直接链接">​</a></h3>
<blockquote>
<p>通信过程由浏览器自动完成，不需要用户参与</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="请求步骤">请求步骤<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E8%AF%B7%E6%B1%82%E6%AD%A5%E9%AA%A4" class="hash-link" aria-label="请求步骤的直接链接" title="请求步骤的直接链接">​</a></h4>
<ul>
<li>发起跨域请求时，判断是否是复杂请求<!-- -->
<ul>
<li>复杂请求，浏览器会自动发出预检请求，即发出<code>Options</code>请求，用于确认目标资源是否支持跨域<!-- -->
<ul>
<li>在浏览器发出预检请求时，会携带<code>Access-Control-Request-Method</code>请求头，
表示在实际发出请求时将用什么请求方法</li>
</ul>
</li>
<li>简单请求，直接发出正常请求</li>
</ul>
</li>
<li>浏览器会根据服务端的响应头<code>Access-Control-Allow-Origin</code>的值判断是否支持跨域。<!-- -->
<ul>
<li>若支持，则正常发出请求</li>
<li>不支持，则在控制台显示错误信息</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>同时满足以下条件，即为简单请求</p><ul>
<li>使用的请求方法为<!-- -->
<ul>
<li>get、post、head</li>
</ul>
</li>
<li>请求头只包含安全信息<!-- -->
<ul>
<li>Accept、Accept-Language、Content-Type、Content-Language</li>
</ul>
</li>
<li>Content-Type的值仅限于<!-- -->
<ul>
<li>text/plain、multipart/form-data、application/x-www-form-urlencoded</li>
</ul>
</li>
</ul><p>不符合以上条件者，均为复杂请求</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="postmessage">postMessage<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#postmessage" class="hash-link" aria-label="postMessage的直接链接" title="postMessage的直接链接">​</a></h3>
<p>通过<code>window.postMessage()</code>方法，可以实现安全的跨域通信。</p>
<details class="details_uSq5 alert alert--info details_gtVw" data-collapsed="true"><summary>代码示例</summary><div><div class="collapsibleContent_ief9"><div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">main</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">receive</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="language-html codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-html codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">doctype</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">button</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">btn</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">点我打开另一个页面</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">button</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">btn2</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">点我给另一个页面发送消息</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let refer = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      document.getElementById("btn").addEventListener("click", function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        refer = window.open("./receive.html");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      document.getElementById("btn2").addEventListener("click", function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        refer.postMessage("hello", "*");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="language-html codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-html codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">doctype</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    received message is </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">span</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">msg</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">span</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const msg = document.getElementById("msg");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      window.addEventListener("message", (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg.innerText = e.data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nginx">Nginx<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#nginx" class="hash-link" aria-label="Nginx的直接链接" title="Nginx的直接链接">​</a></h3>
<p>只需要在<code>Nginx</code>中配置以下参数即可</p>
<div class="language-conf codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-conf codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_header Access-Control-Allow-Origin *;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($request_method = 'OPTIONS') {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 204;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="前端路由">前端路由<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1" class="hash-link" aria-label="前端路由的直接链接" title="前端路由的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="hash">hash<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#hash" class="hash-link" aria-label="hash的直接链接" title="hash的直接链接">​</a></h3>
<p>即浏览器URL中<code>#</code>及之后的内容，可通过<code>window.location.hash</code>获取。</p>
<p>当<code>hash</code>变化后会触发<code>onhashchange</code>事件，以此可实现监听浏览器地址中的<code>hash</code>的变化并使用<code>JavaScript</code>切换页面内容的效果</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>hash值变化，不会重新加载页面，只是浏览器地址栏中的hash值变化而已。但会触发<code>onhashchange</code>事件</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="history">history<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#history" class="hash-link" aria-label="history的直接链接" title="history的直接链接">​</a></h3>
<p>即<code>window.history</code>，是<code>History</code>对象，表示当前窗口的浏览历史。浏览器工具栏中的<code>前进</code>和<code>后退</code>按钮，就是对<code>History</code>对象操作</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>当<code>history</code>发生变化时，只会改变页面路径，不会刷新页面。</p><p>脚本不允许访问<code>history</code>中的地址，但允许在地址间导航</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="跨页签多tab通信">跨页签&amp;多tab通信<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E8%B7%A8%E9%A1%B5%E7%AD%BE%E5%A4%9Atab%E9%80%9A%E4%BF%A1" class="hash-link" aria-label="跨页签&amp;多tab通信的直接链接" title="跨页签&amp;多tab通信的直接链接">​</a></h2>
<ul>
<li>同域下使用<code>localStorage</code>共享数据<!-- -->
<ul>
<li>使用<code>window.addEventListener('storage')</code>监听数据的变化<!-- -->
<ul>
<li>重复写入的值无法触发事件</li>
<li>会受到浏览器隐身模式等的限制</li>
</ul>
</li>
</ul>
</li>
<li><code>WebSocket</code>配合服务端</li>
<li><code>Service Worker</code></li>
<li><code>IndexedDB</code>，浏览器实现的数据库。使用<code>共享存储</code>和<code>轮询</code>的方式监听数据变化</li>
<li>通过父页面的<code>window.open()</code>和子页面的<code>postMessage</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="事件机制">事件机制<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6" class="hash-link" aria-label="事件机制的直接链接" title="事件机制的直接链接">​</a></h2>
<p>事件捕获 -&gt; 目标阶段（事件处理） -&gt; 事件冒泡</p>
<p><img loading="lazy" alt="事件" src="https://xpzero.github.io/blog/assets/images/event-5386cdc0147c260f2876b875dde403b4.png" width="846" height="832" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="事件捕获">事件捕获<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7" class="hash-link" aria-label="事件捕获的直接链接" title="事件捕获的直接链接">​</a></h3>
<p>从<code>window</code>开始向下走近触发绑定事件的元素</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="事件冒泡">事件冒泡<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1" class="hash-link" aria-label="事件冒泡的直接链接" title="事件冒泡的直接链接">​</a></h3>
<p>从绑定事件的元素开始向上直到<code>window</code></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="事件委托">事件委托<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E4%BA%8B%E4%BB%B6%E5%A7%94%E6%89%98" class="hash-link" aria-label="事件委托的直接链接" title="事件委托的直接链接">​</a></h3>
<p>利用事件冒泡机制，将事件的处理放在父元素身上，以减少内存的使用</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="target与currenttarget的区别">target与currentTarget的区别<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#target%E4%B8%8Ecurrenttarget%E7%9A%84%E5%8C%BA%E5%88%AB" class="hash-link" aria-label="target与currentTarget的区别的直接链接" title="target与currentTarget的区别的直接链接">​</a></h3>
<ul>
<li>target：表示当前触发事件的元素。如果是事件委托处理，那么target很有可能不是currentTarget</li>
<li>currentTarget：表示绑定事件的元素</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="阻止事件的执行">阻止事件的执行<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E9%98%BB%E6%AD%A2%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C" class="hash-link" aria-label="阻止事件的执行的直接链接" title="阻止事件的执行的直接链接">​</a></h3>
<ul>
<li>阻止事件冒泡、捕获: <code>e.stopPropagation()</code></li>
<li>阻止元素上与当前事件类型一样的还未执行的所有其他事件的执行: <code>e.stopImmediatePropagation()</code></li>
<li>阻止事件的默认行为(如，a标签的跳转行为): <code>e.preventDefault()</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/10/22/browser-principle-security#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/7168637354536599559" target="_blank" rel="noopener noreferrer">「2022」寒冬下我的面试知识点复盘【浏览器原理&amp;安全】</a></p>
<p><a href="https://juejin.cn/post/7127194919235485733" target="_blank" rel="noopener noreferrer">中高级前端工程师都需要熟悉的技能</a></p>
<p><a href="https://zh.javascript.info/bubbling-and-capturing" target="_blank" rel="noopener noreferrer">冒泡和捕获</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener noreferrer">Content Security Policy入门教程</a></p>
<p><a href="https://juejin.cn/post/7164039512211849223" target="_blank" rel="noopener noreferrer">一看就会的JSONP前后端实现</a></p>
<p><a href="https://segmentfault.com/a/1190000012550346" target="_blank" rel="noopener noreferrer">Nginx配置跨域请求 Access-Control-Allow-Origin</a></p>
<p><a href="https://time.geekbang.org/column/intro/100033601?tab=catalog" target="_blank" rel="noopener noreferrer">李兵-浏览器工作原理与实践</a></p>]]></content>
        <category label="浏览器原理" term="浏览器原理"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[React渲染原理]]></title>
        <id>https://xpzero.github.io/blog/index/2023/10/21/about-react-render</id>
        <link href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render"/>
        <updated>2023-10-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[看过n次，了解过n次，总是忘记，记录住！]]></summary>
        <content type="html"><![CDATA[<p>看过n次，了解过n次，总是忘记，记录住！</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>React版本为16+</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="生命周期">生命周期<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" class="hash-link" aria-label="生命周期的直接链接" title="生命周期的直接链接">​</a></h2>
<p><img loading="lazy" alt="生命周期" src="https://xpzero.github.io/blog/assets/images/lifecycle-405cdf9cc21d85a0c471fb8f4308543e.webp" width="1512" height="824" class="img_rmWR"></p>
<details class="details_uSq5 alert alert--info details_gtVw" data-collapsed="true"><summary>下面使用的nextProps、nextState、prevProps、prevState是什么?</summary><div><div class="collapsibleContent_ief9"><p>打开控制台，观察<code>dev:</code>的日志输出</p><ul>
<li>prevProps、prevState: 都是更新前的props、state</li>
<li>nextProps、nextState: 都是更新后(最新)的props、state</li>
</ul><div class="playgroundContainer_CsNx"><div class="playgroundHeader_MTMT">实时编辑器</div><div class="playgroundEditor_RzvE"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">getSnapshopBeforeUpdate</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">shouldComponentUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: shouldComponentUpdate"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">componentDidMount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: componentDidMount"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">my-test</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        My name is </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"> and I am</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">age</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">age</span><span class="token punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">hr</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript keyword" style="color:#00009f">this</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript method function property-access" style="color:#d73a49">setState</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"> age</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript keyword" style="color:#00009f">this</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">state</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">age</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">+</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">1</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">          点我长大</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">getSnapshotBeforeUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prevProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: getSnapshotBeforeUpdate"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"dev: getcontent"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"my-test"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clientHeight</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">componentDidUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prevProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> snapshot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: componentDidUpdate"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prevState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> snapshot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">componentWillUnmount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: componentWillUnmount"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_MTMT">结果</div><div class="playgroundPreview_I3pO"><div>Loading...</div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="constructor初始化">constructor初始化<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#constructor%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="constructor初始化的直接链接" title="constructor初始化的直接链接">​</a></h3>
<p>一个类组件对象在整个渲染过程中只会运行一次。如果一个类组件被多次创建，其<code>constructor</code>互不干扰</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="static-getderivedstatefrompropsprops-state获取组件最新的属性和状态">static getDerivedStateFromProps(props, state)获取组件最新的属性和状态<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#static-getderivedstatefrompropsprops-state%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6%E6%9C%80%E6%96%B0%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E7%8A%B6%E6%80%81" class="hash-link" aria-label="static getDerivedStateFromProps(props, state)获取组件最新的属性和状态的直接链接" title="static getDerivedStateFromProps(props, state)获取组件最新的属性和状态的直接链接">​</a></h3>
<p>主要用来取代<code>componentWillMount</code>和<code>componentWillReceiveProps</code></p>
<ul>
<li>props 类组件当前的props<!-- -->
<ul>
<li>在首次挂载时，可以认为是父组件传递给当前类组件的属性</li>
</ul>
</li>
<li>state 类组件当前的state<!-- -->
<ul>
<li>在首次挂载时，可以认为是当前类组件的初始化状态</li>
</ul>
</li>
</ul>
<p>其返回值会<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">浅</span>合并到<code>state</code>中。如果返回值为非<code>object</code>类型，则返回值会被忽略</p>
<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">该方法不常用</span>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="render创建fiber">render创建fiber<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#render%E5%88%9B%E5%BB%BAfiber" class="hash-link" aria-label="render创建fiber的直接链接" title="render创建fiber的直接链接">​</a></h3>
<p><code>render</code>方法执行之后，<code>React</code>会创建<code>fiber</code></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="componentdidmount挂载到页面">componentDidMount挂载到页面<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#componentdidmount%E6%8C%82%E8%BD%BD%E5%88%B0%E9%A1%B5%E9%9D%A2" class="hash-link" aria-label="componentDidMount挂载到页面的直接链接" title="componentDidMount挂载到页面的直接链接">​</a></h3>
<p>该方法只会执行一次。首次挂载组件，<code>fiber</code>被渲染到页面后执行</p>
<p>通常做一些不影响页面渲染的操作，比如发起网络请求、获取真实DOM、开启定时器等</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="shouldcomponentupdatenextprops-nextstate-boolean是否重新渲染">shouldComponentUpdate(nextProps, nextState): boolean是否重新渲染<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#shouldcomponentupdatenextprops-nextstate-boolean%E6%98%AF%E5%90%A6%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93" class="hash-link" aria-label="shouldComponentUpdate(nextProps, nextState): boolean是否重新渲染的��直接链接" title="shouldComponentUpdate(nextProps, nextState): boolean是否重新渲染的直接链接">​</a></h3>
<p>在更新组件时，用来做性能优化。可以根据最新的props（nextProps)、state(nextState)，做一些判断组件是否应该更新的处理。<code>React</code>会依其返回值，来决定组件是否更新，以减少页面渲染次数，达到性能优化的目的.</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p><code>React</code>官方提供了一个HOC，即<code>PureComponent</code>。其内部会自动做浅比较优化。</p><p>继承<code>PureComponent</code>后不需要再使用<code>shouldComponentUpdate</code>进行优化</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="getsnapshotbeforeupdateprevprops-prevstate获取更新之前的状态">getSnapshotBeforeUpdate(prevProps, prevState)获取更新之前的状态<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#getsnapshotbeforeupdateprevprops-prevstate%E8%8E%B7%E5%8F%96%E6%9B%B4%E6%96%B0%E4%B9%8B%E5%89%8D%E7%9A%84%E7%8A%B6%E6%80%81" class="hash-link" aria-label="getSnapshotBeforeUpdate(prevProps, prevState)获取更新之前的状态的直接链接" title="getSnapshotBeforeUpdate(prevProps, prevState)获取更新之前的状态的直接链接">​</a></h3>
<p>执行到该方式时，<code>React</code>已经将最新的真实DOM构建完成，但还未渲染到页面中，所以这里拿到的DOM是<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">旧</span>的。</p>
<blockquote>
<p>可以理解为更新前的快照，通常用来做一些附加的DOM操作。</p>
</blockquote>
<p>其返回值会作为<code>componentDidUpdate</code>的第三个参数</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="componentdidupdateprevprops-prevstate-snapshot更新完成后的回调">componentDidUpdate(prevProps, prevState, snapshot)更新完成后的回调<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#componentdidupdateprevprops-prevstate-snapshot%E6%9B%B4%E6%96%B0%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84%E5%9B%9E%E8%B0%83" class="hash-link" aria-label="componentDidUpdate(prevProps, prevState, snapshot)更新完成后的回调的直接链接" title="componentDidUpdate(prevProps, prevState, snapshot)更新完成后的回调的直接链接">​</a></h3>
<p>执行到该方法时，真实DOM已经被渲染到页面中。</p>
<ul>
<li>snapshot: getSnapshotBeforeUpdate的返回值</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="componentwillunmount-组件将要卸载时的回调">componentWillUnmount() 组件将要卸载时的回调<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#componentwillunmount-%E7%BB%84%E4%BB%B6%E5%B0%86%E8%A6%81%E5%8D%B8%E8%BD%BD%E6%97%B6%E7%9A%84%E5%9B%9E%E8%B0%83" class="hash-link" aria-label="componentWillUnmount() 组件将要卸载时的回调的直接链接" title="componentWillUnmount() 组件将要卸载时的回调的直接链接">​</a></h3>
<p>常用来做一些副作用的清除操作。比如取消事件监听、清除定时器等</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="react中的元素">React中的元素<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#react%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0" class="hash-link" aria-label="React中的元素的直接链接" title="React中的元素的直接链接">​</a></h2>
<table><thead><tr><th>名称</th><th>来源</th><th>备注</th></tr></thead><tbody><tr><td>宿主元素</td><td>浏览器、Nodejs等</td><td>浏览器中的标签元素</td></tr><tr><td>虚拟DOM元素</td><td>React</td><td>使用jsx编写的类宿主元素</td></tr><tr><td>组件元素</td><td>React</td><td>类/函数组件</td></tr><tr><td>文本元素</td><td>React</td><td>字符串/数字等</td></tr><tr><td>空元素</td><td>React</td><td>- null、undefined、false、true<br>均会被创建为一个空元素。渲染时遇到空元素什么也不做</td></tr><tr><td>数组元素</td><td>React</td><td>React会根据其内的每一项元素的类型做对应的事情</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>React的工作是通过宿主元素或可以生成虚拟节点的东西生成虚拟节点，然后针对不同的节点类型去做不同的事情，最终生成真实DOM挂载到页面上！所以对象不能直接被渲染，因为它生成不了虚拟节点。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="组件渲染demo">组件渲染Demo<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93demo" class="hash-link" aria-label="组件渲染Demo的直接链接" title="组件渲染Demo的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="首次挂载">首次挂载<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E9%A6%96%E6%AC%A1%E6%8C%82%E8%BD%BD" class="hash-link" aria-label="首次挂载的直接链接" title="首次挂载的直接链接">​</a></h3>
<details class="details_uSq5 alert alert--info details_gtVw" data-collapsed="true"><summary>代码🌰</summary><div><div class="collapsibleContent_ief9"><div class="language-jsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-jsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react-dom/client"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"root"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  组件节点-类组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ClassSon</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"444 ClassSon constructor"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getDerivedStateFromProps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"555 ClassSon getDerivedStateFromProps"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">componentDidMount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"666 ClassSon componentDidMount"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">className</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">func-wrapper</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">span</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">          textNode22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">span</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">[</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"textNode33"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">textNode44</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  组件节点-类组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ClassComp</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"111 ClassComp constructor"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getDerivedStateFromProps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"222 ClassComp getDerivedStateFromProps"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">componentDidMount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"333 ClassComp componentDidMount"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">className</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">class-wrapper</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">ClassSon</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">textNode11</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">123456789</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">ClassComp</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="图解">图解<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E5%9B%BE%E8%A7%A3" class="hash-link" aria-label="图解的直接链接" title="图解的直接链接">​</a></h4>
<p><img loading="lazy" alt="首次挂载" src="https://xpzero.github.io/blog/assets/images/first-render-72134231fc14f90ecad92817ff627a9e.webp" width="1512" height="806" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="更新和卸载">更新和卸载<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E6%9B%B4%E6%96%B0%E5%92%8C%E5%8D%B8%E8%BD%BD" class="hash-link" aria-label="更新和卸载的直接链接" title="更新和卸载的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="diff小结">diff小结<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#diff%E5%B0%8F%E7%BB%93" class="hash-link" aria-label="diff小结的直接链接" title="diff小结的直接链接">​</a></h4>
<ul>
<li>找到旧树中对应位置进行比较</li>
<li>新旧节点类型不同，直接卸载丢弃旧树，重新创建新的节点</li>
<li>数组元素中的兄弟节点间通过<code>key</code>进行唯一标识</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="数组元素中key的作用">数组元素中key的作用<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E4%B8%ADkey%E7%9A%84%E4%BD%9C%E7%94%A8" class="hash-link" aria-label="数组元素中key的作用的直接链接" title="数组元素中key的作用的直接链接">​</a></h4>
<p>为了提高节点复用率。如果某个数组元素下的组件内容尤其多，使用key可以减少树递归等处理，以实现性能优化</p>
<h5 class="anchor anchorWithStickyNavbar_IQQo" id="未使用key">未使用key<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E6%9C%AA%E4%BD%BF%E7%94%A8key" class="hash-link" aria-label="未使用key的直接链接" title="未使用key的直接链接">​</a></h5>
<p><img loading="lazy" alt="未使用key" src="https://xpzero.github.io/blog/assets/images/unused-key-70114d8e81b50e388142e3866423531d.webp" width="823" height="636" class="img_rmWR"></p>
<h5 class="anchor anchorWithStickyNavbar_IQQo" id="使用key">使用key<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E4%BD%BF%E7%94%A8key" class="hash-link" aria-label="使用key的直接链接" title="使用key的直接链接">​</a></h5>
<p><img loading="lazy" alt="使用key" src="https://xpzero.github.io/blog/assets/images/used-key-738dd795f824f6243065081024edd354.webp" width="823" height="636" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="条件渲染">条件渲染<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93" class="hash-link" aria-label="条件渲染的直接链接" title="条件渲染的直接链接">​</a></h3>
<blockquote>
<p>尽量保持结构的稳定性，如果未添加key的情况下，兄弟节点更新位置前后错位一个那么后续全部的比较都会错位导致找不到对比目标从而进行卸载、新建流程，对性能大打折扣。</p>
</blockquote>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>在进行条件渲染显示隐藏时，官方推荐以下做法：</p><p>控制style：visibility来控制显示隐藏。
在隐藏时给一个空节点来保证对比前后能找到同一位置。不影响后续兄弟节点的比较。</p><div class="language-jsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-jsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">flag </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/10/21/about-react-render#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/7121378029682556958" target="_blank" rel="noopener noreferrer">「万字总结」🍒动画 + 大白话讲清楚React渲染原理</a></p>]]></content>
        <category label="react" term="react"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[常用git命令]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/27/git-command</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/27/git-command"/>
        <updated>2023-09-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[git常用命令备忘]]></summary>
        <content type="html"><![CDATA[<p>git常用命令备忘</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>git版本：2.42.0</p></div></div>
<p><img loading="lazy" alt="process" src="https://xpzero.github.io/blog/assets/images/process-7f75f5a86099448f8a06fb9738cdf28a.png" width="1172" height="340" class="img_rmWR"></p>
<blockquote>
<p>术语</p>
<ul>
<li>Workspace：工作区/工作树</li>
<li>Index / Stage：索引/暂存区</li>
<li>Repository：仓库区（或本地仓库）</li>
<li>Remote：远程仓库</li>
</ul>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="基本命令">基本命令<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4" class="hash-link" aria-label="基本命令的直接链接" title="基本命令的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="添加">添加<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E6%B7%BB%E5%8A%A0" class="hash-link" aria-label="添加的直接链接" title="添加的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 在当前目录初始化仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 添加变动到暂存区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">filepattern</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 添加当前目录下的所有变动到暂存区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 添加工作树中的所有变动到暂存区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-A</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="提交">提交<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E6%8F%90%E4%BA%A4" class="hash-link" aria-label="提交的直接链接" title="提交的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 使用msg作为变动的提交信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">msg</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 更新最新的一次提交「因为内容变化，需要强制推送」</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">--amend</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">msg</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 更新最新的一次提交，但不修改提交信息「因为内容变化，需要强制推送」</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">--amend</span><span class="token plain"> --no-edit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 跳过pre-commit和commit-msg的git hooks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">msg</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">msg</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --no-verify</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="暂存">暂存<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E6%9A%82%E5%AD%98" class="hash-link" aria-label="暂存的直接链接" title="暂存的直接链接">​</a></h3>
<p>可以理解为临时存储</p>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 保存工作区和暂存区的所有变动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> stash save </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看所有临时存储</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> stash list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 应用一个临时存储</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> stash apply </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">stash</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 应用一个临时存储并将其从list中移除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> stash pop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除一个临时存储</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> stash drop </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">stash</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除所有临时存储</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> stash </span><span class="token function" style="color:#d73a49">clear</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="重置修改">重置修改<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E9%87%8D%E7%BD%AE%E4%BF%AE%E6%94%B9" class="hash-link" aria-label="重置修改的直接链接" title="重置修改的直接链接">​</a></h3>
<p><img loading="lazy" alt="reset" src="https://xpzero.github.io/blog/assets/images/reset-c665438e94df3af96d4f219359c1c017.png" width="1274" height="498" class="img_rmWR"></p>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 重置HEAD到commitId，并修改暂存区内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reset </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重置HEAD到commitId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reset </span><span class="token parameter variable" style="color:#36acaa">--soft</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重置HEAD到commitId，并修改暂存区与工作区中的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reset </span><span class="token parameter variable" style="color:#36acaa">--hard</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="撤销修改">撤销修改<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E6%92%A4%E9%94%80%E4%BF%AE%E6%94%B9" class="hash-link" aria-label="撤销修改的直接链接" title="撤销修改的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 恢复当前分支的工作区与暂存区到HEAD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 撤回某次commit并提交新的commit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> revert </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行时不打开默认编辑器，直接使用 Git 自动生成的提交信息。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> revert </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --no-edit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 只抵消暂存区和工作区的文件变化，不产生新的提交。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> revert </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --no-commit</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="删除">删除<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E5%88%A0%E9%99%A4" class="hash-link" aria-label="删除的直接链接" title="删除的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 删除工作区文件，并且将这次删除放入暂存区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 停止追踪指定文件，但该文件会保留在工作区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--cached</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 改名文件，并且将这个改名放入暂存区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">file-original</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">file-renamed</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除untracked files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clean </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 连带untracked的目录一起删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clean </span><span class="token parameter variable" style="color:#36acaa">-fd</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="分支">分支<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E5%88%86%E6%94%AF" class="hash-link" aria-label="分支的直接链接" title="分支的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看本地所有分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看本地和远程所有分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> branch </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看远程所有分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> branch </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 基于当前分支新建一个分支并切换到新分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout </span><span class="token parameter variable" style="color:#36acaa">-b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">branch-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 切换到之前的操作分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除本地分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> branch </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">branch-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 强制删除本地分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> branch </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">branch-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除远程分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin </span><span class="token parameter variable" style="color:#36acaa">--delete</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">branch-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> branch </span><span class="token parameter variable" style="color:#36acaa">-dr</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">remote/branch</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="查看提交信息">查看提交信息<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E4%BF%A1%E6%81%AF" class="hash-link" aria-label="查看提交信息的直接链接" title="查看提交信息的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看所有提交记录，并显示每次提交时变更的文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> log </span><span class="token parameter variable" style="color:#36acaa">--stat</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示过去5次的提交记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> log </span><span class="token parameter variable" style="color:#36acaa">-5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--pretty</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--oneline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示文件的每次提交的diff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> log </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示所有提交过的用户，按提交次数排序</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> shortlog </span><span class="token parameter variable" style="color:#36acaa">-sn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示指定文件是什么人在什么时间修改过</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> blame </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示暂存区和工作区的差异</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">diff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 显示暂存区和上一个commit的差异</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--cached</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="合并">合并<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E5%90%88%E5%B9%B6" class="hash-link" aria-label="合并的直接链接" title="合并的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-bash codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 将&lt;branch-name&gt;合并到当前分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> merge </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">branch-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 合并&lt;commitId&gt;到当前分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> cherry-pick </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">commitId</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/09/27/git-command#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener noreferrer">常用 Git 命令清单</a></p>
<p><a href="https://backlogtool.com/git-tutorial/cn/" target="_blank" rel="noopener noreferrer">猴子都能懂的 Git 入门</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2019/12/git-undo.html" target="_blank" rel="noopener noreferrer">如何撤销 Git 操作？</a></p>]]></content>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何让antd中的InputNumber组件只能输入数字？]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number"/>
        <updated>2023-09-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[因为antd 的InputNumber 组件最终的输入内容只能在失焦后看到，但是有时候用户想要在输入的时候就能看到最终的效果。例如，如果功能设计为InputNumber 只允许输入整数，且非数字内容不允许输入。因为带了一些业务逻辑，这时候antd 的InputNumber 自身的功能就有些不够用了。所以，记录下自己写的一个关于antd 的InputNumber 不允许输入小数点的demo。]]></summary>
        <content type="html"><![CDATA[<p>因为<code>antd</code> 的<code>InputNumber</code> 组件最终的输入内容只能在失焦后看到，但是有时候用户想要在输入的时候就能看到最终的效果。例如，如果功能设计为<code>InputNumber</code> 只允许输入整数，且非数字内容不允许输入。因为带了一些业务逻辑，这时候<code>antd</code> 的<code>InputNumber</code> 自身的功能就有些不够用了。所以，记录下自己写的一个关于<code>antd</code> 的<code>InputNumber</code> 不允许输入小数点的demo。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="实现效果">实现效果<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" class="hash-link" aria-label="实现效果的直接链接" title="实现效果的直接链接">​</a></h2>
<ul>
<li>只能输入数字，非数字不允许输入</li>
<li>实时显示最终的输入结果</li>
<li>不超过最大值，不小于最小值</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="一个inputnumber实现">一个InputNumber实现<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E4%B8%80%E4%B8%AAinputnumber%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="一个InputNumber实现的直接链接" title="一个InputNumber实现的直接链接">​</a></h2>
<div class="language-tsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-tsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useRef</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumber</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumberProps</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"antd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IntegerInputNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">InputNumberProps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defaultValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setValue</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">defaultValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setForceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> elemRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">useRef</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">HTMLInputElement</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      elemRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token operator" style="color:#393A34">?.</span><span class="token method function property-access" style="color:#d73a49">focus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">parser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: parser-value"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里拿到的数字可能和value一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// It will lead input's blur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\D</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 非数字字符串，直接结束函数，仍然使用之前的value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isNaN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> min </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> max </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// It will lead to input's blur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">realNum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">InputNumber</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">elemRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">forceRefresh</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">parser</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">parser</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">value</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">min</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">min</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">max</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">max</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">step</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">step</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面的代码实现了禁止<code>antd</code> 的<code>InputNumber</code> 组件输入非数字字符的功能。从代码上可以看出，是通过控制组件的<code>value</code> 的方式实现结果的动态展示。<strong>因为<code>setState</code> 之后会失焦，所以监听<code>forceRefresh</code> 和<code>value</code> 的值，并重新聚焦。</strong></p>
<p>但是上面的功能还不太完善，可以试试右边的两个上下箭头的功能，会发现他们被点击后没有任何效果。因为<code>value</code> 现在是手动控制的，所以即使内置的<code>onStep</code> 有认真执行，但也无济于事。下面给出了处理上下箭头功能的完整代码。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="处理上下箭头的功能">处理上下箭头的功能<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E5%A4%84%E7%90%86%E4%B8%8A%E4%B8%8B%E7%AE%AD%E5%A4%B4%E7%9A%84%E5%8A%9F%E8%83%BD" class="hash-link" aria-label="处理上下箭头的功能的直接链接" title="处理上下箭头的功能的直接链接">​</a></h3>
<div class="language-tsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-tsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useRef</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumber</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumberProps</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"antd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IntegerInputNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">InputNumberProps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defaultValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setForceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> valueRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">defaultValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> elemRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">useRef</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">HTMLInputElement</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      elemRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token operator" style="color:#393A34">?.</span><span class="token method function property-access" style="color:#d73a49">focus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">parser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: parser-value"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">valueRef</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">current</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里拿到的数字可能和value一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\D</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 非数字字符串，直接结束函数，仍然使用之前的value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isNaN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> min </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> max </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> realNum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// It will lead input's blur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onMyStep</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">InputNumber</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">elemRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">forceRefresh</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">parser</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">parser</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">valueRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">current</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">min</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">min</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">max</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">max</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">step</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">step</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">onStep</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onMyStep</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在<code>onStep</code> 直接修改<code>value</code> 值会导致下面的错误。</p>
<p><img loading="lazy" alt="error" src="https://xpzero.github.io/blog/assets/images/error-c3cb23ffa4341ccc17ee2e9193bb926c.png" width="1896" height="850" class="img_rmWR"></p>
<p>根据报错可以看出是因为重复调用了<code>setState</code> 导致的，所以把<code>value</code> 从<code>state</code> 改成了<code>ref</code> 这样就不会重复调用<code>setState</code>了。所以现在<code>InputNumber</code> 的值由<code>valueRef</code> 控制</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="添加外部onchange事件的处理">添加外部onChange事件的处理<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%83%A8onchange%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%A4%84%E7%90%86" class="hash-link" aria-label="添加外部onChange事件的处理的直接链接" title="添加外部onChange事件的处理的直接链接">​</a></h3>
<p>可能开发过程中需要在<code>InputNumber</code> 的值发生变化后进行一些其他的处理。</p>
<p>但是也不能直接写在组件里，因为组件被使用的地方可能不止一处，所以就需要将<code>onChange</code> 事件传递进组件使用</p>
<p>不过，还需要考虑另一件事。那就是，什么时候出发这个<code>onChange</code> 事件呢？如果实时触发，且<code>onChange</code> 事件中的处理较繁重就会影响页面渲染效果。</p>
<p>换种思考方向，一般什么时候使用<code>InputNumber</code> 呢？大多是要和<code>form</code> 表单一起的，<code>InputNumber</code> 只是其中的一项。而<code>form</code> 表单提交的时候，<code>InputNumber</code> 基本都是<code>blur</code> 状态。所以这里就将<code>onChange</code> 事件的触发放在<code>InputNumber</code> 组件的<code>onBlur</code> 事件中，且仅当<code>valueRef</code> 的值有变化之后才触发，否则即使触发了也没有任何意义。当然，也有额外情况，但不在本文范围内。</p>
<div class="language-tsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-tsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useRef</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumber</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumberProps</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"antd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IntegerInputNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">InputNumberProps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defaultValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onChange </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setForceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> valueRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">defaultValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> elemRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">useRef</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">HTMLInputElement</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      elemRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token operator" style="color:#393A34">?.</span><span class="token method function property-access" style="color:#d73a49">focus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">parser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: parser-value"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">valueRef</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">current</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里拿到的数字可能和value一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\D</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 非数字字符串，直接结束函数，仍然使用之前的value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isNaN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> min </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> max </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> realNum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// It will lead input's blur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onMyStep</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onMyBlur</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> defaultValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      onChange</span><span class="token operator" style="color:#393A34">?.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">InputNumber</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">elemRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">forceRefresh</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">parser</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">parser</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">valueRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">current</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">min</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">min</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">max</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">max</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">step</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">step</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">onStep</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onMyStep</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">onBlur</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onMyBlur</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="再次优化">再次优化<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E5%86%8D%E6%AC%A1%E4%BC%98%E5%8C%96" class="hash-link" aria-label="再次优化的直接链接" title="再次优化的直接链接">​</a></h2>
<p>其实上面的代码还是有一些缺陷。如果在数字中间输入非数字字符，则当前位置之后的数字都会因为<code>parseInt</code> 而消失。下面是参考<code>Semi-ui</code> 的正则做出的调整。</p>
<div class="language-tsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-tsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useRef</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumber</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">InputNumberProps</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"antd"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IntegerInputNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">InputNumberProps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> defaultValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onChange </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setForceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> valueRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">defaultValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> elemRef </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">useRef</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">HTMLInputElement</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      elemRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token operator" style="color:#393A34">?.</span><span class="token method function property-access" style="color:#d73a49">focus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">forceRefresh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">parser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dev: parser-value"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">valueRef</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">current</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里拿到的数字可能和value一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> realValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newValue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\D</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">realValue </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">realValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\D</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> min </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">realNum </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> min</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> max </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"number"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">realNum </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            realNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> max</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> realNum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// It will lead input's blur.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onMyStep</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setForceRefresh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onMyBlur</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> defaultValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      onChange</span><span class="token operator" style="color:#393A34">?.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valueRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">InputNumber</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">ref</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">elemRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">forceRefresh</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">parser</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">parser</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">valueRef</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">current</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">min</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">min</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">max</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">max</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">step</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">step</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">onStep</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onMyStep</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">onBlur</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onMyBlur</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="对比semi-ui">对比Semi-UI<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E5%AF%B9%E6%AF%94semi-ui" class="hash-link" aria-label="对比Semi-UI的直接链接" title="对比Semi-UI的直接链接">​</a></h2>
<p>在<code>Semi-UI</code> 的<code>InputNumber</code> 文档里就可以看到，他们提供了一个禁止输入小数点的示例。</p>
<p><img loading="lazy" alt="semi" src="https://xpzero.github.io/blog/assets/images/semi-a127bfdad421293615204d305377f900.png" width="2878" height="1082" class="img_rmWR"></p>
<p>看着和<code>antd</code> 的格式很像嘛。拿过去在<code>antd</code> 里试试看看行不行，答案很显然，并不行。不然也不会有这篇文章了。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="实现细节">实现细节<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82" class="hash-link" aria-label="实现细节的直接链接" title="实现细节的直接链接">​</a></h3>
<p>搜索<code>formatter</code> 可以发现，可以在<code>InputNumber</code> 组件的源码里看到，有获取<code>formatter</code> 函数的返回值</p>
<p><img loading="lazy" alt="detail" src="https://xpzero.github.io/blog/assets/images/detail-af1002599ccea8d40e426cb3496fd048.png" width="1350" height="658" class="img_rmWR"></p>
<p>搜索<code>doFormat</code> 函数的使用位置，发现是在下面的函数中都有使用</p>
<ul>
<li><code>handleInputChange</code></li>
<li><code>handleInputBlur</code></li>
<li><code>_setInitValue</code></li>
<li><code>add</code></li>
</ul>
<p>下面就看下<code>handleInputChange</code> 函数，其他的应该是同理的。这里假设</p>
<ul>
<li>使用了<code>semi-ui</code> 官网的<code>InputNumber</code> 使用纯数字输入的示例代码</li>
<li>当前输入的内容是<code>2.</code></li>
</ul>
<p><img loading="lazy" alt="detail2" src="https://xpzero.github.io/blog/assets/images/detail2-61a3696582b439c55e3dd4da81eda6e6.png" width="1676" height="1622" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/09/26/limit-InputNumber-of-Antd-just-receive-number#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://semi.design/zh-CN/input/inputnumber" target="_blank" rel="noopener noreferrer">Semi-UI的InputNumber</a></p>
<p><a href="https://ant.design/components/input-number-cn" target="_blank" rel="noopener noreferrer">antd的InputNumber</a></p>]]></content>
        <category label="react" term="react"/>
        <category label="antd" term="antd"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[nvim插件体系记录]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system"/>
        <updated>2023-09-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[从开始使用nvim到现在，差不多有些熟练了。记录下nvim中的插件体系，防止后面还有各种倒腾的时候忘记了]]></summary>
        <content type="html"><![CDATA[<p>从开始使用nvim到现在，差不多有些熟练了。记录下nvim中的插件体系，防止后面还有各种倒腾的时候忘记了</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="开局一张图">开局一张图<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E5%BC%80%E5%B1%80%E4%B8%80%E5%BC%A0%E5%9B%BE" class="hash-link" aria-label="开局一张图的直接链接" title="开局一张图的直接链接">​</a></h2>
<!-- -->
<!-- -->
<div class="myMarkmap_L_os"><svg width="auto" height="auto"></svg><div></div></div>
<p>其实从图里，已经可以看出我现在使用的配置分类。但是还是再具体描述一番，避免哪天脑子抽筋给忘掉了。</p>
<p><strong>✨图片可以放大、拖拽</strong></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="lsp">LSP<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#lsp" class="hash-link" aria-label="LSP的直接链接" title="LSP的直接链接">​</a></h2>
<p><code>LSP</code>全称<code>Language Server Protocol</code>，即语言服务协议。就像<code>http</code>协议一样，服务端和客户端基于此收发送消息。
<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">基于此协议，语言服务端可以提供自动补全、定义跳转等功能给客户端</span></p>
<!-- -->
<p>这样，各种语言服务端（c、java、ts等）就可以通过<code>LSP</code>提供服务给<code>LSP</code>的客户端，这里客户端就是nvim</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nvim-lspconfig"><a href="https://github.com/neovim/nvim-lspconfig" target="_blank" rel="noopener noreferrer">nvim-lspconfig</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#nvim-lspconfig" class="hash-link" aria-label="nvim-lspconfig的直接链接" title="nvim-lspconfig的直接链接">​</a></h3>
<p>提供了一套常用的语言服务配置，但是需要用户手动启动语言服务，且可能没有提供用户需要的语言服务。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="mason"><a href="https://github.com/williamboman/mason.nvim" target="_blank" rel="noopener noreferrer">mason</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#mason" class="hash-link" aria-label="mason的直接链接" title="mason的直接链接">​</a></h3>
<p>提供了一套ui和一些简单命令用来安装语言服务。长下面这样</p>
<p><img loading="lazy" alt="mason ui" src="https://xpzero.github.io/blog/assets/images/mason-cc070a05a98414e86e8e63a0a9123c58.png" width="2394" height="1630" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="mason-lspconfig"><a href="https://github.com/williamboman/mason-lspconfig.nvim" target="_blank" rel="noopener noreferrer">mason-lspconfig</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#mason-lspconfig" class="hash-link" aria-label="mason-lspconfig的直接链接" title="mason-lspconfig的直接链接">​</a></h3>
<p>提供给mason一些命令安装语言服务并自动启动对应的语言服务</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="依赖关系">依赖关系<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB" class="hash-link" aria-label="依赖关系的直接链接" title="依赖关系的直接链接">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="自动补全">自动补全<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8" class="hash-link" aria-label="自动补全的直接链接" title="自动补全的直接链接">​</a></h2>
<p>现在写代码哪里少的了自动补全呢？自动补全的样式，大概如下</p>
<p><img loading="lazy" alt="cmp" src="https://xpzero.github.io/blog/assets/images/cmp-0cd03dffe2da0c2059bb19f14a9ab40b.png" width="958" height="484" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nvim-cmp"><a href="https://github.com/hrsh7th/nvim-cmp" target="_blank" rel="noopener noreferrer">nvim-cmp</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#nvim-cmp" class="hash-link" aria-label="nvim-cmp的直接链接" title="nvim-cmp的直接链接">​</a></h3>
<p>提供代码自动补全的功能</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="cmp-nvim-lsp"><a href="https://github.com/hrsh7th/cmp-nvim-lsp" target="_blank" rel="noopener noreferrer">cmp-nvim-lsp</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#cmp-nvim-lsp" class="hash-link" aria-label="cmp-nvim-lsp的直接链接" title="cmp-nvim-lsp的直接链接">​</a></h3>
<p>从语言服务中获取补全源供nvim-cmp使用</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="cmp-buffer"><a href="https://github.com/hrsh7th/cmp-buffer" target="_blank" rel="noopener noreferrer">cmp-buffer</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#cmp-buffer" class="hash-link" aria-label="cmp-buffer的直接链接" title="cmp-buffer的直接链接">​</a></h3>
<p>从当前buffer获取补全源供nvim-cmp使用</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="cmp-path"><a href="https://github.com/hrsh7th/cmp-path" target="_blank" rel="noopener noreferrer">cmp-path</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#cmp-path" class="hash-link" aria-label="cmp-path的直接链接" title="cmp-path的直接链接">​</a></h3>
<p>从系统路径中获取补全源供nvim-cmp使用</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="cmp-cmdline"><a href="https://github.com/hrsh7th/cmp-cmdline" target="_blank" rel="noopener noreferrer">cmp-cmdline</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#cmp-cmdline" class="hash-link" aria-label="cmp-cmdline的直接链接" title="cmp-cmdline的直接链接">​</a></h3>
<p>从命令行中获取补全源供nvim-cmp使用</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="friendly-snippets"><a href="https://github.com/rafamadriz/friendly-snippets" target="_blank" rel="noopener noreferrer">friendly-snippets</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#friendly-snippets" class="hash-link" aria-label="friendly-snippets的直接链接" title="friendly-snippets的直接链接">​</a></h3>
<p>常用的代码片段</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="luasnip"><a href="https://github.com/L3MON4D3/LuaSnip" target="_blank" rel="noopener noreferrer">LuaSnip</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#luasnip" class="hash-link" aria-label="luasnip的直接链接" title="luasnip的直接链接">​</a></h3>
<p>lua写的代码片段引擎。nvim-cmp的扩展，可以自定义代码片段。对如果配置结构和<code>vscode</code>相似，需要依赖<code>friendly-snippets</code></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="依赖关系-1">依赖关系<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB-1" class="hash-link" aria-label="依赖关系的直接链接" title="依赖关系的直接链接">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="语法高亮">语法高亮<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE" class="hash-link" aria-label="语法高亮的直接链接" title="语法高亮的直接链接">​</a></h2>
<p>暂时只用了<code>nvim-treesitter</code></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nvim-treesitter"><a href="https://github.com/nvim-treesitter/nvim-treesitter" target="_blank" rel="noopener noreferrer">nvim-treesitter</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#nvim-treesitter" class="hash-link" aria-label="nvim-treesitter的直接链接" title="nvim-treesitter的直接链接">​</a></h3>
<p>支持代码的语法高亮，需要使用其内置命令手动安装需要支持语法高亮的语言</p>
<p>支持的html语法</p>
<p><img loading="lazy" alt="html" src="https://xpzero.github.io/blog/assets/images/html-e9a914eb3e5e8d3d34140dffa4c773ee.png" width="1486" height="554" class="img_rmWR"></p>
<p>可安装的语言使用<code>:TSInstallInfo</code> 查看。使用<code>:TSInstall 对应的语言名字</code>即可安装对应的语法高亮规则</p>
<p><img loading="lazy" alt="tresitter" src="https://xpzero.github.io/blog/assets/images/treesitter-5b86dacfb8f32e3fb447e73925181264.png" width="1040" height="1366" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="编辑器相关">编辑器相关<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E7%BC%96%E8%BE%91%E5%99%A8%E7%9B%B8%E5%85%B3" class="hash-link" aria-label="编辑器相关的直接链接" title="编辑器相关的直接链接">​</a></h2>
<p>这里基本就是基本工作环境配置了</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="neo-tree"><a href="https://github.com/nvim-neo-tree/neo-tree.nvim" target="_blank" rel="noopener noreferrer">neo-tree</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#neo-tree" class="hash-link" aria-label="neo-tree的直接链接" title="neo-tree的直接链接">​</a></h3>
<p>文件树，方便查看当前工作环境的文件目录</p>
<p><img loading="lazy" alt="neo-tree" src="https://xpzero.github.io/blog/assets/images/neo-tree-c7c64a229df42f6fc64ef271c898624c.png" width="1172" height="750" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="telescope"><a href="https://github.com/nvim-telescope/telescope.nvim" target="_blank" rel="noopener noreferrer">telescope</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#telescope" class="hash-link" aria-label="telescope的直接链接" title="telescope的直接链接">​</a></h3>
<p>文件搜索</p>
<p><img loading="lazy" alt="telescope" src="https://xpzero.github.io/blog/assets/images/telescope-7646af2b24d641046012d3b83befff0a.png" width="2442" height="1494" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="flash"><a href="https://github.com/folke/flash.nvim" target="_blank" rel="noopener noreferrer">flash</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#flash" class="hash-link" aria-label="flash的直接链接" title="flash的直接链接">​</a></h3>
<p>代码字符间跳转，实现代码位置的快速跳转功能。即，快速将光标跳转到对应的位置</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="which-key"><a href="https://github.com/folke/which-key.nvim" target="_blank" rel="noopener noreferrer">which-key</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#which-key" class="hash-link" aria-label="which-key的直接链接" title="which-key的直接链接">​</a></h3>
<p>快捷键提示</p>
<p><img loading="lazy" alt="which-key" src="https://xpzero.github.io/blog/assets/images/which-key-d271aa2ce1cfceedb8587bef65a564f9.png" width="2566" height="442" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="todo-comments"><a href="https://github.com/folke/todo-comments.nvim" target="_blank" rel="noopener noreferrer">todo-comments</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#todo-comments" class="hash-link" aria-label="todo-comments的直接链接" title="todo-comments的直接链接">​</a></h3>
<p>todo高亮</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="bufferline"><a href="https://github.com/akinsho/bufferline.nvim" target="_blank" rel="noopener noreferrer">bufferline</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#bufferline" class="hash-link" aria-label="bufferline的直接链接" title="bufferline的直接链接">​</a></h3>
<p>多文件tab页</p>
<p><img loading="lazy" alt="bufferline" src="https://xpzero.github.io/blog/assets/images/bufferline-dc32b4a7f50acd541a94eebd56f0774e.png" width="1594" height="628" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="minibufremove"><a href="https://github.com/echasnovski/mini.bufremove" target="_blank" rel="noopener noreferrer">mini.bufremove</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#minibufremove" class="hash-link" aria-label="minibufremove的直接链接" title="minibufremove的直接链接">​</a></h3>
<p>提供一些buffer增删的快捷处理</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="lualine"><a href="https://github.com/nvim-lualine/lualine.nvim" target="_blank" rel="noopener noreferrer">lualine</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#lualine" class="hash-link" aria-label="lualine的直接链接" title="lualine的直接链接">​</a></h3>
<p>状态栏</p>
<p><img loading="lazy" alt="lualine" src="https://xpzero.github.io/blog/assets/images/lualine-eaee19a3768134c641552d427d3d14a9.png" width="2872" height="176" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="trouble"><a href="https://github.com/folke/trouble.nvim" target="_blank" rel="noopener noreferrer">trouble</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#trouble" class="hash-link" aria-label="trouble的直接链接" title="trouble的直接链接">​</a></h3>
<p>代码诊断</p>
<p><img loading="lazy" alt="trouble" src="https://xpzero.github.io/blog/assets/images/trouble-0c6a1e432366308bee480db0ed60e630.png" width="1992" height="236" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="ui优化">UI优化<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#ui%E4%BC%98%E5%8C%96" class="hash-link" aria-label="UI优化的直接链接" title="UI优化的直接链接">​</a></h2>
<p>这里就是一些ui美化了</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nvim-notify"><a href="https://github.com/rcarriga/nvim-notify" target="_blank" rel="noopener noreferrer">nvim-notify</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#nvim-notify" class="hash-link" aria-label="nvim-notify的直接链接" title="nvim-notify的直接链接">​</a></h3>
<p>将提示信息以弹窗的形式显示在右上角</p>
<p><img loading="lazy" alt="notify" src="https://xpzero.github.io/blog/assets/images/notify-9c864d68b80185a21cec03b0be1bfe9a.png" width="1138" height="334" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="dressing"><a href="https://github.com/stevearc/dressing.nvim" target="_blank" rel="noopener noreferrer">dressing</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#dressing" class="hash-link" aria-label="dressing的直接链接" title="dressing的直接链接">​</a></h3>
<p>优化选择框和输入框的显示</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="indent-blackline"><a href="https://github.com/lukas-reineke/indent-blankline.nvim" target="_blank" rel="noopener noreferrer">indent-blackline</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#indent-blackline" class="hash-link" aria-label="indent-blackline的直接链接" title="indent-blackline的直接链接">​</a></h3>
<p>缩进线</p>
<p><img loading="lazy" alt="indent" src="https://xpzero.github.io/blog/assets/images/indent-e8526b6581299d2cf19d7d00af8cfb65.png" width="882" height="1312" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="noice"><a href="https://github.com/folke/noice.nvim" target="_blank" rel="noopener noreferrer">noice</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#noice" class="hash-link" aria-label="noice的直接链接" title="noice的直接链接">​</a></h3>
<p>整合版nvim-notify</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="alpha"><a href="https://github.com/goolord/alpha-nvim" target="_blank" rel="noopener noreferrer">alpha</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#alpha" class="hash-link" aria-label="alpha的直接链接" title="alpha的直接链接">​</a></h3>
<p>nvim启动页</p>
<p><img loading="lazy" alt="alpha" src="https://xpzero.github.io/blog/assets/images/alpha-9c328836b2b8407b00aad37688ba1597.png" width="1534" height="1380" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nui"><a href="https://github.com/MunifTanjim/nui.nvim" target="_blank" rel="noopener noreferrer">nui</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#nui" class="hash-link" aria-label="nui的直接链接" title="nui的直接链接">​</a></h3>
<p>被许多其他插件依赖，是一个ui组件库</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="nvim-web-devicons"><a href="https://github.com/nvim-tree/nvim-web-devicons" target="_blank" rel="noopener noreferrer">nvim-web-devicons</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#nvim-web-devicons" class="hash-link" aria-label="nvim-web-devicons的直接链接" title="nvim-web-devicons的直接链接">​</a></h3>
<p>图标库</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="git相关">git相关<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#git%E7%9B%B8%E5%85%B3" class="hash-link" aria-label="git相关的直接链接" title="git相关的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="gitsigns"><a href="https://github.com/lewis6991/gitsigns.nvim" target="_blank" rel="noopener noreferrer">gitsigns</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#gitsigns" class="hash-link" aria-label="gitsigns的直接链接" title="gitsigns的直接链接">​</a></h3>
<p>标识当前buffer中哪些行有增/删/改，可配置当前行的blame的虚拟文本显示</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="diffview"><a href="https://github.com/sindrets/diffview.nvim" target="_blank" rel="noopener noreferrer">diffview</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#diffview" class="hash-link" aria-label="diffview的直接链接" title="diffview的直接链接">​</a></h3>
<p>方便处理git冲突</p>
<p><img loading="lazy" alt="diffview" src="https://xpzero.github.io/blog/assets/images/diffview-1c377878c36c5fe47defa8e421038062.png" width="2860" height="908" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="utils">utils<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#utils" class="hash-link" aria-label="utils的直接链接" title="utils的直接链接">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="plenary"><a href="https://github.com/nvim-lua/plenary.nvim" target="_blank" rel="noopener noreferrer">plenary</a><a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#plenary" class="hash-link" aria-label="plenary的直接链接" title="plenary的直接链接">​</a></h3>
<p>lua函数工具包</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="总结">总结<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2>
<p>从开始倒腾nvim到现在，我学会了遇着问题钻进github的issue去看的问题处理方式，受益颇深。在issue里「前人栽树，后人乘凉」的思想体现的淋漓尽致。
根据上面的处理方式，处理掉自己的问题之后，内心「哇」声一片，这不得专门跑回去点个赞！</p>
<p>当然，这其中不停的去解决遇到的问题，也是一种痛并快乐着的过程。</p>
<p>有问题才有成长，继续加油哦🤓</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/09/23/nvim-plugins-system#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://www.lazyvim.org/" target="_blank" rel="noopener noreferrer">LazyVim</a></p>
<p><a href="https://blog.otakusaikou.com/2023/07/05/neovim-language-server-config-explanation/" target="_blank" rel="noopener noreferrer">Neovim Language Server Protocol 配置解释</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/643033884" target="_blank" rel="noopener noreferrer">详解nvim内建LSP体系与基于nvim-cmp的代码补全体系</a></p>]]></content>
        <category label="nvim" term="nvim"/>
        <category label="neovim" term="neovim"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用Docusaurus构建博客]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog"/>
        <updated>2023-09-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[一开始是用的hexo构建的博客，但是使用起来还是有些麻烦的。比如每篇文章的图片都要放在同一个目录下才能生效……；样式定义略显麻烦，只能在一个文件里使用css进行覆盖，等等，都让我觉得，hexo用起来不是那么的方便。]]></summary>
        <content type="html"><![CDATA[<p>一开始是用的<code>hexo</code>构建的博客，但是使用起来还是有些麻烦的。比如每篇文章的图片都要放在同一个目录下才能生效……；样式定义略显麻烦，只能在一个文件里使用css进行覆盖，等等，都让我觉得，<code>hexo</code>用起来不是那么的方便。</p>
<p>在做<code>nvim</code>的配置的时候，觉得<code>LazyVim</code>的官网挺好看的，看到了其页脚的<code>Built with Docusaurus</code>，就开始对<code>Docusaurus</code>一发不可收拾了。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="为什么使用docusaurus">为什么使用Docusaurus<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8docusaurus" class="hash-link" aria-label="为什么使用Docusaurus的直接链接" title="为什么使用Docusaurus的直接链接">​</a></h2>
<ol>
<li>好看</li>
<li>图片可以和文章放在比较近的位置</li>
<li>除了大框架，其他内容可充分自定义</li>
<li>基于<code>react</code>，可以自定义组件及其样式</li>
<li>配置相对简单</li>
<li>……</li>
</ol>
<p>这么好用为什么还不用？</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="安装">安装<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E5%AE%89%E8%A3%85" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接">​</a></h2>
<p>官网描述的已经很清楚了，这里就不冗余了。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="配置">配置<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接">​</a></h2>
<p>这里是关键。虽然官网给的配置教程已经很清楚了，但是难免有些小细节被忽略，这里记录下比较重要的内容。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="目录树">目录树<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E7%9B%AE%E5%BD%95%E6%A0%91" class="hash-link" aria-label="目录树的直接链接" title="目录树的直接链接">​</a></h3>
<div class="language-txt codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-txt codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">blog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── blog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .gitignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── babel.config.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── docusaurus.config.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── pnpm-lock.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sidebars.js</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>文章目录路径最好是英文的，否则之后添加<code>algolia</code>之类的搜索功能时，可能被爬取的链接会因为中文转义的问题找不到真正的页面，造成搜索功能失效。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="具体配置">具体配置<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="具体配置的直接链接" title="具体配置的直接链接">​</a></h3>
<div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">.env</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">package.json</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">docusaurus.config.js</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">custom.css</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">workflow.yml</li></ul><div role="tabpanel" class="tabItem_ZLAG margin-top--md"><p>这里使用了<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">dotenv</span> 。在部署的时候，将「.env」文件中的内容添加到了「process.env」中。「process.env」中的内容优先级高于「docusaurus.config.js」</p><div class="language-yml codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-yml codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># github 用户名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORGANIZATION_NAME=xpzero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 博客源码库所使用的分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CURRENT_BRANCH=main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 博客静态页面部署库的库名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROJECT_NAME=blog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 博客静态页面部署库所用的分支</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEPLOYMENT_BRANCH=main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># github 用户名 workflow中会用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GIT_USER=xpzero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># workflow中会用，密码要用personal key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># GIT_PASS=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 将静态页面推送到部署库时的commit信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CUSTOM_COMMIT_MESSAGE=publish post</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="通用组件">通用组件<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6" class="hash-link" aria-label="通用组件的直接链接" title="通用组件的直接链接">​</a></h2>
<p>可以在<code>src/components</code>中写通用组件。又分为全局可用的组件和局部引入的组件</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="全局使用">全局使用<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E5%85%A8%E5%B1%80%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="全局使用的直接链接" title="全局使用的直接链接">​</a></h3>
<p>全局组件即为，不需要手动引入即可使用的组件，就好像是内置组件一样。</p>
<p>配置步骤如下：</p>
<ul>
<li>添加src/theme/MDXComponents.js文件</li>
<li>将src/components/中的某个组件通过<code>MDXComponents</code>文件导出</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="demo">demo<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#demo" class="hash-link" aria-label="demo的直接链接" title="demo的直接链接">​</a></h4>
<p>将官网的高亮组件设为全局使用</p>
<div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">MDXComponents</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">Highlight</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">test.md</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">MDXComponents</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@theme-original/MDXComponents"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Highlight</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@site/src/components/Highlight"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token maybe-class-name">MDXComponents</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">Highlight</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Highlight</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="language-tsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-tsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Highlight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> children</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">span</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">        backgroundColor</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> color</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">        borderRadius</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"2px"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">        color</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"#fff"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">        padding</span><span class="token tag script language-javascript operator" style="color:#393A34">:</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"0.2rem"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">,</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">      </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">children</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">span</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token maybe-class-name">Highlight</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="playgroundContainer_CsNx"><div class="playgroundHeader_MTMT">实时编辑器</div><div class="playgroundEditor_RzvE"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 测试全局高亮组件</span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Highlight</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">color</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">orange</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">测试一下</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag class-name" style="color:#00009f">Highlight</span><span class="token tag punctuation" style="color:#393A34">&gt;</span>
</span></pre></div><div class="playgroundHeader_MTMT">结果</div><div class="playgroundPreview_I3pO"><div>Loading...</div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="局部引入">局部引入<a href="https://xpzero.github.io/blog/index/2023/09/23/using-docusaurus-build-blog#%E5%B1%80%E9%83%A8%E5%BC%95%E5%85%A5" class="hash-link" aria-label="局部引入的直接链接" title="局部引入的直接链接">​</a></h3>
<p>这种情况，只需要在<code>src/components</code>中写好组件，然后在<code>markdown</code>文件中引入即可</p>
<div class="language-mdx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-mdx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title: 测试组件局部引入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import Count from "@site/src/components/Count.jsx";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Count /&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="Docusaurus" term="Docusaurus"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[LuaSnip使用]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/16/how-to-use-LuaSnip</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/16/how-to-use-LuaSnip"/>
        <updated>2023-09-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[之前一直在网上搜来搜去，找不到如何在neovim上配置自己的代码片段，终于皇天不负有心人，找到了正确的配置方式。其实github上的官方文档已经很清楚了，可能是因为英文不好，所以一直没有看出来。特此记录下来，便于后用。]]></summary>
        <content type="html"><![CDATA[<p>之前一直在网上搜来搜去，找不到如何在neovim上配置自己的代码片段，终于皇天不负有心人，找到了正确的配置方式。其实github上的官方文档已经很清楚了，可能是因为英文不好，所以一直没有看出来。特此记录下来，便于后用。</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>这里用的<code>lazy.nvim</code>插件管理器。详细信息可查看<a href="https://github.com/folke/lazy.nvim" target="_blank" rel="noopener noreferrer">lazy.nvim 的GitHub</a></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="文件目录">文件目录<a href="https://xpzero.github.io/blog/index/2023/09/16/how-to-use-LuaSnip#%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95" class="hash-link" aria-label="文件目录的直接链接" title="文件目录的直接链接">​</a></h2>
<p>先贴一下文件目录，方便后续查看</p>
<div class="language-txt codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-txt codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">~/.config/nvim/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lua</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; └── snippets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     ├── lua</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     │&nbsp;&nbsp; └── markdown.lua</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     └── vscode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;         ├── console.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;         └── package.json</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="vs-code-like-代码片段配置">VS Code-like 代码片段配置<a href="https://xpzero.github.io/blog/index/2023/09/16/how-to-use-LuaSnip#vs-code-like-%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="VS Code-like 代码片段配置的直接链接" title="VS Code-like 代码片段配置的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>步骤如下：</p><ol>
<li>编写VS Code-like 的代码片段</li>
<li>配置代码片段所支持的语言</li>
<li>加载代码片段</li>
</ol><p>注意：代码片段所在的目录一定要有<code>package.json</code>文件，用来指定代码片段文件的路径及支持的语言</p></div></div>
<div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">load snippets</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">snippets/package.json</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">snippets/console.json</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="language-lua codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-lua codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou codeBlockLinesWithNumbering_CAb1"><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">return {</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">    "L3MON4D3/LuaSnip",</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">    dependencies = {</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">      "rafamadriz/friendly-snippets",</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">    },</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">    config = function()</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">      -- load friendly-snippets</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">      require("luasnip.loaders.from_vscode").lazy_load()</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">      -- load VS Code-like snippets.</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">      // add-highlight-line</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">      require("luasnip.loaders.from_vscode").lazy_load({ paths = { "./lua/snippets/vscode" } })</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">    end,</span></span><br></span><span class="token-line codeLine_BMpT" style="color:#393A34"><span class="codeLineNumber_Dl7j"></span><span class="codeLineContent_AquY"><span class="token plain">  }</span></span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><p>这里指定了<code>console.json</code>文件中写的代码片段支持所有语言。</p><div class="language-json codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-json codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"contributes"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"snippets"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"language"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"all"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"path"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./console.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><p>这里比较简单，因为平时会写一些<code>console.log</code>，所以这里配置了比较容易识别是自己写的log的标志</p><div class="language-json codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-json codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"print log"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prefix"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"cld"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"body"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"console.log('dev: $1', $2);"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"console with dev keyword"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，每次输入<code>cld</code>并选中后，就自动把<code>console.log('dev: $1', $2)</code>插入光标所在的位置。</p><ul>
<li><code>$1</code>表示插入代码片段后，光标所在的位置。</li>
<li><code>$2</code>表示在<code>$1</code>位置输入自己想要的内容后，再按<code>Tab</code>键之后光标会在的位置</li>
</ul><p>简单理解就是<code>$1</code>是光标的第一个位置，<code>$2</code>是光标的第二个位置。</p></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="lua写的代码片段配置">Lua写的代码片段配置<a href="https://xpzero.github.io/blog/index/2023/09/16/how-to-use-LuaSnip#lua%E5%86%99%E7%9A%84%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="Lua写的代码片段配置的直接链接" title="Lua写的代码片段配置的直接链接">​</a></h2>
<p>这个只需要将代码片段对应的<code>lua</code>文件在<code>LuaSnip</code>加载的时候引入即可。</p>
<div class="tabs-container tabList_IzwK"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_cW3_ tabs__item--active">load</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_cW3_">lua snippets</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_ZLAG"><div class="language-lua codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-lua codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "L3MON4D3/LuaSnip",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dependencies = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "rafamadriz/friendly-snippets",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config = function()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      -- load friendly-snippets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      require("luasnip.loaders.from_vscode").lazy_load()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      -- load VS Code-like snippets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      require("luasnip.loaders.from_vscode").lazy_load({ paths = { "./lua/snippets/vscode" } })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      -- load lua snippets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // add-highlight-line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      require("luasnip.loaders.from_lua").lazy_load({ paths = "./lua/snippets/lua" })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_ZLAG" hidden=""><div class="language-lua codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-lua codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">local ls = require("luasnip")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local fmt = require("luasnip.extras.fmt").fmt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls.add_snippets("markdown", {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ls.snippet(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- trigger with "tt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "tt",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      [[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title: {xxx}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xxx = ls.function_node(function()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -- :t get trailing string with extension.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -- :r get the string without extension.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -- return vim.fn.fnamemodify(vim.fn.bufname(), ":t:r")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -- or below. source: https://neovim.io/doc/user/builtin.html#expand()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          return vim.fn.expand("%:t:r")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/09/16/how-to-use-LuaSnip#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://discord.com/channels/1107070766681444433/1107164897982300192/1136693073334784133" target="_blank" rel="noopener noreferrer">LuaSnip配置原理</a></p>
<p><a href="https://github.com/L3MON4D3/LuaSnip/blob/master/Examples/snippets.lua#L190" target="_blank" rel="noopener noreferrer">Lua snippets's demo</a></p>]]></content>
        <category label="nvim" term="nvim"/>
        <category label="neovim" term="neovim"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[配置dotfiles记录]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os"/>
        <updated>2023-09-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[因为工作和个人电脑都是Mac，平时也会在家用自己的电脑coding，所以想统一一下编码环境，方便使用。]]></summary>
        <content type="html"><![CDATA[<p>因为工作和个人电脑都是Mac，平时也会在家用自己的电脑coding，所以想统一一下编码环境，方便使用。</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p><code>dotfiles</code>指的是，系统中比较重要的隐藏文件(夹)。比如<code>.config/</code>、<code>.zshrc</code>等。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="注意事项">注意事项<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" class="hash-link" aria-label="注意事项的直接链接" title="注意事项的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="zshrc中的家目录最好使用变量而非users-your-host-name-"><code>.zshrc</code>中的<code>家</code>目录，最好使用变量，而非<code>/Users/{ your host name }</code><a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#zshrc%E4%B8%AD%E7%9A%84%E5%AE%B6%E7%9B%AE%E5%BD%95%E6%9C%80%E5%A5%BD%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E8%80%8C%E9%9D%9Eusers-your-host-name-" class="hash-link" aria-label="zshrc中的家目录最好使用变量而非users-your-host-name-的直接链接" title="zshrc中的家目录最好使用变量而非users-your-host-name-的直接链接">​</a></h3>
<p>因为不知道下载<code>dotfiles</code>项目的电脑的<code>host name</code>是什么。</p>
<p>如果写死了，脚本执行完成后一些程序找不到路径会无法正确执行</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="oh-my-zsh的主题和插件不要直接放其themes和plugins下"><code>oh-my-zsh</code>的主题和插件不要直接放其<code>themes/</code>和<code>plugins/</code>下<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#oh-my-zsh%E7%9A%84%E4%B8%BB%E9%A2%98%E5%92%8C%E6%8F%92%E4%BB%B6%E4%B8%8D%E8%A6%81%E7%9B%B4%E6%8E%A5%E6%94%BE%E5%85%B6themes%E5%92%8Cplugins%E4%B8%8B" class="hash-link" aria-label="oh-my-zsh的主题和插件不要直接放其themes和plugins下的直接链接" title="oh-my-zsh�的主题和插件不要直接放其themes和plugins下的直接链接">​</a></h3>
<p>因为<code>dotfiles</code>项目下的<code>oh-my-zsh</code>是<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">动态</span>从<code>github</code>上获取的。</p>
<p>项目被克隆下来后，<code>oh-my-zsh/</code>下的<code>themes/</code>和<code>plugins/</code>都会被<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">初始化</span>。</p>
<p>建议是将<code>oh-my-zsh</code>的<code>themes/</code>和<code>plugins</code>放在别处，软链接到<code>oh-my-zsh/</code>对应的目录下</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="思路整理">思路整理<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86" class="hash-link" aria-label="思路整理的直接链接" title="思路整理的直接链接">​</a></h2>
<ol>
<li>创建github仓库</li>
<li>将整理好的<code>dotfiles</code>上传到repo</li>
<li>创建并执行<code>dotfiles</code>安装脚本</li>
<li>重启终端，等待魔法</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="dotfiles目录分类"><code>dotfiles</code>目录分类<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#dotfiles%E7%9B%AE%E5%BD%95%E5%88%86%E7%B1%BB" class="hash-link" aria-label="dotfiles目录分类的直接链接" title="dotfiles目录分类的直接链接">​</a></h2>
<p><code>dotfiles/</code>的目录树如下</p>
<div class="language-txt codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-txt codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bootstrap.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── dot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── oh-my-zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── p10k.zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; └── zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── themes</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里分出<code>dot/</code>是为了方便安装脚本中的目录查找，也便于文件管理。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="dotfiles安装脚本"><code>dotfiles/</code>安装脚本<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#dotfiles%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC" class="hash-link" aria-label="dotfiles安装脚本的直接链接" title="dotfiles安装脚本的直接链接">​</a></h2>
<p>这里写的比较简单，思路如下：</p>
<ol>
<li>查找<code>dotfiles/dot/</code>下的所有文件(夹)</li>
<li>如果上面的文件(夹)添加<code>$HOME/.</code>前缀后，可在家目录中找到，且不是软链接类型，则为其创建备份(原文件(夹)重命名为带有<code>.bak</code>的文件(夹))</li>
<li>将<code>dotfiles/dot/</code>下的所有文件(夹)添加<code>$HOME/.</code>前缀，软链接到家(这里是<code>$HOME</code>)目录</li>
<li>将<code>dotfiles/zsh/</code>下的所有文件夹根据其名字链接到<code>dotfiles/dot/oh-my-zsh/</code>下对应的目录中</li>
</ol>
<p>脚本内容可能会不定时发生变化，这里留下脚本文件地址，以供查阅。<a href="https://github.com/xpzero/dotfiles/blob/main/bootstrap.sh" target="_blank" rel="noopener noreferrer"><code>dotfiles/bootstrap.sh</code></a></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="dotfiles使用"><code>dotfiles/</code>使用<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#dotfiles%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="dotfiles使用的直接链接" title="dotfiles使用的直接链接">​</a></h2>
<p>从github的repo里<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">递归</span>克隆后执行<code>bootstrap.sh</code>脚本即可。</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/xpzero/dotfiles.git --recurse-submodules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> dotfiles </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> ./bootstrap.sh</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>记得安装成功后要重启终端。</p>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>为什么要递归克隆？</p><p><code>oh-my-zsh</code>、<code>alacritty/themes</code>、<code>powerlevel10k</code>等都是作为当前项目的子模块存在于repo目录中的。普通<code>clone</code>无法将子模块的内容下载下来，需要使用<code>--recurse-submodules</code>参数进行递归克隆</p><p>另外，这里repo下的子模块repo地址都是github域名，网络问题需要考虑一下。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/09/09/configure-dotfiles-os#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://blog.csdn.net/Quincuntial/article/details/54348471" target="_blank" rel="noopener noreferrer">Linux Shell获取文件夹下的文件名</a></p>
<p><a href="https://www.cnblogs.com/conefirst/articles/15232323.html" target="_blank" rel="noopener noreferrer">Shell bash和sh区别</a></p>
<p><a href="https://www.myfreax.com/how-to-create-symbolic-links-in-linux-using-the-ln-command/" target="_blank" rel="noopener noreferrer">Linux ln 命令创建符号链接</a></p>
<p><a href="https://www.bilibili.com/video/BV14X4y1P7bh/?share_source=copy_web&amp;vd_source=60cb976cb0acb8dc9492ec18c792ff15" target="_blank" rel="noopener noreferrer">【Linux】021-软硬链接</a>
<a href="https://github.com/alrra/dotfiles/blob/main/src/os/create_symbolic_links.sh" target="_blank" rel="noopener noreferrer">alrra/dotfiles</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/87053283" target="_blank" rel="noopener noreferrer">Git中submodule的使用</a></p>]]></content>
        <category label="dotfiles" term="dotfiles"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[whistle的安装及使用]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle"/>
        <updated>2023-09-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[平时工作中会用到基于whistle的light proxy软件，但是时不时会抽风，导致网络断联。考虑到之前也直接使用过whistle，做一个whistle的安装及使用记录，以备后用。]]></summary>
        <content type="html"><![CDATA[<p>平时工作中会用到基于<code>whistle</code>的<code>light proxy</code>软件，但是时不时会抽风，导致网络断联。考虑到之前也直接使用过<code>whistle</code>，做一个<code>whistle</code>的安装及使用记录，以备后用。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="安装并启动whistle">安装并启动<code>whistle</code><a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8whistle" class="hash-link" aria-label="安装并启动whistle的直接链接" title="安装并启动whistle的直接链接">​</a></h2>
<p>这里使用<code>brew</code>安装。也可以使用<code>Node</code>全局安装。<code>brew</code>不在本文介绍内，可自行了解。</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装whistle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> whistle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启动whistle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重启whistle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看whistle状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 status</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>whistle</code>启动成功后，点击出现的带有<code>8899</code>端口号的链接，可进入<code>whistle</code>配置页面</p>
<p><img loading="lazy" alt="whistle启动" src="https://xpzero.github.io/blog/assets/images/startup-e2c6fcc8f7caa32da62b798773fc8417.png" width="1952" height="400" class="img_rmWR"></p>
<p><code>whistle</code>配置页面</p>
<p><img loading="lazy" alt="whistle配置页面" src="https://xpzero.github.io/blog/assets/images/config-fa5c9f3cfe00f0b407964e0620540c6d.png" width="1754" height="636" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="安装whistle证书">安装<code>whistle</code>证书<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%AE%89%E8%A3%85whistle%E8%AF%81%E4%B9%A6" class="hash-link" aria-label="安装whistle证书的直接链接" title="安装whistle证书的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>Whistle v2.9.14 版本开始支持通过命令行 w2 proxy ... 设置<span style="background-color:orange;border-radius:2px;color:#fff;padding:0.2rem">系统的全局代理</span>，以及 w2 ca ... 安装系统根证书（目前只支持 Windows 和 Mac 平台）</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="检查whistle版本">检查whistle版本<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E6%A3%80%E6%9F%A5whistle%E7%89%88%E6%9C%AC" class="hash-link" aria-label="检查whistle版本的直接链接" title="检查whistle版本的直接链接">​</a></h3>
<p>检查安装的<code>whistle</code>版本，执行下面的命令</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">whistle </span><span class="token parameter variable" style="color:#36acaa">-V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 或者</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 </span><span class="token parameter variable" style="color:#36acaa">-V</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="whistle 版本" src="https://xpzero.github.io/blog/assets/images/version-efa82395f2c00ea2ed973b68bf8c0c97.png" width="488" height="106" class="img_rmWR"></p>
<p>我这里是<code>2.9.57 &gt; 2.9.14</code>版本，所以就用命令行参数进行证书的安装及请求代理了。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="安装证书">安装证书<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6" class="hash-link" aria-label="安装证书的直接链接" title="安装证书的直接链接">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>安装证书前要先启动whistle</p></div></div>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装本地运行的 Whistle 实例根证书（自动检测当前运行的默认实例，如果没有取默认取 8899 端口）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 ca</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="安装证书" src="https://xpzero.github.io/blog/assets/images/ca-2ea72c583726b17e7be1b5668d6e4d01.png" width="1340" height="102" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="配置代理">配置代理<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86" class="hash-link" aria-label="配置代理的直接链接" title="配置代理的直接链接">​</a></h2>
<p>使用以下命令即可进行全局代理</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 代理 127.0.0.1:8899</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 proxy</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="定义代理规则">定义代理规则<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%AE%9A%E4%B9%89%E4%BB%A3%E7%90%86%E8%A7%84%E5%88%99" class="hash-link" aria-label="定义代理规则的直接链接" title="定义代理规则的直接链接">​</a></h2>
<p>代理成功后可在<a href="http://127.0.0.1:8899/" target="_blank" rel="noopener noreferrer">本地配置页面</a> 配置代理规则。这里拿<code>www.baidu.com</code>和<code>youdao.com</code>做测试。更多配置规则可见<a href="https://wproxy.org/whistle/pattern.html" target="_blank" rel="noopener noreferrer">匹配模式</a></p>
<p><img loading="lazy" alt="代理规则" src="https://xpzero.github.io/blog/assets/images/rules-de2d40a95520d1956653c89af1fb43e6.png" width="1706" height="600" class="img_rmWR"></p>
<p><img loading="lazy" alt="规则变量" src="https://xpzero.github.io/blog/assets/images/values-fe1a5a479422ba083a2441ffc826d31f.png" width="1580" height="520" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="验证代理">验证代理<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E9%AA%8C%E8%AF%81%E4%BB%A3%E7%90%86" class="hash-link" aria-label="验证代理的直接链接" title="验证代理的直接链接">​</a></h2>
<p>在<code>www.baidu.com</code>下，渲染了<code>youdao.com</code>的内容。代理成功！</p>
<p><img loading="lazy" alt="验证" src="https://xpzero.github.io/blog/assets/images/verify-5bb802bc960bd9631e2ab83391144e98.png" width="1768" height="1868" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="关闭whistle并取消代理">关闭<code>whistle</code>并取消代理<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%85%B3%E9%97%ADwhistle%E5%B9%B6%E5%8F%96%E6%B6%88%E4%BB%A3%E7%90%86" class="hash-link" aria-label="关闭whistle并取消代理的直接链接" title="关闭whistle并取消代理的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>关闭whistle后一定要停止代理，否则会没网</p></div></div>
<p>执行以下命令即可。</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 关闭whistle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 停止代理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 proxy off</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="卸载whistle">卸载<code>whistle</code><a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%8D%B8%E8%BD%BDwhistle" class="hash-link" aria-label="卸载whistle的直接链接" title="卸载whistle的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_zZMm alert alert--success"><div class="admonitionHeading_j6SO"><span class="admonitionIcon_Kaai"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_C26S"><p>卸载whistle前一定要关闭代理。否则就需要去网络设置里面手动关闭代理。</p></div></div>
<p>使用以下命令即可</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">brew uninstall whistle</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="安装命令组合">安装命令组合<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%E7%BB%84%E5%90%88" class="hash-link" aria-label="安装命令组合的直接链接" title="安装命令组合的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="brew安装"><code>brew</code>安装<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#brew%E5%AE%89%E8%A3%85" class="hash-link" aria-label="brew安装的直接链接" title="brew安装的直接链接">​</a></h3>
<p>整体下来使用<code>brew</code>安装、卸载<code>whistle</code>的一套命令如下</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> whistle </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> w2 start </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> w2 ca </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> w2 proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 卸载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 proxy off </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> brew uninstall whistle</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="node安装"><code>Node</code>安装<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#node%E5%AE%89%E8%A3%85" class="hash-link" aria-label="node安装的直接链接" title="node安装的直接链接">​</a></h3>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> whistle </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> w2 start </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> w2 ca </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> w2 proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 卸载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 proxy off </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> uninstall </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> whistle</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考">参考<a href="https://xpzero.github.io/blog/index/2023/09/09/install-using-whistle#%E5%8F%82%E8%80%83" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2>
<p><a href="https://wproxy.org/whistle/install.html" target="_blank" rel="noopener noreferrer">安装启动</a></p>]]></content>
        <category label="whistle" term="whistle"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用Hugo构建个人博客并托管至Github Pages]]></title>
        <id>https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages</id>
        <link href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages"/>
        <updated>2023-09-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[网上冲浪看到别人的博客好简洁好好看，我也要整一套🤓。But！来来回回在网上查询，又有时候忘记要干啥整了一天才搞定🙈。这里记录下我「贪」的辛苦🥹]]></summary>
        <content type="html"><![CDATA[<p>网上冲浪看到别人的博客好简洁好好看，我也要整一套🤓。But！来来回回在网上查询，又有时候忘记要干啥整了一天才搞定🙈。这里记录下我「贪」的辛苦🥹</p>
<p>现已用<code>Docusaurus</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="明确目标">明确目标<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E6%98%8E%E7%A1%AE%E7%9B%AE%E6%A0%87" class="hash-link" aria-label="明确目标的直接链接" title="明确目标的直接链接">​</a></h2>
<p>首先，我们要明确一下自己要干什么？铭记初心，方得始终，深有体会😕</p>
<ol>
<li>搭建博客，拥抱批评</li>
<li>将博客内容托管至Github Pages，进行网站白嫖。</li>
</ol>
<p>那么如何搭建博客呢？我这次使用的是Hugo。其实中间有倒腾过Hexo、Netlify全都夭折。
其实使用静态网站构建框架生成本地博客挺快捷、简单的，时间主要浪费在了代码托管那一块儿。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="hugo">Hugo<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#hugo" class="hash-link" aria-label="Hugo的直接链接" title="Hugo的直接链接">​</a></h2>
<p>一开始是使用的Hexo进行博客的生成，但是在搜索代码托管的过程中发现有人说，Hugo更加方便、易用。</p>
<p><img loading="lazy" alt="Why Hugo" src="https://xpzero.github.io/blog/assets/images/useHugo_why-hugo-dd7150b80ef0eee4d1359393ee96eade.png" width="1392" height="122" class="img_rmWR"></p>
<p>哇！看到这里岂能坐视不管？咱也用！当时已经是4 AM了🥺，这种状态有时候真是让人又爱又恨☹️</p>
<p>说干就干。进入<a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>官网，就看见上面写着「The world's fastest framework for buiding websites」🧐</p>
<p><img loading="lazy" alt="The world&amp;#39;s fastest framework for buiding websites」" src="https://xpzero.github.io/blog/assets/images/useHugo_fastest-16f7ae2c8e4700cb07cf5e227a8383c0.png" width="1612" height="1026" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="安装hugo">安装Hugo<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E5%AE%89%E8%A3%85hugo" class="hash-link" aria-label="安装Hugo的直接链接" title="安装Hugo的直接链接">​</a></h3>
<p>这里跟着官网来就好了。我是今年刚买的Mac，所以这里就记录下Mac下的安装过程。</p>
<p>一定要有<code>git</code>环境，因为<code>Hugo</code>的主题要从<code>github</code>上获取，没有<code>git</code>拿不到。</p>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 这里brew是安装了Homebrew，用来管理各种包的安装，可以理解为软件管理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> hugo</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建一个website，因为我是要搭建博客，所以这里起名叫blog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 这个命令会创建blog目录其中会有一些空的结构目录以备后用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hugo new site blog</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> blog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 开始获取博客主题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> submodule </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> https://github.com/nanxiaobei/hugo-paper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 将主题配置写入hugo.toml配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"theme = 'paper'"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> hugo.toml</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 启动本地服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hugo server</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 该命令可以生成静态资源，主要为资源托管做准备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 它会生成一个public/，里面的文件就是博客的静态资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hugo</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="配置hugo">配置Hugo<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E9%85%8D%E7%BD%AEhugo" class="hash-link" aria-label="配置Hugo的直接链接" title="配置Hugo的直接链接">​</a></h3>
<p>这里最重要的就是<code>baseURL</code>，如果配置的不对，那么资源部署到GitHub之后就会导致<code>css</code>等资源路径找不到而造成页面样式丢失。</p>
<div class="language-toml codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-toml codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain"># 可以理解为是部署到Github之后，博客网站的基础路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 一定要带上GitHub上的仓库名哦！这个地址可以在配置公开仓库的Github Pages的设置那里拿到。有一个`Visit site`按钮，点击即可进入博客</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseURL = 'https://xpzero.github.io/blog'</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>到此，一个博客网站就算是已经基本完成了，博客中分享的文章就需要我自己后续再补充调整了。现在可以开始这篇文章的重要部分了！</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="托管博客资源到github">托管博客资源到GitHub<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E6%89%98%E7%AE%A1%E5%8D%9A%E5%AE%A2%E8%B5%84%E6%BA%90%E5%88%B0github" class="hash-link" aria-label="托管博客资源到GitHub的直接链接" title="托管博客资源到GitHub的直接链接">​</a></h2>
<p><strong>有一个情况要先说明一下，GitHub的GitHub Pages使用的前提是仓库是公开的，不能是私有的。</strong></p>
<p><img loading="lazy" alt="Github Pages configure" src="https://xpzero.github.io/blog/assets/images/useHugo_enable-pages-96ede7eb77e0a8951fdcd71754e7a356.png" width="2830" height="1042" class="img_rmWR"></p>
<p>这里要先思考一下，我们托管博客资源是把包括主题等在内的所有文件都放在公开仓库吗？有点「裸奔」的感觉🤨。但是不把所有的博客资源做一个版本控制，似乎也不习惯，该怎么办呢？</p>
<p>经过不懈的努力，一直搜啊搜，了解到了可以通过创建两个仓库，并建立两个仓库之间的连接来托管博客资源到GitHub。两个仓库的作用如下：</p>
<ul>
<li>
<p>私有仓库，存放所有包括主题等资源在内的源文件</p>
</li>
<li>
<p>公开仓库，仅存放通过<code>hugo</code>命令生成的<code>public/</code>下的文件</p>
</li>
<li>
<p>二者建立联系，当私有仓库有变动时，公开仓库也跟着变动</p>
<ul>
<li>通过<code>shell</code>脚本，当私有仓库的内容被更新后，执行脚本将私有仓库中的<code>public/</code>内的所有文件上传至公开仓库的指定分支，完成部署</li>
<li>通过在私有仓库创建<code>Github Actions</code>的<code>workflows</code>的方式自动完成上面的动作👏。</li>
</ul>
</li>
</ul>
<p>本着能自动就不手动的原则，当然要采用<code>Github Actions</code>的方式让它自动完成，别来烦我咯😎。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="授权问题">授权问题<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E6%8E%88%E6%9D%83%E9%97%AE%E9%A2%98" class="hash-link" aria-label="授权问题的直接链接" title="授权问题的直接链接">​</a></h3>
<p>就是因为这个问题，时间如流水般一去不返。😑</p>
<p><img loading="lazy" alt="pre-auth" src="https://xpzero.github.io/blog/assets/images/useHugo_auth_pre-a50bc838549486464c56a31d7ed80eb8.png" width="1496" height="554" class="img_rmWR"></p>
<p>因为公开仓库和私有仓库是两个单独的仓库，所以需要使用<code>Personal access token</code>.其目的是为了让<code>worksflows</code>可以使用<code>git</code>的api</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="创建personal-access-token">创建<code>Personal access token</code><a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E5%88%9B%E5%BB%BApersonal-access-token" class="hash-link" aria-label="创建personal-access-token的直接链接" title="创建personal-access-token的直接链接">​</a></h4>
<p>这里有两种方式，官方推荐的第一种，我实践的时候使用的第二种😛</p>
<ul>
<li><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-fine-grained-personal-access-token" target="_blank" rel="noopener noreferrer">Creating a fine-grained personal access token</a></li>
<li><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic" target="_blank" rel="noopener noreferrer">Creating a personal access token (classic)</a></li>
</ul>
<p>开始创建</p>
<p><img loading="lazy" alt="pat-pre" src="https://xpzero.github.io/blog/assets/images/useHugo_pat-pre-4681d5ee9ec76243842c3ca81efecccc.png" width="398" height="830" class="img_rmWR"><img loading="lazy" alt="pat-pre" src="https://xpzero.github.io/blog/assets/images/useHugo_pat-pre2-63369a9a27417836192065b3d2db3b4b.png" width="244" height="836" class="img_rmWR"></p>
<p>这里因为我创建过<code>Personal access token</code>，所以跟没有创建过的不一样。点击<code>Generate new token</code>可以再建。点击之前创建过的<code>token</code>, 可以进去选择重新生成。
<img loading="lazy" alt="pat-pre" src="https://xpzero.github.io/blog/assets/images/useHugo_pat-288846777838c9329fa1d90051180ad7.png" width="2188" height="644" class="img_rmWR"></p>
<p>在配置页面勾选完权限，设置名字后保存，会生成一串<code>key</code>，稍微存一下，要给私有库创建<code>Secrets</code>用，也可以重新生成。</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="私有库添加secrets">私有库添加<code>Secrets</code><a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E7%A7%81%E6%9C%89%E5%BA%93%E6%B7%BB%E5%8A%A0secrets" class="hash-link" aria-label="私有库添加secrets的直接链接" title="私有库添加secrets的直接链接">​</a></h4>
<p>其目的是为了加密<code>Personal access token</code>.如果有一天，我们更换了<code>Personal access token</code>，就要同步修改<code>workflows</code>。使用被加密的<code>token</code>，不仅可以在<code>workflows</code>中动态读取<code>token</code>还可以让信息更加安全。</p>
<p><img loading="lazy" alt="create secrets" src="https://xpzero.github.io/blog/assets/images/useHugo_secrets-0f94e2f5d8a099d8b0fe2bcbae4b81e7.png" width="2838" height="1650" class="img_rmWR"><img loading="lazy" alt="secrets2" src="https://xpzero.github.io/blog/assets/images/useHugo_secrets2-a7428d44ac7a81af9f326aa4abdfa697.png" width="1266" height="1030" class="img_rmWR"></p>
<p>如果权限没配好在<code>workflows</code>运行的时候就会出现<code>fatal: could not read Username for 'https://github.com': No such device or address</code>的报错</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="创建公开仓库">创建公开仓库<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E5%88%9B%E5%BB%BA%E5%85%AC%E5%BC%80%E4%BB%93%E5%BA%93" class="hash-link" aria-label="创建公开仓库的直接链接" title="创建公开仓库的直接链接">​</a></h3>
<p><img loading="lazy" alt="public repo" src="https://xpzero.github.io/blog/assets/images/useHugo_public-repo-b65c6126f034636b261137231aa39724.png" width="1550" height="1196" class="img_rmWR"></p>
<p>记得配置<code>Github Pages</code>。如果公开仓库有<code>gh-pages</code>分支，该仓库会被默认设置<code>Github Pages</code>，且其触发部署的分支即为<code>gh-pages</code>.该分支被<code>push</code>后会触发资源部署机制自动将资源部署发布。下面的例子是使用的<code>main</code>分支，需要手动设置<code>Github Pages</code>，仍然使用<strong>分支触发</strong>的方式进行资源部署.</p>
<p><img loading="lazy" alt="public pages" src="https://xpzero.github.io/blog/assets/images/useHugo_public-pages-74324f5ee364b2e4b21dbabbcd48f908.png" width="2874" height="1186" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="创建私有仓库">创建私有仓库<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93" class="hash-link" aria-label="创建私有仓库的直接链接" title="创建私有仓库的直接链接">​</a></h3>
<p><img loading="lazy" alt="创建私有仓库" src="https://xpzero.github.io/blog/assets/images/useHugo_create-repo-5411200eba4a8772f01b0fbb93c2f1ff.png" width="1368" height="1670" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="创建workflows">创建workflows<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E5%88%9B%E5%BB%BAworkflows" class="hash-link" aria-label="创建workflows的直接链接" title="创建workflows的直接链接">​</a></h3>
<p>要在<strong>私有仓库</strong>创建<code>workflows</code>.</p>
<p><img loading="lazy" alt="创建workflows" src="https://xpzero.github.io/blog/assets/images/useHugo_create-workflows-0e7d96de897fa6c9ad22bb3b6946ea6d.png" width="1876" height="972" class="img_rmWR"></p>
<p>这里我们选安装自己的<code>workflows</code>就可以了，为避免出错其配置内容尽量和我下面给出的配置内容一致。</p>
<div class="language-toml codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-toml codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain"># Sample workflow for building and deploying a Hugo site to GitHub Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: Deploy Hugo site to Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # push 触发actions。Runs on pushes targeting the default branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # main分支上的push触发actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    branches: ["main"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Allows you to run this workflow manually from the Actions tab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # workflow_dispatch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Build job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HUGO_VERSION: 0.117.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uses: actions/checkout@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: push to Github Pages repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        working-directory: ./public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # echo "&lt;domain&gt;" &gt; CNAME 使用自定义域名的话，可以把这个加在git init上面.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 这些地方需要修改：YOUR_NAME（可以随意）、YOUR_EMAIL、YOUR_COMMIT_MESSAGE、YOUR_PERSONAL_ACCESS_TOKEN、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # YOUR_USERNAME（你的github账户名）、YOUR_PUBLIC_REPO_NAME（公开仓库名）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        run: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          git checkout -b main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          git add -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          git -c user.name="YOUR_NAME" -c user.email="YOUR_EMAIL" commit -m "YOUR_COMMIT_MESSAGE"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          git remote add origin https://${{secrets.YOUR_PERSONAL_ACCESS_TOKEN}}@github.com/YOUR_USERNAME/YOUR_PUBLIC_REPO_NAME.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          git push origin main -f -q</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="edit workflows" src="https://xpzero.github.io/blog/assets/images/useHugo_edit-workflows-f21464ec00e4bc0c47e999ae1f0bae6f.png" width="3826" height="1318" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="撒花">撒花🎉<a href="https://xpzero.github.io/blog/index/2023/09/04/hugo-build-blog-using-github-pages#%E6%92%92%E8%8A%B1" class="hash-link" aria-label="撒花🎉的直接链接" title="撒花🎉的直接链接">​</a></h3>
<p><code>workflows</code>的变更被<code>commit</code>之后，就可以在<code>Actions</code>面板中看到<code>workflows</code>的运行记录了。</p>
<p><img loading="lazy" alt="workflows log" src="https://xpzero.github.io/blog/assets/images/useHugo_workflows-0548e393b5781f2b160f4cec05c777ef.png" width="2146" height="1464" class="img_rmWR"></p>
<p>另外，公开仓库也因为有之前配置<code>Github Pages</code>时设置的因分支代码改动而触发部署的配置，在<code>Actions</code>面板也能看到对应的部署记录</p>
<p><img loading="lazy" alt="finish" src="https://xpzero.github.io/blog/assets/images/useHugo_finish-d12aa1ec4c9fe2eea099cd7891918745.png" width="1576" height="1406" class="img_rmWR"></p>
<h1>感恩</h1>
<p><a href="https://phoenixnap.com/kb/git-ssh-vs-https" target="_blank" rel="noopener noreferrer">SSH vs. HTTPS for Git: Which One Should You Use?</a></p>
<p><a href="https://www.cnblogs.com/scofi/p/6617394.html" target="_blank" rel="noopener noreferrer">SSH公钥登录原理</a></p>
<p><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/about-authentication-to-github" target="_blank" rel="noopener noreferrer">About authentication to GitHub</a></p>
<p><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens" target="_blank" rel="noopener noreferrer">Managing your personal access tokens
</a>
<a href="https://juejin.cn/post/7120474763910676488" target="_blank" rel="noopener noreferrer">GitHub 私有仓库免费开启 GitHub Pages 的可行性方案</a></p>
<p><a href="https://juejin.cn/post/7008847699919241229" target="_blank" rel="noopener noreferrer">通过 GitHub Actions 实现私有仓库的免费 Github Pages 部署</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/37752930" target="_blank" rel="noopener noreferrer">如何使用Hugo在GitHub Pages上搭建免费个人网站</a></p>
<p><a href="https://www.wenhui.space/docs/04-build-blog-site/hugo_deploy_to_github/" target="_blank" rel="noopener noreferrer">将hugo博客部署到github</a></p>
<p><a href="https://kuang.netlify.app/blog/hugo.html" target="_blank" rel="noopener noreferrer">HUGO</a></p>]]></content>
        <category label="Hexo" term="Hexo"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[手写Promise源码过Promise A+规范]]></title>
        <id>https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+</id>
        <link href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+"/>
        <updated>2022-11-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[适用人群]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_IQQo" id="适用人群">适用人群<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E9%80%82%E7%94%A8%E4%BA%BA%E7%BE%A4" class="hash-link" aria-label="适用人群的直接链接" title="适用人群的直接链接">​</a></h2>
<p>可熟练使用Promise</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="前言">前言<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E5%89%8D%E8%A8%80" class="hash-link" aria-label="前言的直接链接" title="前言的直接链接">​</a></h2>
<p>关于手写Promise的源码之前尝试了不止4，5次但都以失败告终，不是觉得难不想坚持就是项目加急没有时间导致搁置。这次下定决心要花一个完整的时间段攻破这个事情，因为脑袋不是很灵光，总的算下来差不多4-5个小时，但是这里结果最重要，终于按照可以理解的思路完成了通过Promise A+规范的Promise代码编写！下面根据我的编写过程总结一下编码思路方便之后的理解。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="准备工作">准备工作<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" class="hash-link" aria-label="准备工作的直接链接" title="准备工作的直接链接">​</a></h2>
<p>需要通过Promise A+规范，那就需要有测试用例来帮助我们判断自己写的的代码是否会经得住Promise A+的考验。所以我们可以准备一个专门用来检测Promise A+规范的npm包，来帮助我们判断编写的代码是否已经成功通过Promise A+规范。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="添加promises-aplus-tests包">添加<code>promises-aplus-tests</code>包<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E6%B7%BB%E5%8A%A0promises-aplus-tests%E5%8C%85" class="hash-link" aria-label="添加promises-aplus-tests包的直接链接" title="添加promises-aplus-tests包的直接链接">​</a></h3>
<p>npm包管理工具可以根据自己的习惯选取使用，这里使用<code>yarn</code></p>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add promises-aplus-tests -D</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="修改packagejson中的scripts">修改<code>package.json</code>中的<code>scripts</code><a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E4%BF%AE%E6%94%B9packagejson%E4%B8%AD%E7%9A%84scripts" class="hash-link" aria-label="修改packagejson中的scripts的直接链接" title="修改packagejson中的scripts的直接链接">​</a></h3>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">"scripts": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "test": "promises-aplus-tests MyPromise.js"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将<code>MyPromise.js</code>换成自己写的代码文件，如果有文件夹嵌套需要带上路径。</p>
<p>这样我们就可以在认为代码编写完成后使用<code>yarn test</code>测试自己的代码了。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="promise-a规范">Promise A+规范<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#promise-a%E8%A7%84%E8%8C%83" class="hash-link" aria-label="Promise A+规范的直接链接" title="Promise A+规范的直接链接">​</a></h2>
<p>既然我们写的代码要通过Promise A+规范，我们就得要了解规范里的内容是什么。关于规范相关的内容，可以在这里看👉👉👉<a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promises/A+</a> 。因为不能一屏截出来，所以就不贴出来了，感兴趣的同学可以进去看。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="promise基本特征">Promise基本特征<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#promise%E5%9F%BA%E6%9C%AC%E7%89%B9%E5%BE%81" class="hash-link" aria-label="Promise基本特征的直接链接" title="Promise基本特征的直接链接">​</a></h2>
<p>我们先梳理一番自己对Promise的了解，便于后续的理解。</p>
<ul>
<li>promise函数对象的构造函数有一个回调函数作为参数，我们称为c0，回调函数会在函数执行时同步执行</li>
<li>c0的参数中又有两个回调函数，我们称为c1，c2</li>
<li>c1、c2会在c0中的我们指定的位置执行</li>
<li>promise的初始状态为pending，内部的初始值为undefined</li>
<li>c1执行后promise的状态会变为fulfilled，如果Promise有then方法，则then方法会被异步执行</li>
<li>c2执行后promise的状态会变为rejected，如果Promise有catch方法，则catch方法会被异步执行</li>
<li>c1、c2只会被执行一个</li>
<li>then函数中的返回值可以任意值，也可以是新的promise，不可以是本promise，会报错提示<code>Chaining cycle detected for promise #&lt;Promise&gt;</code></li>
<li>then函数中返回新的promise后，下面接着的then、catch会跟着新的promise的状态走</li>
<li>多个then函数在promise的状态转为fulfilled之后会依次异步执行</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="源码">源码<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E6%BA%90%E7%A0%81" class="hash-link" aria-label="源码的直接链接" title="源码的直接链接">​</a></h2>
<p>executor的错误捕获没有处理</p>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">PENDING = "pending";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FULFILLED = "fulfilled";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REJECTED = "rejected";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MyPromise {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  state = PENDING;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  result = void 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _resolveArr = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _rejectedArr = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  constructor(executor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const resolve = (value) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (this.state === PENDING) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.state = FULFILLED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.result = value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this._resolveArr.forEach((func) =&gt; func());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const reject = (reason) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (this.state === PENDING) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.state = REJECTED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.result = reason;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this._rejectedArr.forEach((func) =&gt; func());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    executor(resolve, reject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _handleSettledFunc(promise, x, resolve, reject) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 检测循环调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (x === promise) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reject(new TypeError("Chaining cycle detected for promise #&lt;Promise&gt;"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // then中返回新的promise时使用新promise状态。x为假值时忽略.then的判断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (x &amp;&amp; (typeof x === "object" || typeof x === "function")) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let done = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 捕获x.then及then.call的报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const then = x.then;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (typeof then === "function") {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          then.call(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            x,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (y) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              if (done) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              done = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              this._handleSettledFunc(promise, y, resolve, reject);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (r) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              if (done) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              done = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              reject(r);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else { // 没有报错直接resolve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          resolve(x);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } catch (e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (done) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        done = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reject(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resolve(x);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * 返回一个promise对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * @param {function} onFulfilled resolve后需要执行的函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * @param {function} onRejected reject后需要执行的函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * @returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  then(onFulfilled, onRejected) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const promise = new MyPromise((resolve, reject) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      onFulfilled =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        typeof onFulfilled === "function" ? onFulfilled : (value) =&gt; value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      onRejected =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        typeof onRejected === "function"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ? onRejected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          : (reason) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              throw reason;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const _handleFunc = (handleFunc) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 只能在这使用setTimeout，否则promise变量不能传递，报未初始化的错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setTimeout(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // 捕获handleFunc(this.result)中的报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this._handleSettledFunc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              promise,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              handleFunc(this.result),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              resolve,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              reject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reject(error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 返回的函数会被异步调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (this.state === FULFILLED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _handleFunc(onFulfilled);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } else if (this.state === REJECTED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _handleFunc(onRejected);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 数组形式保存onFulfilled、onRejected函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this._resolveArr.push(() =&gt; _handleFunc(onFulfilled));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this._rejectedArr.push(() =&gt; _handleFunc(onRejected));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return promise;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MyPromise.defer = MyPromise.deferred = function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let dfd = {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dfd.promise = new MyPromise((resolve, reject) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfd.resolve = resolve;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfd.reject = reject;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return dfd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module.exports = MyPromise;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考链接">参考链接<a href="https://xpzero.github.io/blog/index/2022/11/15/code-of-Promise-pass-Promise-A+#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="hash-link" aria-label="参考链接的直接链接" title="参考链接的直接链接">​</a></h2>
<p><a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promises/A+</a></p>
<p><a href="https://www.cnblogs.com/lhx9527/p/14158460.html" target="_blank" rel="noopener noreferrer">promises-aplus-tests 测试手写promise过程 - 365/24/60 - 博客园</a></p>
<p><a href="https://juejin.cn/post/6844903796129136654" target="_blank" rel="noopener noreferrer">Promise的源码实现（完美符合Promise/A+规范）</a></p>]]></content>
        <category label="js" term="js"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[git rebase使用记录]]></title>
        <id>https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage</id>
        <link href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage"/>
        <updated>2022-11-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[之前虽然听说过git的rebase命令，但是从未使用过，所以不太了解。因为一次需求的小改动提交了很多无用的commit，不想带到远程仓库上被嫌弃🫣，所以尝试了下如何使用，现将使用情况记录下来以便后续使用参考。]]></summary>
        <content type="html"><![CDATA[<p>之前虽然听说过git的rebase命令，但是从未使用过，所以不太了解。因为一次需求的小改动提交了很多无用的commit，不想带到远程仓库上被嫌弃🫣，所以尝试了下如何使用，现将使用情况记录下来以便后续使用参考。</p>
<p>命令作用</p>
<ul>
<li>可以将多个commit合并成一个</li>
<li>可以让git graph更好看一点</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="命令使用">命令使用<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="命令使用的直接链接" title="命令使用的直接链接">​</a></h2>
<p>git rebase的命令形式如下</p>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">git rebase -i [startpoint]  [endpoint]</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>startpoint</code>和<code>endpoint</code>就是commitid。rebase的区间范围用数学集合的形式表示为<code>(startpoint, endpoint]</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="案例描述">案例描述<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E6%A1%88%E4%BE%8B%E6%8F%8F%E8%BF%B0" class="hash-link" aria-label="案例描述的直接链接" title="案例描述的直接链接">​</a></h2>
<p>现在我们的本地及远程仓库的提交记录长这个样子</p>
<p><img loading="lazy" alt="base" src="https://xpzero.github.io/blog/assets/images/base-f105ceb63c9d25464f9d125ec4cebd22.png" width="1980" height="616" class="img_rmWR"></p>
<p><img loading="lazy" alt="log" src="https://xpzero.github.io/blog/assets/images/log-25438ff490bdbc1a6f1990ef75fb103d.png" width="848" height="1446" class="img_rmWR"></p>
<p>文件内容长这样</p>
<p><img loading="lazy" alt="content" src="data:;base64,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" width="192" height="308" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="第一步">第一步<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E7%AC%AC%E4%B8%80%E6%AD%A5" class="hash-link" aria-label="第一步的直接链接" title="第一步的直接链接">​</a></h2>
<p>首先要明确我们的目标是什么？</p>
<p>我们的目标就是把「做测试」之后的commit合并成一个并然后提交到远程。即下图中框选的commit合并成一个，且提交内容修改为<code>feat: add file &amp; write content</code></p>
<p><img loading="lazy" alt="first" src="https://xpzero.github.io/blog/assets/images/first-e26d5b77efd69d60823f600417d2c3d5.png" width="1998" height="636" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="第二步">第二步<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E7%AC%AC%E4%BA%8C%E6%AD%A5" class="hash-link" aria-label="第二步的直接链接" title="第二步的直接链接">​</a></h2>
<p>为了实现我们的目的，我们需要找到要rebase的commitid。案例中要rebase的<code>startpoint</code>就是「做测试」的commitId，即为<code>ed5476e</code>；根据需求发现需要rebase到当前所在的commit，则<code>endpoint</code>使用缺省值即可。在本例中即为：</p>
<div class="language-shell codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-shell codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> rebase </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> ed5476e</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>回车之后会进入一个vi编辑模式，可以看到下面的内容。</p>
<p><img loading="lazy" alt="second" src="https://xpzero.github.io/blog/assets/images/second-acd9735fd89c5a89857d94c3e62ca2a8.image" width="1302" height="1250" class="img_rmWR"></p>
<p>图中框选的就是一些可以在vi编辑里使用的命令，用来操作rebase的commit。</p>
<p>为了实现我们的目的，我们做如下处理</p>
<p><img loading="lazy" alt="second2" src="https://xpzero.github.io/blog/assets/images/second2-81d20746570325ebedb1bd32652c1a69.image" width="1292" height="1176" class="img_rmWR"></p>
<p>保存之后可以看到下面的内容，在这里可以修改rebase中的第一个commit's message</p>
<p><img loading="lazy" alt="second3" src="https://xpzero.github.io/blog/assets/images/second3-318e065b6961ed02b0f762bf5aec7f99.image" width="1350" height="654" class="img_rmWR"></p>
<p>我们修改内容为<code>feat: add file &amp; write content</code>后保存，会退出vi模式回到控制台，即为rebase完成</p>
<p><img loading="lazy" alt="second4" src="https://xpzero.github.io/blog/assets/images/second4-e5601d37d19544026c535605985de854.image" width="1334" height="634" class="img_rmWR"></p>
<p><img loading="lazy" alt="second5" src="https://xpzero.github.io/blog/assets/images/second5-c569ed02026d4c3b9a73ca8775e667ec.png" width="3020" height="1390" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="第三步">第三步<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E7%AC%AC%E4%B8%89%E6%AD%A5" class="hash-link" aria-label="第三步的直接链接" title="第三步的直接链接">​</a></h2>
<p>上线的修改都是在本地处理的，但既然我们已经rebase完成，那接下来就要进行发起mr的前一步了：推送代码到远程仓库</p>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">git rebase origin test-a</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是命令执行过后，可以看到下面的内容，推送被拒绝。</p>
<p><img loading="lazy" alt="third" src="https://xpzero.github.io/blog/assets/images/third-c16e291dbd6ce68f0400906a53940bde.png" width="2522" height="536" class="img_rmWR"></p>
<p>因为本地的commit记录已经和远端的不一致了，因为我们只是rebase，没有做代码上更改，所以强制推送即可</p>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">git rebase origin test-a -f</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>远程仓库该分支的提交记录就会被修改，但是提交时间还是rebase之前的提交时间。</p>
<p><img loading="lazy" alt="third2" src="https://xpzero.github.io/blog/assets/images/third2-8b84f2975b8c07885be03c441ea1f3ac.png" width="572" height="368" class="img_rmWR"></p>
<p><img loading="lazy" alt="third3" src="https://xpzero.github.io/blog/assets/images/third3-dbc98f9292bb8d2be311e1f29f9952b8.image" width="346" height="288" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="如何撤回rebase">如何撤回rebase？<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E5%A6%82%E4%BD%95%E6%92%A4%E5%9B%9Erebase" class="hash-link" aria-label="如何撤回rebase？的直接链接" title="如何撤回rebase？的直接链接">​</a></h2>
<p>实际工作中我们在rebase完成后可能会觉得不满意，想要撤回本次rebase。对于这种需求也是有应对方法的。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="查看所有历史commit记录">查看所有历史commit记录<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%8E%86%E5%8F%B2commit%E8%AE%B0%E5%BD%95" class="hash-link" aria-label="查看所有历史commit记录的直接链接" title="查看所有历史commit记录的直接链接">​</a></h3>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain">git reflog</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在本例中可以看到下面的内容，因为不停的测试，测试，测试，记录已经有很多了🥹</p>
<p><img loading="lazy" alt="all" src="https://xpzero.github.io/blog/assets/images/all-6d11099bc3563cf10354f2718ac944be.png" width="1498" height="1790" class="img_rmWR"></p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="应用对应的commit">应用对应的commit<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E5%BA%94%E7%94%A8%E5%AF%B9%E5%BA%94%E7%9A%84commit" class="hash-link" aria-label="应用对应的commit的直接链接" title="应用对应的commit的直接链接">​</a></h3>
<p>从上面的记录里我们可以找到想回到的commit。可以找到<code>0ce6f7a</code>，在这里有<code>feat: seven</code>的提交记录</p>
<div class="codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-text codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token plain"># 如果想要废弃本地内容直接应用提交记录上的改变可以使用「--hard」实现效果；否则可以不要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git reset --hard 0ce6f7a</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行命令可以看到下面的内容，之前的提交记录又回来了</p>
<p><img loading="lazy" alt="commit" src="https://xpzero.github.io/blog/assets/images/commit-5f8c4a4f79103ed1656216e36222c240.png" width="1912" height="1798" class="img_rmWR"></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="了解一些命令参数">了解一些命令参数<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0" class="hash-link" aria-label="了解一些命令参数的直接链接" title="了解一些命令参数的直接链接">​</a></h2>
<p>为了探究一些参数的使用效果，我们对之前的commit做如下处理</p>
<p><img loading="lazy" alt="params" src="https://xpzero.github.io/blog/assets/images/params-a7bfcd2607b1bb523446e1b20042aaa9.image" width="1274" height="1174" class="img_rmWR"></p>
<p>保存之后会进入另一个vi模式，可以看到下面的内容。其实就是修改rebase的第一个commit的message</p>
<p><img loading="lazy" alt="params2" src="https://xpzero.github.io/blog/assets/images/params2-5b2cf928ce214ade9a00e7b3d4849436.image" width="1358" height="734" class="img_rmWR"></p>
<p>所以我们可以编辑message为<code>feat: add file &amp; write content</code></p>
<p><img loading="lazy" alt="params3" src="https://xpzero.github.io/blog/assets/images/params3-44e47b08a836596c9f347556560bba37.image" width="1364" height="682" class="img_rmWR"></p>
<p>保存之后进入到最后的commit message修改vi模式，因为想看下不同的参数会有什么效果，所以我们不做修改直接保存。</p>
<p><img loading="lazy" alt="params4" src="https://xpzero.github.io/blog/assets/images/params4-a6053f8197c9c250ffb65f02dda0aae8.image" width="1142" height="950" class="img_rmWR"></p>
<p>保存之后就退出了vi回到了控制台，看到下面的内容</p>
<p><img loading="lazy" alt="params5" src="https://xpzero.github.io/blog/assets/images/params5-f3fff78d96147725f437e06cf286ac0c.png" width="1922" height="1106" class="img_rmWR"></p>
<p>那我们的rebase现在是什么效果呢？使用<code>git log</code>命令可以看到下面的内容</p>
<p><img loading="lazy" alt="params6" src="https://xpzero.github.io/blog/assets/images/params6-2ff8c4a592ba1469e4cdd807665175ad.png" width="2552" height="1744" class="img_rmWR"></p>
<p>总结参数使用的效果就是</p>
<ul>
<li>r，reword<!-- -->
<ul>
<li>保留commit有机会修改commit message</li>
</ul>
</li>
<li>p，pick<!-- -->
<ul>
<li>保留commit及commit message</li>
</ul>
</li>
<li>s，squash<!-- -->
<ul>
<li>保留commit但commit message会融入前一次的commit message</li>
</ul>
</li>
<li>f，fixup<!-- -->
<ul>
<li>保留commit但废弃commit message</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考文章">参考文章<a href="https://xpzero.github.io/blog/index/2022/11/05/git-rebase-useage#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0" class="hash-link" aria-label="参考文章的直接链接" title="参考文章的直接链接">​</a></h2>
<p><a href="https://juejin.cn/post/6844903600976576519" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844903600976576519</a>
<a href="https://www.jianshu.com/p/7e4cef3863e7" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/7e4cef3863e7</a></p>]]></content>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[mobx在react中的使用]]></title>
        <id>https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react</id>
        <link href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react"/>
        <updated>2022-10-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[安装依赖包]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_IQQo" id="安装依赖包">安装依赖包<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85" class="hash-link" aria-label="安装依赖包的直接链接" title="安装依赖包的直接链接">​</a></h2>
<div class="language-sh codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-sh codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i mobx-react@6.1.3 mobx@5.13.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> mobx-react@6.1.3 mobx@5.13.0</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="核心api">核心api<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E6%A0%B8%E5%BF%83api" class="hash-link" aria-label="核心api的直接链接" title="核心api的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="定义可观察数据">定义可观察数据<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%AE%9A%E4%B9%89%E5%8F%AF%E8%A7%82%E5%AF%9F%E6%95%B0%E6%8D%AE" class="hash-link" aria-label="定义可观察数据的直接链接" title="定义可观察数据的直接链接">​</a></h3>
<p>假设声明可观察数据的文件名为<code>test.js</code></p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="方式一">方式一<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E6%96%B9%E5%BC%8F%E4%B8%80" class="hash-link" aria-label="方式�一的直接链接" title="方式一的直接链接">​</a></h4>
<p>使用<code>observable()</code>函数</p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> observable </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mobx"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"xxxx"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="方式二">方式二<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E6%96%B9%E5%BC%8F%E4%BA%8C" class="hash-link" aria-label="方式二的直接链接" title="方式二的直接链接">​</a></h4>
<p>使用在<code>class</code>上使用装饰器</p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Test</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @observable name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"123"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @observable age </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="声明要监测数据的视图">声明要监测数据的视图<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%A3%B0%E6%98%8E%E8%A6%81%E7%9B%91%E6%B5%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A7%86%E5%9B%BE" class="hash-link" aria-label="声明要监测数据的视图的直接链接" title="声明要监测数据的视图的直接链接">​</a></h3>
<p>在视图中使用的可观察数据发生变化后，mobx会使当前使用可观察数据的组件重新渲染</p>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="类组件">类组件<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E7%B1%BB%E7%BB%84%E4%BB%B6" class="hash-link" aria-label="类组件的直接链接" title="类组件的直接链接">​</a></h4>
<p>使用<code>@observer</code>装饰器.如果<code>TestComponent</code>组件中使用的可观察数据发生变化，该组件会被重新渲染。
<strong>只能监测当前组件，不能深入子组件。想要深入子组件，需要子组件使用<code>@observer</code></strong></p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> observer </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mobx-react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">MobxData</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./test.js"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@observer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TestComponent</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// use observable data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token maybe-class-name">MobxData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_IQQo" id="函数式组件">函数式组件<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6" class="hash-link" aria-label="函数式组件的直接链接" title="函数式组件的直接链接">​</a></h4>
<p>使用<code>useObserver()</code>或者<code>observer()</code>。<strong>只能监测当前包裹的内容，不能深入子组件。想要深入子组件，需要子组件使用<code>useObserver()</code>或<code>observer()</code></strong></p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useObserver </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mobx-react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">MobxData</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./test.js"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">TestComponent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// use observable data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token maybe-class-name">MobxData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">div</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// function TestComponent() {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//    // use observable data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//    return useObserver(() =&gt; &lt;div&gt;{MobxData.name}&lt;/div&gt;);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// });</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="代码实现">代码实现<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="代码实现的直接链接" title="代码实现的直接链接">​</a></h2>
<p>使用函数式组件演示</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="定义共享数据">定义共享数据<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%AE%9A%E4%B9%89%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE" class="hash-link" aria-label="定义共享数据的直接链接" title="定义共享数据的直接链接">​</a></h3>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> action</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> observable </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mobx"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 使用装饰器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// class MobxData {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   @observable name = 'zoe';</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   @observable age = 12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   @action.bound</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   setName(name: string) {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     this.name = name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// export default new MobxData()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"xxx"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="创建组件">创建组件<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6" class="hash-link" aria-label="创建组件的直接链接" title="创建组件的直接链接">​</a></h3>
<div class="language-jsx codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-jsx codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useObserver </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mobx-react"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">commonData</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./MobxData"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Child</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onClick</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commonData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"_zhangsan"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"child render"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useObserver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      Welcome </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">commonData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text">!You're 12 years old.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">change name</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Child2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">onClick</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commonData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">age</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"child2 render"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useObserver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      Welcome xxx!You're </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">commonData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">age</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"> years old.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">onClick</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">change age</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const Child2 = observer(() =&gt; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   const onClick = () =&gt; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     commonData.age = Math.random() * 100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   console.log('child2 render')</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   return (</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &lt;div&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//         Welcome xxx!You're {commonData.age} years old.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//         &lt;button onClick={onClick}&gt;change age&lt;/button&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &lt;/div&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// })</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Parent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useObserver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Child</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Child2</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript arrow operator" style="color:#393A34">=&gt;</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">          commonData</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript property-access" style="color:#00009f">name</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">=</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript known-class-name class-name" style="color:#00009f">Math</span><span class="token tag script language-javascript punctuation" style="color:#393A34">.</span><span class="token tag script language-javascript method function property-access" style="color:#d73a49">random</span><span class="token tag script language-javascript punctuation" style="color:#393A34">(</span><span class="token tag script language-javascript punctuation" style="color:#393A34">)</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">*</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript number" style="color:#36acaa">100</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript operator" style="color:#393A34">+</span><span class="token tag script language-javascript" style="color:#00009f"> </span><span class="token tag script language-javascript string" style="color:#e3116c">"_qweqweqwe"</span><span class="token tag script language-javascript punctuation" style="color:#393A34">;</span><span class="token tag script language-javascript" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag script language-javascript" style="color:#00009f">        </span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">        修改名字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const Parent = observer(() =&gt; (</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   &lt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &lt;Child/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &lt;Child2/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     &lt;button onClick={() =&gt; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       commonData.name = Math.random() * 100 + '_qweqweqwe'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     }}&gt;修改名字&lt;/button&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   &lt;/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// @observer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// class Parent extends React.Component{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   render() {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     return (</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       &lt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//         &lt;Child/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//         &lt;Child2/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//         &lt;button onClick={() =&gt; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//           commonData.name = Math.random() * 100 + '_qweqweqwe'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//         }}&gt;修改名字&lt;/button&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//       &lt;/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//     )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//   }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">App</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      App</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">Parent</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="主文件">主文件<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E4%B8%BB%E6%96%87%E4%BB%B6" class="hash-link" aria-label="主文件的直接链接" title="主文件的直接链接">​</a></h3>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react-dom"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Parent</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./Parent"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Parent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"#root"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="总结">总结<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2>
<ul>
<li>起一个文件，使用<code>mobx</code>的<code>observable()</code>或者<code>@observable</code>创建共享数据并导出</li>
<li>在视图中使用<code>mobx-react</code>的<code>useObserver()</code>或者<code>observer()</code>或者<code>@observer</code>监测组件中可观察数据的变化<!-- -->
<ul>
<li>在某组件使用的可观察数据发生变化时该组件会被<code>rerender</code></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="填脑坑">填脑坑<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%A1%AB%E8%84%91%E5%9D%91" class="hash-link" aria-label="填脑坑的直接链接" title="填脑坑的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="action和actionbound有什么区别"><code>@action</code>和<code>@action.bound</code>有什么区别？<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#action%E5%92%8Cactionbound%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB" class="hash-link" aria-label="action和actionbound有什么区别的直接链接" title="action和actionbound有什么区别的直接链接">​</a></h3>
<p>示例代码</p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> action </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mobx"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Store</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">unbound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"unbound"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">arrow</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"arrow"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @action </span><span class="token function" style="color:#d73a49">unboundAction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"unboundAction"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bound</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unboundActionBound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"unboundActionBound"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @action </span><span class="token function-variable function" style="color:#d73a49">arrowAction</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"arrowAction"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @action</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bound</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">arrowActionBound</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"arrowActionBound"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> store </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Store</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> unbound </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">unbound</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> arrow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">arrow</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> unboundAction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">unboundAction</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> arrowAction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">arrowAction</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> unboundActionBound </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">unboundActionBound</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> arrowActionBound </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">arrowActionBound</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">unbound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">arrow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">unboundAction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">arrowAction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">unboundActionBound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">arrowActionBound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行后，可以看到日志输出如下</p>
<p><img loading="lazy" alt="log" src="https://xpzero.github.io/blog/assets/images/log-76e5069c8a9a79503c4b0cf9c5777829.png" width="1470" height="904" class="img_rmWR"></p>
<p>对原型的影响：</p>
<p><img loading="lazy" alt="prototype" src="https://xpzero.github.io/blog/assets/images/proto-c5c180007b5ff5174564fc8c765a0df5.png" width="1828" height="758" class="img_rmWR"></p>
<p>对this的影响</p>
<p><img loading="lazy" alt="this" src="https://xpzero.github.io/blog/assets/images/this-140559f27970f8cbace4f51ac489d48c.png" width="1586" height="546" class="img_rmWR"></p>
<p>但是mobx不推荐<code>action.bound</code>和箭头函数一起使用</p>
<blockquote>
<p><em>注意:&nbsp;<em>action.bound</em>&nbsp;不要和箭头函数一起使用；箭头函数已经是绑定过的并且不能重新绑定。</em></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="useobserver和observer的区别"><code>useObserver()</code>和<code>observer()</code>的区别？<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#useobserver%E5%92%8Cobserver%E7%9A%84%E5%8C%BA%E5%88%AB" class="hash-link" aria-label="useobserver和observer的区别的直接链接" title="useobserver和observer的区别的直接链接">​</a></h3>
<ul>
<li><code>useObserver()</code>在函数内使用。监测函数的返回值，使用方式像<code>useMemo</code></li>
<li><code>observer()</code>在函数外使用。监测高阶组件，使用方式像<code>React.memo</code></li>
</ul>
<p>以函数式组件为例</p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Parent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Child</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Child2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">button</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      onClick</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        commonData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"_qweqweqwe"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      修改名字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">button</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Parent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useObserver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Child</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Child2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">button</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        onClick</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          commonData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"_qweqweqwe"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        修改名字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">button</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考链接">参考链接<a href="https://xpzero.github.io/blog/index/2022/10/15/how-to-use-mobx-in-react#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="hash-link" aria-label="参考链接的直接链接" title="参考链接的直接链接">​</a></h2>
<p><a href="https://cn.mobx.js.org/refguide/action.html" target="_blank" rel="noopener noreferrer">action (动作)</a></p>
<p><a href="https://www.i4k.xyz/article/qq_43293207/117596040" target="_blank" rel="noopener noreferrer">React 状态管理工具 Mobx 基本使用_。烦啦的博客-程序员秘密</a></p>
<p><a href="https://stackoverflow.com/questions/48639891/difference-between-mobxs-action-bound-and-arrow-functions-on-class-functions" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/48639891/difference-between-mobxs-action-bound-and-arrow-functions-on-class-functions</a></p>]]></content>
        <category label="react" term="react"/>
        <category label="mobx" term="mobx"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[SharedWorker使用总结]]></title>
        <id>https://xpzero.github.io/blog/index/2022/10/14/SharedWorker</id>
        <link href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker"/>
        <updated>2022-10-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[最近有个需求要在浏览器页签之间实现信息共享，由第三方包处理。看过人家的效果介绍，嚯哦，闪瞎我的双眼！没见识过的技术，怎么也得看一看呀🧐]]></summary>
        <content type="html"><![CDATA[<p>最近有个需求要在浏览器页签之间实现信息共享，由第三方包处理。看过人家的效果介绍，嚯哦，闪瞎我的双眼！没见识过的技术，怎么也得看一看呀🧐</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="�介绍">介绍<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E4%BB%8B%E7%BB%8D" class="hash-link" aria-label="介绍的直接链接" title="介绍的直接链接">​</a></h2>
<blockquote>
<p><strong><code>SharedWorker</code></strong>&nbsp;接口代表一种特定类型的 worker，可以从几个浏览上下文中<em>访问</em>，例如几个窗口、iframe 或其他 worker。它们实现一个不同于普通 worker 的接口，<strong>具有不同的全局作用域</strong>，<a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope" target="_blank" rel="noopener noreferrer" title="Currently only available in English (US)">SharedWorkerGlobalScope</a>&nbsp;。</p>
</blockquote>
<blockquote>
<p><strong>备注：</strong> &nbsp;如果要使&nbsp;<strong>SharedWorker</strong>&nbsp;连接到多个不同的页面，这些页面必须是<code>同源</code>的（相同的协议、host 以及端口）。</p>
</blockquote>
<p>又称共享线程。之所以可以在多个浏览器页签中共享信息，是因为在页签的html中创建<code>SharedWorker</code>时，如果第一个参数相同，则视为同一线程，所以只要保证创建时的第一个参数相同，就可以在多页签间共享信息。</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="api">api<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#api" class="hash-link" aria-label="api的直接链接" title="api的直接链接">​</a></h2>
<p>下面给了一些基本的api使用。以下api的使用都基于<code>SharedWorker</code>的实例对象的port属性。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="创建">创建<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%88%9B%E5%BB%BA" class="hash-link" aria-label="创建的直接链接" title="创建的直接链接">​</a></h3>
<p>使用构造函数<code>SharedWorker()</code>创建<code>SharedWorker</code>实例。它有三个参数如下</p>
<p>MDN解释
<img loading="lazy" alt="api" src="https://xpzero.github.io/blog/assets/images/api-f950112641dff63b6ec13b8e03380e83.png" width="1582" height="1120" class="img_rmWR"></p>
<p>举例</p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sharedWorker </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SharedWorker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"被共享的js文件url"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"标识woker的名字"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  可选属性对象</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>自我“治愈”：</p>
<p>第一个参数：是被共享的js的url，<strong>要同源！</strong> 在共享线程中，我们总要做点什么。在哪里做呢？就在这个被共享的js文件中捣鼓。</p>
<p>第二个参数：可以标识当前的worker。在下文提到的<code>调试</code>中，我们会用到。主要用来确定，这个worker是不是我们现在写的worker，万一浏览器里有其他人写的worker呢？</p>
<p>第三个参数: 还没有深究过，这里就不介绍了。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="启用">启用<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%90%AF%E7%94%A8" class="hash-link" aria-label="启用的直接链接" title="启用的直接链接">​</a></h3>
<p>这里先随便给个url做示例～</p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sharedWorker </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SharedWorker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"sharedWorker.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"test worker"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 开启与共享线程的连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sharedWorker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>MDN解释
<img loading="lazy" alt="api2" src="https://xpzero.github.io/blog/assets/images/api2-e0b9dc1369b14d3bccf77171cc5fd95a.png" width="1620" height="256" class="img_rmWR"></p>
<p>关于<code>start()</code>的使用，可以参考下文中<code>填脑坑</code>的第一条。</p>
<p>上面的<code>MessagePort</code>对象就是<code>sharedWorker.port</code>。所有关于浏览器页签和共享线程的通信都是通过<code>sharedWorker.port</code>来控制和管理。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="关闭">关闭<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%85%B3%E9%97%AD" class="hash-link" aria-label="关闭的直接链接" title="关闭的直接链接">​</a></h3>
<p>和上面的启用基本一样，只不过名字换成了<code>close</code>。即<code>sharedWorker.port.close()</code>执行之后，就关闭了当前浏览器页签与共享线程间的连接，不再和共享线程互通消息。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="消息通信">消息通信<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1" class="hash-link" aria-label="消息通信的直接链接" title="消息通信的直接链接">​</a></h3>
<p>就是<code>sharedWorker.port.postMessage(message, transferList)</code>.</p>
<p>第一个参数：当前浏览器页签想要发给共享线程的信息，可以是任意数据类型</p>
<p>第二个参数：暂不深究</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="调试">调试<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E8%B0%83%E8%AF%95" class="hash-link" aria-label="调试的直接链接" title="调试的直接链接">​</a></h3>
<p>点击打开调试页面👉<a href="chrome://inspect/#workers" target="_blank" rel="noopener noreferrer">chrome://inspect/#workers</a> 可以看到下面的内容
<img loading="lazy" alt="debug" src="https://xpzero.github.io/blog/assets/images/debug-708532366022d5ed436adc3f71a20391.png" width="1176" height="509" class="img_rmWR">
调试控制台大家可以理解为<code>Chrome</code>的<code>DevTools</code>，一模一样。可以在上面看到自己在共享js文件中写的<code>console</code></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="️️️注意">❗️❗️❗️注意<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%EF%B8%8F%EF%B8%8F%EF%B8%8F%E6%B3%A8%E6%84%8F" class="hash-link" aria-label="❗️❗️❗️注意的直接链接" title="❗️❗️❗️注意的直接链接">​</a></h2>
<blockquote>
<ul>
<li>单页应用的时候记得及时关闭worker，否则常驻</li>
<li>每创建一个worker，如果参数url都一样，那么会<strong><em>视为使用同一个共享线程</em></strong>，共享线程会分配一个port对象来区分不同使用者。即<code>SharedWorker</code>实例对象的port可以用来区分不同的页签。</li>
</ul>
</blockquote>
<p>关于共享js文件
<img loading="lazy" alt="commonjs" src="https://xpzero.github.io/blog/assets/images/commonjs-aa86457ab52142a12323ff644159b688.png" width="1950" height="1386" class="img_rmWR"></p>
<p>还有一点。因为有同源限制，所以需要开一个服务器才能看到信息共享效果。可以试试<code>VS Code</code>的<code>Live Server</code>插件.</p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="案例">案例<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E6%A1%88%E4%BE%8B" class="hash-link" aria-label="案例的直接链接" title="案例的直接链接">​</a></h2>
<p>案例准备了两个文件，一个是共享的js文件，一个是html文件。</p>
<p>测试效果的时候，最少在浏览器上打开两个相同的页签。无论点击哪个页签的【获取消息】，两个页签都会alert一个3出来。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="共享js文件">共享js文件<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%85%B1%E4%BA%ABjs%E6%96%87%E4%BB%B6" class="hash-link" aria-label="共享js文件的直接链接" title="共享js文件的直接链接">​</a></h3>
<p><code>sharedWorker.js</code></p>
<div class="language-js codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-js codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> number </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 储存所有port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-variable function" style="color:#d73a49">onconnect</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">includes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 监听浏览器页签发送的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onmessage</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"getData"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 广播：给所有port发消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">broadcast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"close"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">clearInvalidPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">broadcast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"ports"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 给浏览器页签发消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">postMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">clearInvalidPort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> item </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">~</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">splice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="html文件">html文件<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#html%E6%96%87%E4%BB%B6" class="hash-link" aria-label="html文件的直接链接" title="html文件的直接链接">​</a></h3>
<div class="language-html codeBlockContainer_BTEj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_L7qx"><pre tabindex="0" class="prism-code language-html codeBlock__etc thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qTou"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">doctype</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">en</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">X-UA-Compatible</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">IE=edge</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1.0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Document</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">btn</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">获取消息</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">br</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">closeBtn</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">关闭sharedWorker</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let myWorker = new SharedWorker("./sharedWorker.js", "test worker");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 监听共享线程传递的消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      myWorker.port.onmessage = (e) =&gt; alert(e.data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      btn.addEventListener("click", (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 给共享线程发送消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        myWorker.port.postMessage("getData");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      closeBtn.addEventListener("click", (e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 取消该port在共享线程中的存储[广播用的]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        myWorker.port.postMessage("close");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 关闭与共享线程的连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        myWorker.port.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      window.onbeforeunload = () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        myWorker.port.postMessage("close");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        myWorker.port.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_geb9"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_GOP8" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__8Nv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Bycf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="填脑坑">填脑坑<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%A1%AB%E8%84%91%E5%9D%91" class="hash-link" aria-label="填脑坑的直接链接" title="填脑坑的直接链接">​</a></h2>
<p>自己在学习过程中不理解的点。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="messageport对象一定要调用start吗">MessagePort对象一定要调用start()吗？<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#messageport%E5%AF%B9%E8%B1%A1%E4%B8%80%E5%AE%9A%E8%A6%81%E8%B0%83%E7%94%A8start%E5%90%97" class="hash-link" aria-label="MessagePort对象一定要调用start()吗？的直接链接" title="MessagePort对象一定要调用start()吗？的直接链接">​</a></h3>
<p>不一定。</p>
<ul>
<li>如果给<code>MessagePort</code>对象的<code>onmessage</code>属性赋值，就默认开启与共享线程的连接。</li>
<li>如果对象使用<code>addEventListener()</code>监听<code>message</code>，就需要调用<code>start()</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="共享js文件中的onconnect函数为什么用eport0获取port对象没有其他的获取方式了吗">共享js文件中的onconnect函数为什么用e.port[0]获取port对象？没有其他的获取方式了吗？<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%85%B1%E4%BA%ABjs%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84onconnect%E5%87%BD%E6%95%B0%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8eport0%E8%8E%B7%E5%8F%96port%E5%AF%B9%E8%B1%A1%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E7%9A%84%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%E4%BA%86%E5%90%97" class="hash-link" aria-label="共享js文件中的onconnect函数为什么用e.port[0]获取port对象？没有其他的获取方式了吗？的直接链接" title="共享js文件中的onconnect函数为什么用e.port[0]获取port对象？没有其他的获取方式了吗？的直接链接">​</a></h3>
<p>因为<code>e.port</code>是只包括一个<code>MessagePort</code>对象的数组。没有其他方式。</p>
<h3 class="anchor anchorWithStickyNavbar_IQQo" id="共享js文件中onconnect怎么解释">共享js文件中onconnect怎么解释？<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%85%B1%E4%BA%ABjs%E6%96%87%E4%BB%B6%E4%B8%ADonconnect%E6%80%8E%E4%B9%88%E8%A7%A3%E9%87%8A" class="hash-link" aria-label="共享js文件中onconnect怎么解释？的直接链接" title="共享js文件中onconnect怎么解释？的直接链接">​</a></h3>
<p>新客户端连接的时候会触发。
<a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope/connect_event" target="_blank" rel="noopener noreferrer">具体可以看下这里</a></p>
<h2 class="anchor anchorWithStickyNavbar_IQQo" id="参考链接">参考链接<a href="https://xpzero.github.io/blog/index/2022/10/14/SharedWorker#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="hash-link" aria-label="参考链接的直接链接" title="参考链接的直接链接">​</a></h2>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SharedWorker" target="_blank" rel="noopener noreferrer">MDN SharedWorker</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MessagePort" target="_blank" rel="noopener noreferrer">MDN MessagePort</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/postMessage" target="_blank" rel="noopener noreferrer">MDN postMessage</a></p>
<p><a href="https://www.cnblogs.com/imgss/p/14634577.html" target="_blank" rel="noopener noreferrer">sharedWorker 实现多页面通信</a></p>
<p><a href="https://blog.csdn.net/iamlujingtao/article/details/122078713" target="_blank" rel="noopener noreferrer">JS SharedWorker详细介绍/广播/Vue使用</a></p>]]></content>
        <category label="js" term="js"/>
    </entry>
</feed>