"use strict";(self.webpackChunkblog_2=self.webpackChunkblog_2||[]).push([[4255],{71408:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>i});var r=o(11527),s=o(56213);const t={title:"mobx\u5728react\u4e2d\u7684\u4f7f\u7528",toc_max_heading_level:6,tags:["react","mobx"]},c=void 0,a={permalink:"/blog/blog/2022/10/15/how-to-use-mobx-in-react",source:"@site/blog/2022/10/15/how-to-use-mobx-in-react.md",title:"mobx\u5728react\u4e2d\u7684\u4f7f\u7528",description:"\u5b89\u88c5\u4f9d\u8d56\u5305",date:"2022-10-15T00:00:00.000Z",formattedDate:"2022\u5e7410\u670815\u65e5",tags:[{label:"react",permalink:"/blog/blog/tags/react"},{label:"mobx",permalink:"/blog/blog/tags/mobx"}],readingTime:5.635,hasTruncateMarker:!0,authors:[],frontMatter:{title:"mobx\u5728react\u4e2d\u7684\u4f7f\u7528",toc_max_heading_level:6,tags:["react","mobx"]},unlisted:!1,prevItem:{title:"git rebase\u4f7f\u7528\u8bb0\u5f55",permalink:"/blog/blog/2022/11/05/git-rebase-useage"},nextItem:{title:"SharedWorker\u4f7f\u7528\u603b\u7ed3",permalink:"/blog/blog/2022/10/14/SharedWorker"}},l={authorsImageUrls:[]},i=[{value:"\u5b89\u88c5\u4f9d\u8d56\u5305",id:"\u5b89\u88c5\u4f9d\u8d56\u5305",level:2},{value:"\u6838\u5fc3api",id:"\u6838\u5fc3api",level:2},{value:"\u5b9a\u4e49\u53ef\u89c2\u5bdf\u6570\u636e",id:"\u5b9a\u4e49\u53ef\u89c2\u5bdf\u6570\u636e",level:3},{value:"\u65b9\u5f0f\u4e00",id:"\u65b9\u5f0f\u4e00",level:4},{value:"\u65b9\u5f0f\u4e8c",id:"\u65b9\u5f0f\u4e8c",level:4},{value:"\u58f0\u660e\u8981\u76d1\u6d4b\u6570\u636e\u7684\u89c6\u56fe",id:"\u58f0\u660e\u8981\u76d1\u6d4b\u6570\u636e\u7684\u89c6\u56fe",level:3},{value:"\u7c7b\u7ec4\u4ef6",id:"\u7c7b\u7ec4\u4ef6",level:4},{value:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",id:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",level:4},{value:"\u4ee3\u7801\u5b9e\u73b0",id:"\u4ee3\u7801\u5b9e\u73b0",level:2},{value:"\u5b9a\u4e49\u5171\u4eab\u6570\u636e",id:"\u5b9a\u4e49\u5171\u4eab\u6570\u636e",level:3},{value:"\u521b\u5efa\u7ec4\u4ef6",id:"\u521b\u5efa\u7ec4\u4ef6",level:3},{value:"\u4e3b\u6587\u4ef6",id:"\u4e3b\u6587\u4ef6",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u586b\u8111\u5751",id:"\u586b\u8111\u5751",level:2},{value:"<code>@action</code>\u548c<code>@action.bound</code>\u6709\u4ec0\u4e48\u533a\u522b\uff1f",id:"action\u548cactionbound\u6709\u4ec0\u4e48\u533a\u522b",level:3},{value:"<code>useObserver()</code>\u548c<code>observer()</code>\u7684\u533a\u522b\uff1f",id:"useobserver\u548cobserver\u7684\u533a\u522b",level:3},{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"\u5b89\u88c5\u4f9d\u8d56\u5305",children:"\u5b89\u88c5\u4f9d\u8d56\u5305"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"npm i mobx-react@6.1.3 mobx@5.13.0\n# or\nyarn add mobx-react@6.1.3 mobx@5.13.0\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6838\u5fc3api",children:"\u6838\u5fc3api"}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9a\u4e49\u53ef\u89c2\u5bdf\u6570\u636e",children:"\u5b9a\u4e49\u53ef\u89c2\u5bdf\u6570\u636e"}),"\n",(0,r.jsxs)(e.p,{children:["\u5047\u8bbe\u58f0\u660e\u53ef\u89c2\u5bdf\u6570\u636e\u7684\u6587\u4ef6\u540d\u4e3a",(0,r.jsx)(e.code,{children:"test.js"})]}),"\n",(0,r.jsx)(e.h4,{id:"\u65b9\u5f0f\u4e00",children:"\u65b9\u5f0f\u4e00"}),"\n",(0,r.jsxs)(e.p,{children:["\u4f7f\u7528",(0,r.jsx)(e.code,{children:"observable()"}),"\u51fd\u6570"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'import { observable } from "mobx";\n\nexport default observable({\n  name: "xxxx",\n  age: 20,\n});\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u65b9\u5f0f\u4e8c",children:"\u65b9\u5f0f\u4e8c"}),"\n",(0,r.jsxs)(e.p,{children:["\u4f7f\u7528\u5728",(0,r.jsx)(e.code,{children:"class"}),"\u4e0a\u4f7f\u7528\u88c5\u9970\u5668"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'class Test {\n  @observable name = "123";\n  @observable age = 20;\n}\n\nexport default new Test();\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u58f0\u660e\u8981\u76d1\u6d4b\u6570\u636e\u7684\u89c6\u56fe",children:"\u58f0\u660e\u8981\u76d1\u6d4b\u6570\u636e\u7684\u89c6\u56fe"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u89c6\u56fe\u4e2d\u4f7f\u7528\u7684\u53ef\u89c2\u5bdf\u6570\u636e\u53d1\u751f\u53d8\u5316\u540e\uff0cmobx\u4f1a\u4f7f\u5f53\u524d\u4f7f\u7528\u53ef\u89c2\u5bdf\u6570\u636e\u7684\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3"}),"\n",(0,r.jsx)(e.h4,{id:"\u7c7b\u7ec4\u4ef6",children:"\u7c7b\u7ec4\u4ef6"}),"\n",(0,r.jsxs)(e.p,{children:["\u4f7f\u7528",(0,r.jsx)(e.code,{children:"@observer"}),"\u88c5\u9970\u5668.\u5982\u679c",(0,r.jsx)(e.code,{children:"TestComponent"}),"\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u7684\u53ef\u89c2\u5bdf\u6570\u636e\u53d1\u751f\u53d8\u5316\uff0c\u8be5\u7ec4\u4ef6\u4f1a\u88ab\u91cd\u65b0\u6e32\u67d3\u3002\n",(0,r.jsxs)(e.strong,{children:["\u53ea\u80fd\u76d1\u6d4b\u5f53\u524d\u7ec4\u4ef6\uff0c\u4e0d\u80fd\u6df1\u5165\u5b50\u7ec4\u4ef6\u3002\u60f3\u8981\u6df1\u5165\u5b50\u7ec4\u4ef6\uff0c\u9700\u8981\u5b50\u7ec4\u4ef6\u4f7f\u7528",(0,r.jsx)(e.code,{children:"@observer"})]})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'import { observer } from "mobx-react";\nimport MobxData from "./test.js";\n@observer\nclass TestComponent extends React.Component {\n  render() {\n    // use observable data\n    return <div>{MobxData.name}</div>;\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u51fd\u6570\u5f0f\u7ec4\u4ef6",children:"\u51fd\u6570\u5f0f\u7ec4\u4ef6"}),"\n",(0,r.jsxs)(e.p,{children:["\u4f7f\u7528",(0,r.jsx)(e.code,{children:"useObserver()"}),"\u6216\u8005",(0,r.jsx)(e.code,{children:"observer()"}),"\u3002",(0,r.jsxs)(e.strong,{children:["\u53ea\u80fd\u76d1\u6d4b\u5f53\u524d\u5305\u88f9\u7684\u5185\u5bb9\uff0c\u4e0d\u80fd\u6df1\u5165\u5b50\u7ec4\u4ef6\u3002\u60f3\u8981\u6df1\u5165\u5b50\u7ec4\u4ef6\uff0c\u9700\u8981\u5b50\u7ec4\u4ef6\u4f7f\u7528",(0,r.jsx)(e.code,{children:"useObserver()"}),"\u6216",(0,r.jsx)(e.code,{children:"observer()"})]})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'import { useObserver } from "mobx-react";\nimport MobxData from "./test.js";\nconst TestComponent = observer(() => {\n  // use observable data\n  return <div>{MobxData.name}</div>;\n});\n\n// function TestComponent() {\n//    // use observable data\n//    return useObserver(() => <div>{MobxData.name}</div>);\n// });\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u4ee3\u7801\u5b9e\u73b0",children:"\u4ee3\u7801\u5b9e\u73b0"}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u7528\u51fd\u6570\u5f0f\u7ec4\u4ef6\u6f14\u793a"}),"\n",(0,r.jsx)(e.h3,{id:"\u5b9a\u4e49\u5171\u4eab\u6570\u636e",children:"\u5b9a\u4e49\u5171\u4eab\u6570\u636e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'import { action, observable } from "mobx";\n\n// \u4f7f\u7528\u88c5\u9970\u5668\n// class MobxData {\n//   @observable name = \'zoe\';\n//   @observable age = 12\n\n//   @action.bound\n//   setName(name: string) {\n//     this.name = name\n//   }\n\n// }\n\n// export default new MobxData()\n\nexport default observable({\n  name: "xxx",\n  age: 18,\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u521b\u5efa\u7ec4\u4ef6",children:"\u521b\u5efa\u7ec4\u4ef6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:'import React from "react";\nimport { useObserver } from "mobx-react";\nimport commonData from "./MobxData";\n\nfunction Child() {\n  const onClick = () => {\n    commonData.name = Math.random() * 100 + "_zhangsan";\n  };\n  console.log("child render");\n  return useObserver(() => (\n    <div>\n      Welcome {commonData.name}!You\'re 12 years old.\n      <button onClick={onClick}>change name</button>\n    </div>\n  ));\n}\nfunction Child2() {\n  const onClick = () => {\n    commonData.age = Math.random() * 100;\n  };\n  console.log("child2 render");\n  return useObserver(() => (\n    <div>\n      Welcome xxx!You\'re {commonData.age} years old.\n      <button onClick={onClick}>change age</button>\n    </div>\n  ));\n}\n\n// const Child2 = observer(() => {\n//   const onClick = () => {\n//     commonData.age = Math.random() * 100\n//   }\n//   console.log(\'child2 render\')\n//   return (\n//     <div>\n//         Welcome xxx!You\'re {commonData.age} years old.\n//         <button onClick={onClick}>change age</button>\n//     </div>\n//   )\n// })\n\nfunction Parent() {\n  return useObserver(() => (\n    <>\n      <Child />\n      <Child2 />\n      <button\n        onClick={() => {\n          commonData.name = Math.random() * 100 + "_qweqweqwe";\n        }}\n      >\n        \u4fee\u6539\u540d\u5b57\n      </button>\n    </>\n  ));\n}\n\n// const Parent = observer(() => (\n//   <>\n//     <Child/>\n//     <Child2/>\n//     <button onClick={() => {\n//       commonData.name = Math.random() * 100 + \'_qweqweqwe\'\n//     }}>\u4fee\u6539\u540d\u5b57</button>\n//   </>\n// ))\n\n// @observer\n// class Parent extends React.Component{\n//   render() {\n//     return (\n//       <>\n//         <Child/>\n//         <Child2/>\n//         <button onClick={() => {\n//           commonData.name = Math.random() * 100 + \'_qweqweqwe\'\n//         }}>\u4fee\u6539\u540d\u5b57</button>\n//       </>\n//     )\n//   }\n// }\n\nexport default function App() {\n  return (\n    <div>\n      App\n      <Parent />\n    </div>\n  );\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u4e3b\u6587\u4ef6",children:"\u4e3b\u6587\u4ef6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'import ReactDOM from "react-dom";\nimport Parent from "./Parent";\n\nReactDOM.render(<Parent />, document.querySelector("#root"));\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u8d77\u4e00\u4e2a\u6587\u4ef6\uff0c\u4f7f\u7528",(0,r.jsx)(e.code,{children:"mobx"}),"\u7684",(0,r.jsx)(e.code,{children:"observable()"}),"\u6216\u8005",(0,r.jsx)(e.code,{children:"@observable"}),"\u521b\u5efa\u5171\u4eab\u6570\u636e\u5e76\u5bfc\u51fa"]}),"\n",(0,r.jsxs)(e.li,{children:["\u5728\u89c6\u56fe\u4e2d\u4f7f\u7528",(0,r.jsx)(e.code,{children:"mobx-react"}),"\u7684",(0,r.jsx)(e.code,{children:"useObserver()"}),"\u6216\u8005",(0,r.jsx)(e.code,{children:"observer()"}),"\u6216\u8005",(0,r.jsx)(e.code,{children:"@observer"}),"\u76d1\u6d4b\u7ec4\u4ef6\u4e2d\u53ef\u89c2\u5bdf\u6570\u636e\u7684\u53d8\u5316","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u5728\u67d0\u7ec4\u4ef6\u4f7f\u7528\u7684\u53ef\u89c2\u5bdf\u6570\u636e\u53d1\u751f\u53d8\u5316\u65f6\u8be5\u7ec4\u4ef6\u4f1a\u88ab",(0,r.jsx)(e.code,{children:"rerender"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u586b\u8111\u5751",children:"\u586b\u8111\u5751"}),"\n",(0,r.jsxs)(e.h3,{id:"action\u548cactionbound\u6709\u4ec0\u4e48\u533a\u522b",children:[(0,r.jsx)(e.code,{children:"@action"}),"\u548c",(0,r.jsx)(e.code,{children:"@action.bound"}),"\u6709\u4ec0\u4e48\u533a\u522b\uff1f"]}),"\n",(0,r.jsx)(e.p,{children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'import { action } from "mobx";\nclass Store {\n  unbound() {\n    console.log("unbound", this);\n  }\n  arrow = () => {\n    console.log("arrow", this);\n  };\n  @action unboundAction() {\n    console.log("unboundAction", this);\n  }\n  @action.bound unboundActionBound() {\n    console.log("unboundActionBound", this);\n  }\n  @action arrowAction = () => {\n    console.log("arrowAction", this);\n  };\n  @action.bound arrowActionBound = () => {\n    console.log("arrowActionBound", this);\n  };\n}\n\nconst store = new Store();\nconst unbound = store.unbound;\nconst arrow = store.arrow;\nconst unboundAction = store.unboundAction;\nconst arrowAction = store.arrowAction;\nconst unboundActionBound = store.unboundActionBound;\nconst arrowActionBound = store.arrowActionBound;\nconsole.log(store);\nunbound();\narrow();\nunboundAction();\narrowAction();\nunboundActionBound();\narrowActionBound();\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u8fd0\u884c\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u65e5\u5fd7\u8f93\u51fa\u5982\u4e0b"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"log",src:o(33861).Z+"",width:"1470",height:"904"})}),"\n",(0,r.jsx)(e.p,{children:"\u5bf9\u539f\u578b\u7684\u5f71\u54cd\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"prototype",src:o(53644).Z+"",width:"1828",height:"758"})}),"\n",(0,r.jsx)(e.p,{children:"\u5bf9this\u7684\u5f71\u54cd"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"this",src:o(20589).Z+"",width:"1586",height:"546"})}),"\n",(0,r.jsxs)(e.p,{children:["\u4f46\u662fmobx\u4e0d\u63a8\u8350",(0,r.jsx)(e.code,{children:"action.bound"}),"\u548c\u7bad\u5934\u51fd\u6570\u4e00\u8d77\u4f7f\u7528"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.em,{children:["\u6ce8\u610f:\xa0",(0,r.jsx)(e.em,{children:"action.bound"}),"\xa0\u4e0d\u8981\u548c\u7bad\u5934\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\uff1b\u7bad\u5934\u51fd\u6570\u5df2\u7ecf\u662f\u7ed1\u5b9a\u8fc7\u7684\u5e76\u4e14\u4e0d\u80fd\u91cd\u65b0\u7ed1\u5b9a\u3002"]})}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"useobserver\u548cobserver\u7684\u533a\u522b",children:[(0,r.jsx)(e.code,{children:"useObserver()"}),"\u548c",(0,r.jsx)(e.code,{children:"observer()"}),"\u7684\u533a\u522b\uff1f"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"useObserver()"}),"\u5728\u51fd\u6570\u5185\u4f7f\u7528\u3002\u76d1\u6d4b\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u4f7f\u7528\u65b9\u5f0f\u50cf",(0,r.jsx)(e.code,{children:"useMemo"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"observer()"}),"\u5728\u51fd\u6570\u5916\u4f7f\u7528\u3002\u76d1\u6d4b\u9ad8\u9636\u7ec4\u4ef6\uff0c\u4f7f\u7528\u65b9\u5f0f\u50cf",(0,r.jsx)(e.code,{children:"React.memo"})]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u4ee5\u51fd\u6570\u5f0f\u7ec4\u4ef6\u4e3a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'const Parent = observer(() => (\n  <>\n    <Child />\n    <Child2 />\n    <button\n      onClick={() => {\n        commonData.name = Math.random() * 100 + "_qweqweqwe";\n      }}\n    >\n      \u4fee\u6539\u540d\u5b57\n    </button>\n  </>\n));\n\nfunction Parent() {\n  return useObserver(() => (\n    <>\n      <Child />\n      <Child2 />\n      <button\n        onClick={() => {\n          commonData.name = Math.random() * 100 + "_qweqweqwe";\n        }}\n      >\n        \u4fee\u6539\u540d\u5b57\n      </button>\n    </>\n  ));\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u53c2\u8003\u94fe\u63a5",children:"\u53c2\u8003\u94fe\u63a5"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://cn.mobx.js.org/refguide/action.html",children:"action (\u52a8\u4f5c)"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://www.i4k.xyz/article/qq_43293207/117596040",children:"React \u72b6\u6001\u7ba1\u7406\u5de5\u5177 Mobx \u57fa\u672c\u4f7f\u7528_\u3002\u70e6\u5566\u7684\u535a\u5ba2-\u7a0b\u5e8f\u5458\u79d8\u5bc6"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://stackoverflow.com/questions/48639891/difference-between-mobxs-action-bound-and-arrow-functions-on-class-functions",children:"https://stackoverflow.com/questions/48639891/difference-between-mobxs-action-bound-and-arrow-functions-on-class-functions"})})]})}function h(n={}){const{wrapper:e}={...(0,s.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},33861:(n,e,o)=>{o.d(e,{Z:()=>r});const r=o.p+"assets/images/log-76e5069c8a9a79503c4b0cf9c5777829.png"},53644:(n,e,o)=>{o.d(e,{Z:()=>r});const r=o.p+"assets/images/proto-c5c180007b5ff5174564fc8c765a0df5.png"},20589:(n,e,o)=>{o.d(e,{Z:()=>r});const r=o.p+"assets/images/this-140559f27970f8cbace4f51ac489d48c.png"},56213:(n,e,o)=>{o.d(e,{Z:()=>a,a:()=>c});var r=o(50959);const s={},t=r.createContext(s);function c(n){const e=r.useContext(t);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),r.createElement(t.Provider,{value:e},n.children)}}}]);